<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Leon的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="移动端,iOS,Android,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验">
<meta property="og:type" content="website">
<meta property="og:title" content="Leon的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Leon的博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Leon的博客">
  
    <link rel="alternate" href="/atom.xml" title="Leon的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Leon的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">每多学一点知识，就少写一行代码</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-iOS开发-——-Runtime" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/20/iOS开发-——-Runtime/" class="article-date">
  <time datetime="2016-07-20T07:04:01.000Z" itemprop="datePublished">2016-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/20/iOS开发-——-Runtime/">iOS开发 —— Runtime</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1>Runtime</h1>
<p>因为Objc是一门动态语言，所以它总是想办法把一些决定工作从编译连接推迟到运行时。也就是说只有编译器是不够的，还需要一个运行时系统 (runtime system) 来执行编译后的代码。这就是 Objective-C Runtime 系统存在的意义，它是整个Objc运行框架的一块基石。</p>
<p>Runtime基本是用C和汇编写的，可见苹果为了动态系统的高效而作出的努力。你可以在这里下到苹果维护的开源代码。苹果和GNU各自维护一个开源的runtime版本，这两个版本之间都在努力的保持一致。</p>
<p>&lt;!--more--&gt;</p>
<h1>消息传递</h1>
<p>在很多语言中，比如C，调用一个方法其实就是跳到内存中的某一点并开始执行一段代码。没有任何动态的特性，因为这在编译时就决定好了。而在Objective-C中，类似 <code>[Receiver message]</code> 这种语法并不会立即执行 <code>message</code> 这个方法的代码。 它是在运行时给 <code>Receiver</code> 发送一条叫 <code>message</code> 的消息。 这个消息，也许会被 <code>Receiver</code> 来处理，也许会被转发给另一个对象，或者没有对象处理最终被报错导致程序崩溃。</p>
<p>事实上，在编译时，我们所编写的 <code>Objective-C</code> 函数都会被翻译成一个C语言的函数调用。 <code>- objc_msgSend(id self, SEL op, ...)</code>。</p>
<p>比如我们创建一个类 名字叫 <code>Family</code>  创建一个数组来存储我们生成的 <code>Family</code> 对象。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Family *family = [[Family alloc] init];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> array];</span><br></pre></td></tr></table></figure></p>
<p>接下去的两行代码是等价的</p>
<p><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[array insertObject:family atIndex:<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">objc_msgSend(array, <span class="keyword">@selector</span>(insertObject:atIndex:), family, <span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<p>在调用 <code>objc_msgSend</code> 这个方法时，我们先要包含 <code>#import &lt;objc/message.h&gt;</code> 这个头文件。 而且在编写 <code>objc_msgSend</code> 这个函数时，先去 <code>TARGETS</code> - <code>Build settings</code> - <code>Apple LLVM 7.0</code> - <code>Preprocessing</code> - <code>Enable Strict Checking of objc_msgSend Calls</code> 设置为NO。</p>
<p>从这里我们就能得到一个结论 <code>objc_msgSend</code> 能确定消息名以及参数数目。</p>
<p>消息传递的关键藏于 <code>objc_object</code> 中的 <code>isa</code> 指针和 <code>objc_class</code> 中的 <code>class dispatch table</code> 。</p>
<h1>消息传递的过程</h1>
<p>在 <code>Objective-C 中</code>，类、对象和方法都是一个 C 的结构体，从 <code>objc/objc.h</code> 头文件中，我们可以找到他们的定义。</p>
<p>具体的定义分析可以在我的另一篇 解释 <code>Runtime</code> 中各种方法、属性的定义中去学习。</p>
<p>从这些定义中可以看出发送一条消息也就 <code>objc_msgSend</code> 做了什么事。举 <code>objc_msgSend(array, @selector(insertObject:atIndex:), family, 0);</code> 这个例子来说：</p>
<ol>
<li>
<p>首先，通过array的isa指针找到它的class；（从之前的代码 得知是 <code>NSMutableArray</code> 类）</p>
</li>
<li>
<p>在 <code>class</code> 的 <code>method list</code> 中找 <code>insertObject:atIndex:</code> ；</p>
</li>
<li>
<p>如果 <code>class</code> 中 没有找到 <code>insertObject:atIndex:</code> 这个方法, 继续前往它的 <code>SuperClass</code> 中去找。</p>
</li>
<li>
<p>一旦找到 <code>insertObject:atIndex:</code> 这个函数，就去执行它的实现IMP。</p>
</li>
</ol>
<p>但这种实现有个问题，效率低。但一个 <code>class</code> 往往只有 20% 的函数会被经常调用，可能占总调用次数的 80% 。每个消息都需要遍历一次 <code>objc_method_list</code> 并不合理。如果把经常被调用的函数缓存下来，那可以大大提高函数查询的效率。这也就是 <code>objc_class</code> 中另一个重要成员 <code>objc_cache</code> 做的事情 - 再找到 <code>insertObject:atIndex:</code> 之后，把 <code>insertObject:atIndex:</code> 的 <code>method_name</code> 作为  <strong>key</strong> ，<code>method_imp</code> 作为 <strong>value</strong> 给存起来。当再次收到 <code>insertObject:atIndex:</code> 消息的时候，可以直接在 <code>cache</code> 里找到，避免去遍历 <code>objc_method_list</code>。</p>
<h1>方法的动态解析和转发</h1>
<p>如果在 <code>Family</code> 类中，我运行了类中没有存在的 <code>- familyName:</code> 这个方法时。 会出现怎样的结果， 相信接下来的语句 每一个做过开发人员都应该见过  <strong>unrecognized selector sent to instance 0x7ffee1e90f00</strong> 。</p>
<p>但是在这个异常抛出之前，我们的 <code>Objective-C</code> 尝试过用三种方法来拯救我们的程序。</p>
<ol>
<li>Method resolution</li>
<li>Fast forwarding</li>
<li>Normal forwarding</li>
</ol>
<h1>Method Resolution</h1>
<p>首先，<strong>Runtime</strong> 会调用 <code>+ (BOOL)resolveInstanceMethod:</code> 这个方法，让你有机会提供一个函数实现。如果你添加了函数并返回YES，那么 <strong>Runtime</strong> 系统就会重新启动一次消息发送的过程。</p>
<p>以刚才我想实现的 <code>- familyName:</code> 这个方法为例。</p>
<p>我在 <code>Family</code> 类中这样重写了 <code>+ (BOOL)resolveInstanceMethod:</code>  方法:</p>
<p><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  里边有三个类型别名,在这儿先解释一下</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">      SEL selector的简写,俗称方法选择器,实质存储的是方法的名称</span></span><br><span class="line"><span class="comment">      IMP implement的简写,俗称方法实现,看源码得知它就是一个函数指针</span></span><br><span class="line"><span class="comment">      Method 对上述两者的一个包装结构.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> lostInstanceMethod()&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"this InstanceMethod was lost"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">BOOL</span>) resolveInstanceMethod:(SEL)sel&#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(familyName:)) &#123;</span><br><span class="line">        class_addMethod([<span class="keyword">self</span> <span class="keyword">class</span>], sel, (IMP)lostInstanceMethod, <span class="literal">nil</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在当我执行了  <code>objc_msgSend(family, @selector(familyName:), nil);</code>  这句语句时，程序不出意外的打印出了 <code>lostInstanceMethod()</code>
函数中的那句话。</p>
<p><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  这里当我们运行了类中没有存在的 familyName 这个方法时.</span></span><br><span class="line"><span class="comment">    *  Objective_C 运行时 会调用 + (BOOL)resolveInstanceMethod:(SEL)sel</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  但是当我注销掉 + (BOOL)resolveInstanceMethod:(SEL)sel 这个方法后</span></span><br><span class="line"><span class="comment">    *  编译通过之后程序崩溃 并不会进入 + (BOOL)resolveClassMethod:(SEL)sel 这个方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   </span><br><span class="line"> objc_msgSend(family, <span class="keyword">@selector</span>(familyName:), <span class="literal">nil</span>);</span><br></pre></td></tr></table></figure></p>
<h1>Fast forwarding</h1>
<p>如果resolve方法返回了NO， 运行时就会移到下一步， 消息转发 （Message Forwarding）。</p>
<p>如果目标对象实现了 <code>- (id)forwardingTargetForSelector:(SEL)aSelector</code> ， <strong>Runtime</strong> 这时就会调用这个方法，给你把这个消息转发给其他对象的机会。</p>
<p>如果这是我运行这样一行代码:</p>
<p><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objc_msgSend(family, <span class="keyword">@selector</span>(familyHouse:), <span class="literal">nil</span>);</span><br></pre></td></tr></table></figure></p>
<p>我的 <code>Family</code> 类中并没有实现 <code>- familyHouse:</code> 这个方法，所以如果运行下去肯定会抛出异常代码 。</p>
<p>但是我新建了一个 <code>FamilyHouse</code> 类， 我在 <code>FamilyHouse</code> 这个类中实现了 <code>-familyHouse:</code> 。</p>
<p><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FamilyHouse.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FamilyHouse</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)familyHouse:(<span class="built_in">NSString</span> *)house&#123;</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"this is my house"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>并且 我回到 <code>Family</code> 类中，重写 <code>- (id)forwardingTargetForSelector:(SEL)aSelector</code> 方法 。</p>
<p>首先定义一个 <code>House</code> 的对象，并将它初始化，之后重写方法。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(familyHouse:)) &#123;</span><br><span class="line">        <span class="keyword">return</span> _house;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这时当 <strong>Runtime</strong>在当前类找不到 <code>- familyHose:</code> 这个方法时，就会调用 <code>- forwardingTargetForSelector:</code> 这个方法，将消息分发到属于 <code>FamilyHouse</code> 类的对象 <code>house</code> 去执行这个方法。</p>
<p>只要这个方法返回的不是 <code>nil</code> 和 <code>self</code>，整个消息发送的过程就会被重启，当然发送的对象会变成你返回的那个对象。否则，就会继续 <strong>Normal Fowarding</strong> 。</p>
<p>这里叫 Fast ，只是为了区别下一步的转发机制。因为这一步不会创建任何新的对象，但下一步转发会创建一个 <code>NSInvocation</code> 对象，所以相对更快点。</p>
<h1>Normal forwarding</h1>
<p>这一步是 <strong>Runtime</strong>最后一次给你机会挽救程序。 首先它会发送 <code>- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</code> 这个消息来获取你转发消息的对象的函数参数和方法名。</p>
<p>如果 <code>- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</code> 这个方法返回  <code>nil</code> ，<strong>Runtime</strong> 则会抛出 <code>- (void)doesNotRecognizeSelector:(SEL)aSelector</code> 这个消息，当然，你的程序也就华丽丽的挂掉了。</p>
<p>如果是 <code>- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector</code> 返回了一个函数签名，  <strong>Runtime</strong> 就会创建一个 <code>NSInvocation</code> 对象，并执行 <code>- (void)forwardInvocation:(NSInvocation *)anInvocation</code> 这个方法，转发消息给目标对象。</p>
<p>接着上面的 <strong>Fast forwarding</strong> 部分叙述，假如我在第二步，并没有重写 <code>- (id)forwardingTargetForSelector:(SEL)aSelector</code> 这个方法我该怎么在最后一步完成拯救。</p>
<p>首先是完成函数签名这个方法,注意这里的 <code>_house</code> 对象，是我已经初始化好的 <code>FamilyHouse</code> 类的对象。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector&#123;</span><br><span class="line">    <span class="built_in">NSMethodSignature</span>* signature = [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!signature)&#123;</span><br><span class="line">        signature = [_house methodSignatureForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> signature;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这步完成后，就会返回给程序一个函数签名，<strong>Runtime</strong> 就会创建一个 <strong>NSInvocation</strong> 对象并发送 <code>-forwardInvocation:</code> 消息给目标对象。</p>
<p><code>NSInvocation</code> 实际上就是对一个消息的描述 ，包括方法名以及参数等信息。所以我们可以在 <code>- (void)forwardInvocation:(NSInvocation *)anInvocation</code> 里修改传进来的 <code>NSINvocation</code> 对象， 然后发送  <code>-invokeWithTarget:</code>  的消息给他，传进去一个新的对象</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation&#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([_house respondsToSelector:sel]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:_house];</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> doesNotRecognizeSelector:sel];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个代码的运行结果 就跟之前一样了。</p>
<h1>总结</h1>
<p><code>Objective-C</code> 中给一个对象发送消息会经过以下几个步骤：</p>
<ol>
<li>
<p>在对象类的 <code>dispatch table</code> 中尝试找到该消息。如果找到了，跳到相应的函数IMP去执行实现代码；</p>
</li>
<li>
<p>如果没有找到，<strong>Runtime</strong> 会执行 <code>+ (BOOL)resolveInstanceMethod:(SEL)sel</code> 方法，尝试着去 <strong>resolve</strong>这个方法。</p>
</li>
<li>
<p>如果 <strong>resolve</strong> 方法返回 <strong>NO</strong>，<strong>Runtime</strong> 就发送 <code>-forwardingTargetForSelector:</code> 允许你把这个消息转发给另一个对象；</p>
</li>
<li>
<p>如果没有新的目标对象返回， <strong>Runtime</strong> 就会发送 <code>-methodSignatureForSelector:</code> 和 <code>-forwardInvocation:</code> 消息。你可以发送 <code>-invokeWithTarget:</code> 消息来手动转发消息或者发送 <code>-doesNotRecognizeSelector:</code> 抛出异常。</p>
</li>
</ol>
<p>利用 <strong>Objective-C</strong> 的 <strong>Runtime</strong> 特性，我们可以自己来对语言进行扩展，解决项目开发中的一些设计和技术问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/20/iOS开发-——-Runtime/" data-id="cjptr3x8l00e0lyz9oyln0q10" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Runtime/">Runtime</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——头像设置及本地沙盒保存，圆形头像显示" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/19/iOS开发——头像设置及本地沙盒保存，圆形头像显示/" class="article-date">
  <time datetime="2016-07-19T07:03:44.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/19/iOS开发——头像设置及本地沙盒保存，圆形头像显示/">iOS开发——头像设置及本地沙盒保存，圆形头像显示</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>今天来讲一讲iOS实际开发中，对于头像的应用。</p>
<p>现在的APP中，对于头像的设置，我们大多采用圆形头像，并且需要支持从照相机获取或者从相册中选择用户需要的头像，并且保存在本地或者服务器中。</p>
<p>&lt;!--more--&gt;</p>
<p>在设置完头像之后，后期如果用户想查看头像，一般有设置手势，点击将头像按我们的设想放大。这个功能，我计划放在后面的一篇文章里讲。</p>
<p>本文主要讲解对于头像的设置，圆形头像的设置、并且头像的本地获取已经本地化保存。</p>
<p>因为头像的唯一性，所以我想大家都会考虑在头像中使用单例设计模式。这里我们把头像定义为 <code>HeadsPicture</code> 类。</p>
<p>类中我们的代码可以定义如下:</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeadsPicture</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedHeadsPicture;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  设置头像</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param image 图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  读取图片</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">-(<span class="built_in">UIImage</span> *)imageForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>我们在类中 使用了 <code>sharedHeadsPicture</code> 这个单例方法,也定义了一个读取头像图片、以及存储头像图片的方法。暂时我还是把代码保存到了沙盒文件里，代码中大家也可以很方便的把存储在服务器里的头像图片集成进来。</p>
<p>在 <code>HeadsPicture.m</code> 中，代码如下。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"HeadsPicture.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HeadsPicture</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *dictionary;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)imagePathForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HeadsPicture</span></span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedHeadsPicture&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> HeadsPicture *instance = <span class="literal">nil</span>;</span><br><span class="line">    <span class="comment">//确保多线程中只创建一次对象,线程安全的单例</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        instance = [[<span class="keyword">self</span> alloc] initPrivate];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">instancetype</span>)initPrivate&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        _dictionary = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">        <span class="comment">//注册为低内存通知的观察者</span></span><br><span class="line">        <span class="built_in">NSNotificationCenter</span> *nc = [<span class="built_in">NSNotificationCenter</span> defaultCenter];</span><br><span class="line">        [nc addObserver:<span class="keyword">self</span></span><br><span class="line">               selector:<span class="keyword">@selector</span>(clearCaches:)</span><br><span class="line">                   name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span></span><br><span class="line">                 object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)image forKey:(<span class="built_in">NSString</span> *)key&#123;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.dictionary setObject:image forKey:key];</span><br><span class="line">    <span class="comment">//获取保存图片的全路径</span></span><br><span class="line">    <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> imagePathForKey:key];</span><br><span class="line">    <span class="comment">//从图片提取JPEG格式的数据,第二个参数为图片压缩参数</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = <span class="built_in">UIImageJPEGRepresentation</span>(image, <span class="number">0.5</span>);</span><br><span class="line">    <span class="comment">//以PNG格式提取图片数据</span></span><br><span class="line">    <span class="comment">//NSData *data = UIImagePNGRepresentation(image);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将图片数据写入文件</span></span><br><span class="line">    [data writeToFile:path atomically:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">UIImage</span> *)imageForKey:(<span class="built_in">NSString</span> *)key&#123;</span><br><span class="line">    <span class="comment">//return [self.dictionary objectForKey:key];</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span>.dictionary objectForKey:key];</span><br><span class="line">    <span class="keyword">if</span> (!image) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *path = [<span class="keyword">self</span> imagePathForKey:key];</span><br><span class="line">        image = [<span class="built_in">UIImage</span> imageWithContentsOfFile:path];</span><br><span class="line">        <span class="keyword">if</span> (image) &#123;</span><br><span class="line">            </span><br><span class="line">            [<span class="keyword">self</span>.dictionary setObject:image forKey:key];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Error: unable to find %@"</span>, [<span class="keyword">self</span> imagePathForKey:key]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSString</span> *)imagePathForKey:(<span class="built_in">NSString</span> *)key&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSArray</span> *documentDirectories = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>);</span><br><span class="line">    <span class="built_in">NSString</span> *documentDirectory = [documentDirectories firstObject];</span><br><span class="line">    <span class="keyword">return</span> [documentDirectory stringByAppendingPathComponent:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)clearCaches:(<span class="built_in">NSNotification</span> *)n&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Flushing %ld images out of the cache"</span>, (<span class="keyword">unsigned</span> <span class="keyword">long</span>)[<span class="keyword">self</span>.dictionary count]);</span><br><span class="line">    [<span class="keyword">self</span>.dictionary removeAllObjects];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>在上面，我们已经完成了头像的设置与读取。</p>
<p>回到界面上，我们先定义一个头像显示的试图。</p>
<p><code>@property (weak, nonatomic) IBOutlet UIImageView *avatarImage;</code></p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  设置圆形头像属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setCirclePhoto&#123;</span><br><span class="line">  [<span class="keyword">self</span>.avatarImage.layer setCornerRadius:<span class="built_in">CGRectGetHeight</span>([<span class="keyword">self</span>.avatarImage bounds]) / <span class="number">2</span>];</span><br><span class="line">  <span class="keyword">self</span>.avatarImage.layer.masksToBounds = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">//可以根据需求设置边框宽度、颜色</span></span><br><span class="line">  <span class="keyword">self</span>.avatarImage.layer.borderWidth = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">self</span>.avatarImage.layer.borderColor = [[<span class="built_in">UIColor</span> blackColor] <span class="built_in">CGColor</span>];</span><br><span class="line">  <span class="comment">//设置图片；</span></span><br><span class="line">  <span class="keyword">self</span>.avatarImage.layer.contents = (<span class="keyword">id</span>)[[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"avatar.png"</span>] <span class="built_in">CGImage</span>];</span><br><span class="line">    <span class="keyword">self</span>.avatarImage.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后完成圆形头像的属性设置。</p>
<p>最后来写 <code>设置头像</code> 按钮背后的选择照片的逻辑代码。</p>
<p>因为是从 <code>照相机</code> 或者 <code>相册</code> 中来读取照片，需要使用 <code>UIImagePickerController&quot;图像选择器&quot;</code> 。</p>
<p><code>UIImagePickerController</code> 是一种导航控制器，使用它，用户可以打开系统的图片选取器或者打开相机进行拍照。实现协议 <code>UIImagePickerDelegate</code>中定义的委托方法可以对选定后的结果进行操作，或是没有选择取消的操作。</p>
<p>具体代码如下:</p>
<ul>
<li>首先我们先要确定、用户需要使用相册还是摄像头来直接拍摄头像。</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)selectPhoto:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">UIImagePickerController</span> *imagePicker = [[<span class="built_in">UIImagePickerController</span> alloc] init];</span><br><span class="line">  imagePicker.editing = <span class="literal">YES</span>;</span><br><span class="line">  imagePicker.delegate = <span class="keyword">self</span>;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   如果这里allowsEditing设置为false，则下面的UIImage *image = [info valueForKey:UIImagePickerControllerEditedImage];</span></span><br><span class="line"><span class="comment">   应该改为： UIImage *image = [info valueForKey:UIImagePickerControllerOriginalImage];</span></span><br><span class="line"><span class="comment">   也就是改为原图像，而不是编辑后的图像。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">//允许编辑图片</span></span><br><span class="line">  imagePicker.allowsEditing = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   这里以弹出选择框的形式让用户选择是打开照相机还是图库</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">//初始化提示框；</span></span><br><span class="line">  <span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"请选择打开方式"</span> message:<span class="literal">nil</span> preferredStyle:  <span class="built_in">UIAlertControllerStyleActionSheet</span>];</span><br><span class="line">  [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"照相机"</span> style:<span class="built_in">UIAlertActionStyleDefault</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line"></span><br><span class="line">    imagePicker.sourceType = <span class="built_in">UIImagePickerControllerSourceTypeCamera</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span> presentViewController:imagePicker animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">  &#125;]];</span><br><span class="line"></span><br><span class="line">  [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"相册"</span> style:<span class="built_in">UIAlertActionStyleDefault</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line">    imagePicker.sourceType = <span class="built_in">UIImagePickerControllerSourceTypePhotoLibrary</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:imagePicker animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">  &#125;]];</span><br><span class="line">    </span><br><span class="line">  [alert addAction:[<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span> style:<span class="built_in">UIAlertActionStyleDestructive</span> handler:^(<span class="built_in">UIAlertAction</span> * _Nonnull action) &#123;</span><br><span class="line">    <span class="comment">//取消；</span></span><br><span class="line">  &#125;]];</span><br><span class="line">  <span class="comment">//弹出提示框；</span></span><br><span class="line">  [<span class="keyword">self</span> presentViewController:alert animated:<span class="literal">true</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>之后实现 实现协议 <code>UIImagePickerDelegate</code>中定义的委托方法可以对选定后的结果进行操作。</li>
</ul>
<pre><code class="language-objc">
-(void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary&lt;NSString *,id&gt; *)info{
  //通过info字典获取选择的照片
  UIImage *image = [info valueForKey:UIImagePickerControllerEditedImage];
  //以itemKey为键，将照片存入ImageStore对象中
  [[HeadsPicture sharedHeadsPicture] setImage:image forKey:@&quot;HeadsPicture&quot;];
  //将照片放入UIImageView对象
  self.avatarImage.image = image;
  //把一张照片保存到图库中，此时无论是这张照片是照相机拍的还是本身从图库中取出的，都会保存到图库中；
  UIImageWriteToSavedPhotosAlbum(image, self, nil, nil);
  //压缩图片,如果图片要上传到服务器或者网络，则需要执行该步骤（压缩），第二个参数是压缩比例，转化为NSData类型；
  NSData *fileData = UIImageJPEGRepresentation(image, 1.0);
     //关闭以模态形式显示的UIImagePickerController
  [self dismissViewControllerAnimated:YES completion:nil];

}

</code></pre>
<p>至此，我们已经完成了头像的设置和本地的沙盒保存，以及圆形头像的显示。</p>
<p>至于头像的触摸放大等手势功能，等下篇文章再来讲解。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/19/iOS开发——头像设置及本地沙盒保存，圆形头像显示/" data-id="cjptr3x8p00e8lyz9p4873uvg" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/圆形头像/">圆形头像</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/头像设置/">头像设置</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS-全局禁止横屏，但视频播放界面选择性横屏的解决办法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/14/iOS-全局禁止横屏，但视频播放界面选择性横屏的解决办法/" class="article-date">
  <time datetime="2016-07-14T07:25:15.000Z" itemprop="datePublished">2016-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/14/iOS-全局禁止横屏，但视频播放界面选择性横屏的解决办法/">iOS 全局禁止横屏，但视频播放界面选择性横屏的解决办法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>有时我们的APP并没有适配横屏的需求，但是在个别视频播放界面，我们需要在播放视频的时候横屏，退出全屏的时候不能横屏，但是有时候并没有原生API并没有给出解决方案。</p>
<p>&lt;!--more--&gt;</p>
<h3>当其他界面不支持横屏时:</h3>
<p>这个解决方法比较容易</p>
<p>在 <code>APPDelegate.h</code> 文件中增加属性：是否支持横屏</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***  是否允许横屏的标记 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>)<span class="built_in">BOOL</span> allowRotation;</span><br></pre></td></tr></table></figure></p>
<p>在 <code>APPDelegate.m</code> 文件中增加方法，控制全部不支持横屏</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIInterfaceOrientationMask</span>)application:(<span class="built_in">UIApplication</span> *)application supportedInterfaceOrientationsForWindow:(<span class="built_in">UIWindow</span> *)window &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.allowRotation) &#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="built_in">UIInterfaceOrientationMaskAllButUpsideDown</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIInterfaceOrientationMaskPortrait</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样在其他界面想要横屏的时候，我们只要控制 <code>allowRotation</code> 这个属性就可以控制其他界面进行横屏了。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需在上面#import "AppDelegate.h"</span></span><br><span class="line">AppDelegate *appDelegate = (AppDelegate *)[[<span class="built_in">UIApplication</span> sharedApplication] delegate];</span><br><span class="line">appDelegate.allowRotation = <span class="literal">YES</span>;</span><br><span class="line"><span class="comment">//不让横屏的时候 appDelegate.allowRotation = NO;即可</span></span><br></pre></td></tr></table></figure></p>
<h3>播放界面横屏</h3>
<p>所以这里可以使用 <code>UIWindow</code> 的通知，就可以解决</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(begainFullScreen) name:<span class="built_in">UIWindowDidBecomeVisibleNotification</span> object:<span class="literal">nil</span>];<span class="comment">//进入全屏</span></span><br><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(endFullScreen) name:<span class="built_in">UIWindowDidBecomeHiddenNotification</span> object:<span class="literal">nil</span>];<span class="comment">//退出全屏</span></span><br></pre></td></tr></table></figure></p>
<p>在退出全屏时，增加逻辑让其强制编程竖屏，这样当全屏播放的时候，点击 <code>down(&quot;完成&quot;)</code> 时，就会自动变成竖屏了。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 进入全屏</span></span><br><span class="line">-(<span class="keyword">void</span>)begainFullScreen</span><br><span class="line">&#123;</span><br><span class="line">    AppDelegate *appDelegate = (AppDelegate *)[[<span class="built_in">UIApplication</span> sharedApplication] delegate];</span><br><span class="line">    appDelegate.allowRotation = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 退出全屏</span></span><br><span class="line">-(<span class="keyword">void</span>)endFullScreen</span><br><span class="line">&#123;</span><br><span class="line">    AppDelegate *appDelegate = (AppDelegate *)[[<span class="built_in">UIApplication</span> sharedApplication] delegate];</span><br><span class="line">    appDelegate.allowRotation = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//强制归正：</span></span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">UIDevice</span> currentDevice] respondsToSelector:<span class="keyword">@selector</span>(setOrientation:)]) &#123;</span><br><span class="line">        SEL selector = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"setOrientation:"</span>);</span><br><span class="line">        <span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:[<span class="built_in">UIDevice</span> instanceMethodSignatureForSelector:selector]];</span><br><span class="line">        [invocation setSelector:selector];</span><br><span class="line">        [invocation setTarget:[<span class="built_in">UIDevice</span> currentDevice]];</span><br><span class="line">        <span class="keyword">int</span> val =<span class="built_in">UIInterfaceOrientationPortrait</span>;</span><br><span class="line">        [invocation setArgument:&amp;val atIndex:<span class="number">2</span>];</span><br><span class="line">        [invocation invoke];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的两个方案已经足够解决只有部分界面需要支持横屏的问题了，亲测可用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/14/iOS-全局禁止横屏，但视频播放界面选择性横屏的解决办法/" data-id="cjptr3x4g001glyz9yvl9lhv2" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/横屏解决方案/">横屏解决方案</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——实用性技巧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/08/iOS开发——实用性技巧/" class="article-date">
  <time datetime="2016-07-08T08:23:51.000Z" itemprop="datePublished">2016-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/08/iOS开发——实用性技巧/">iOS开发——实用性技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>分享一些项目中常用的方法，可以保存起来，作为自己的工具集哦。</p>
<p>&lt;!--more--&gt;</p>
<ul>
<li>**1.**磁盘总空间大小</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGFloat</span>)diskOfAllSizeMBytes</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> size = <span class="number">0.0</span>;</span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *dic = [[<span class="built_in">NSFileManager</span> defaultManager] attributesOfFileSystemForPath:<span class="built_in">NSHomeDirectory</span>() error:&amp;error];</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="meta">#ifdef DEBUG</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"error: %@"</span>, error.localizedDescription);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">NSNumber</span> *number = [dic objectForKey:<span class="built_in">NSFileSystemSize</span>];</span><br><span class="line">        size = [number floatValue]/<span class="number">1024</span>/<span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**2.**磁盘可用空间大小</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGFloat</span>)diskOfFreeSizeMBytes</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> size = <span class="number">0.0</span>;</span><br><span class="line">    <span class="built_in">NSError</span> *error;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *dic = [[<span class="built_in">NSFileManager</span> defaultManager] attributesOfFileSystemForPath:<span class="built_in">NSHomeDirectory</span>() error:&amp;error];</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line"><span class="meta">#ifdef DEBUG</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"error: %@"</span>, error.localizedDescription);</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">NSNumber</span> *number = [dic objectForKey:<span class="built_in">NSFileSystemFreeSize</span>];</span><br><span class="line">        size = [number floatValue]/<span class="number">1024</span>/<span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**3.**将字符串数组按照元素首字母顺序进行排序分组</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSDictionary</span> *)dictionaryOrderByCharacterWithOriginalArray:(<span class="built_in">NSArray</span> *)array</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (array.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> obj <span class="keyword">in</span> array) &#123;</span><br><span class="line">        <span class="keyword">if</span> (![obj isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UILocalizedIndexedCollation</span> *indexedCollation = [<span class="built_in">UILocalizedIndexedCollation</span> currentCollation];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *objects = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:indexedCollation.sectionTitles.count];</span><br><span class="line">    <span class="comment">//创建27个分组数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; indexedCollation.sectionTitles.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *obj = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        [objects addObject:obj];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *keys = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:objects.count];</span><br><span class="line">    <span class="comment">//按字母顺序进行分组</span></span><br><span class="line">    <span class="built_in">NSInteger</span> lastIndex = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSInteger</span> index = [indexedCollation sectionForObject:array[i] collationStringSelector:<span class="keyword">@selector</span>(uppercaseString)];</span><br><span class="line">        [[objects objectAtIndex:index] addObject:array[i]];</span><br><span class="line">        lastIndex = index;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//去掉空数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *obj = objects[i];</span><br><span class="line">        <span class="keyword">if</span> (obj.count == <span class="number">0</span>) &#123;</span><br><span class="line">            [objects removeObject:obj];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取索引字母</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSMutableArray</span> *obj <span class="keyword">in</span> objects) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *str = obj[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">NSString</span> *key = [<span class="keyword">self</span> firstCharacterWithString:str];</span><br><span class="line">        [keys addObject:key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    [dic setObject:objects forKey:keys];</span><br><span class="line">    <span class="keyword">return</span> dic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**4.**将字符串数组按照元素首字母顺序进行排序分组</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSDictionary</span> *)dictionaryOrderByCharacterWithOriginalArray:(<span class="built_in">NSArray</span> *)array</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (array.count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> obj <span class="keyword">in</span> array) &#123;</span><br><span class="line">        <span class="keyword">if</span> (![obj isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UILocalizedIndexedCollation</span> *indexedCollation = [<span class="built_in">UILocalizedIndexedCollation</span> currentCollation];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *objects = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:indexedCollation.sectionTitles.count];</span><br><span class="line">    <span class="comment">//创建27个分组数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; indexedCollation.sectionTitles.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *obj = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        [objects addObject:obj];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *keys = [<span class="built_in">NSMutableArray</span> arrayWithCapacity:objects.count];</span><br><span class="line">    <span class="comment">//按字母顺序进行分组</span></span><br><span class="line">    <span class="built_in">NSInteger</span> lastIndex = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSInteger</span> index = [indexedCollation sectionForObject:array[i] collationStringSelector:<span class="keyword">@selector</span>(uppercaseString)];</span><br><span class="line">        [[objects objectAtIndex:index] addObject:array[i]];</span><br><span class="line">        lastIndex = index;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//去掉空数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSMutableArray</span> *obj = objects[i];</span><br><span class="line">        <span class="keyword">if</span> (obj.count == <span class="number">0</span>) &#123;</span><br><span class="line">            [objects removeObject:obj];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取索引字母</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSMutableArray</span> *obj <span class="keyword">in</span> objects) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *str = obj[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">NSString</span> *key = [<span class="keyword">self</span> firstCharacterWithString:str];</span><br><span class="line">        [keys addObject:key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    [dic setObject:objects forKey:keys];</span><br><span class="line">    <span class="keyword">return</span> dic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**5.**对图片进行滤镜处理</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 怀旧 --&gt; CIPhotoEffectInstant                         单色 --&gt; CIPhotoEffectMono</span></span><br><span class="line"><span class="comment">// 黑白 --&gt; CIPhotoEffectNoir                            褪色 --&gt; CIPhotoEffectFade</span></span><br><span class="line"><span class="comment">// 色调 --&gt; CIPhotoEffectTonal                           冲印 --&gt; CIPhotoEffectProcess</span></span><br><span class="line"><span class="comment">// 岁月 --&gt; CIPhotoEffectTransfer                        铬黄 --&gt; CIPhotoEffectChrome</span></span><br><span class="line"><span class="comment">// CILinearToSRGBToneCurve, CISRGBToneCurveToLinear, CIGaussianBlur, CIBoxBlur, CIDiscBlur, CISepiaTone, CIDepthOfField</span></span><br><span class="line">+ (<span class="built_in">UIImage</span> *)filterWithOriginalImage:(<span class="built_in">UIImage</span> *)image filterName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">CIImage</span> *inputImage = [[<span class="built_in">CIImage</span> alloc] initWithImage:image];</span><br><span class="line">    <span class="built_in">CIFilter</span> *filter = [<span class="built_in">CIFilter</span> filterWithName:name];</span><br><span class="line">    [filter setValue:inputImage forKey:kCIInputImageKey];</span><br><span class="line">    <span class="built_in">CIImage</span> *result = [filter valueForKey:kCIOutputImageKey];</span><br><span class="line">    <span class="built_in">CGImageRef</span> cgImage = [context createCGImage:result fromRect:[result extent]];</span><br><span class="line">    <span class="built_in">UIImage</span> *resultImage = [<span class="built_in">UIImage</span> imageWithCGImage:cgImage];</span><br><span class="line">    <span class="built_in">CGImageRelease</span>(cgImage);</span><br><span class="line">    <span class="keyword">return</span> resultImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**6.**对图片进行模糊处理</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// CIGaussianBlur ---&gt; 高斯模糊</span></span><br><span class="line"><span class="comment">// CIBoxBlur      ---&gt; 均值模糊(Available in iOS 9.0 and later)</span></span><br><span class="line"><span class="comment">// CIDiscBlur     ---&gt; 环形卷积模糊(Available in iOS 9.0 and later)</span></span><br><span class="line"><span class="comment">// CIMedianFilter ---&gt; 中值模糊, 用于消除图像噪点, 无需设置radius(Available in iOS 9.0 and later)</span></span><br><span class="line"><span class="comment">// CIMotionBlur   ---&gt; 运动模糊, 用于模拟相机移动拍摄时的扫尾效果(Available in iOS 9.0 and later)</span></span><br><span class="line">+ (<span class="built_in">UIImage</span> *)blurWithOriginalImage:(<span class="built_in">UIImage</span> *)image </span><br><span class="line">                            blurName:(<span class="built_in">NSString</span> *)name </span><br><span class="line">                            radius:(<span class="built_in">NSInteger</span>)radius</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CIContext</span> *context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">CIImage</span> *inputImage = [[<span class="built_in">CIImage</span> alloc] initWithImage:image];</span><br><span class="line">    <span class="built_in">CIFilter</span> *filter;</span><br><span class="line">    <span class="keyword">if</span> (name.length != <span class="number">0</span>) &#123;</span><br><span class="line">        filter = [<span class="built_in">CIFilter</span> filterWithName:name];</span><br><span class="line">        [filter setValue:inputImage forKey:kCIInputImageKey];</span><br><span class="line">        <span class="keyword">if</span> (![name isEqualToString:<span class="string">@"CIMedianFilter"</span>]) &#123;</span><br><span class="line">            [filter setValue:@(radius) forKey:<span class="string">@"inputRadius"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">CIImage</span> *result = [filter valueForKey:kCIOutputImageKey];</span><br><span class="line">        <span class="built_in">CGImageRef</span> cgImage = [context createCGImage:result fromRect:[result extent]];</span><br><span class="line">        <span class="built_in">UIImage</span> *resultImage = [<span class="built_in">UIImage</span> imageWithCGImage:cgImage];</span><br><span class="line">        <span class="built_in">CGImageRelease</span>(cgImage);</span><br><span class="line">        <span class="keyword">return</span> resultImage;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**7.**创建一张实时模糊效果 View (毛玻璃效果)</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Avilable in iOS 8.0 and later</span></span><br><span class="line">+ (<span class="built_in">UIVisualEffectView</span> *)effectViewWithFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIBlurEffect</span> *effect = [<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleLight</span>];</span><br><span class="line">    <span class="built_in">UIVisualEffectView</span> *effectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:effect];</span><br><span class="line">    effectView.frame = frame;</span><br><span class="line">    <span class="keyword">return</span> effectView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**8.**设置Label的行间距</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)setLineSpaceWithString:(<span class="built_in">UILabel</span> *)label</span><br><span class="line">&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">NSMutableAttributedString</span> *attributedString =</span><br><span class="line">    [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:label.text];</span><br><span class="line">    <span class="built_in">NSMutableParagraphStyle</span> *paragraphStyle =  [[<span class="built_in">NSMutableParagraphStyle</span> alloc] init];</span><br><span class="line">    [paragraphStyle setLineSpacing:<span class="number">3</span>];</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//调整行间距</span></span><br><span class="line">    [attributedString addAttribute:<span class="built_in">NSParagraphStyleAttributeName</span></span><br><span class="line">                             value:paragraphStyle</span><br><span class="line">                             range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [label.text length])];</span><br><span class="line">    label.attributedText = attributedString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>**9.**让Plain风格的TableView的区头可以”不悬停”:</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView </span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span>(scrollView == <span class="keyword">self</span>.myTab) &#123;</span><br><span class="line">         <span class="built_in">CGFloat</span> sectionHeaderHeight = <span class="number">40</span>;</span><br><span class="line">         <span class="keyword">if</span> (scrollView.contentOffset.y=<span class="number">0</span>) &#123;</span><br><span class="line">              </span><br><span class="line">             scrollView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(-scrollView.contentOffset.y, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scrollView.contentOffset.y&gt;=sectionHeaderHeight) &#123;</span><br><span class="line">              </span><br><span class="line">             scrollView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(-sectionHeaderHeight, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/08/iOS开发——实用性技巧/" data-id="cjptr3x8q00ealyz9rc1k5jlf" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/实用性技巧/">实用性技巧</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——大大节省代码量的小技巧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/30/iOS开发——大大节省代码量的小技巧/" class="article-date">
  <time datetime="2016-06-30T01:05:04.000Z" itemprop="datePublished">2016-06-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/30/iOS开发——大大节省代码量的小技巧/">iOS开发——大大节省代码量的小技巧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>总结一些开发中的常用方法，大量节省开发时间</p>
<p>&lt;!--more--&gt;</p>
<ul>
<li><strong>1.</strong> 判断手机号码格式是否正确，利用正则表达式验证</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isMobileNumber:(<span class="built_in">NSString</span> *)mobileNum</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (mobileNum.length != <span class="number">11</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号码:</span></span><br><span class="line"><span class="comment">     * 13[0-9], 14[5,7], 15[0, 1, 2, 3, 5, 6, 7, 8, 9], 17[6, 7, 8], 18[0-9], 170[0-9]</span></span><br><span class="line"><span class="comment">     * 移动号段: 134,135,136,137,138,139,150,151,152,157,158,159,182,183,184,187,188,147,178,1705</span></span><br><span class="line"><span class="comment">     * 联通号段: 130,131,132,155,156,185,186,145,176,1709</span></span><br><span class="line"><span class="comment">     * 电信号段: 133,153,180,181,189,177,1700</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NSString</span> *MOBILE = <span class="string">@"^1(3[0-9]|4[57]|5[0-35-9]|8[0-9]|70)\d&#123;8&#125;$"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中国移动：China Mobile</span></span><br><span class="line"><span class="comment">     * 134,135,136,137,138,139,150,151,152,157,158,159,182,183,184,187,188,147,178,1705</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NSString</span> *CM = <span class="string">@"(^1(3[4-9]|4[7]|5[0-27-9]|7[8]|8[2-478])\d&#123;8&#125;$)|(^1705\d&#123;7&#125;$)"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中国联通：China Unicom</span></span><br><span class="line"><span class="comment">     * 130,131,132,155,156,185,186,145,176,1709</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NSString</span> *CU = <span class="string">@"(^1(3[0-2]|4[5]|5[56]|7[6]|8[56])\d&#123;8&#125;$)|(^1709\d&#123;7&#125;$)"</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中国电信：China Telecom</span></span><br><span class="line"><span class="comment">     * 133,153,180,181,189,177,1700</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">NSString</span> *CT = <span class="string">@"(^1(33|53|77|8[019])\d&#123;8&#125;$)|(^1700\d&#123;7&#125;$)"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *regextestmobile = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, MOBILE];</span><br><span class="line">    <span class="built_in">NSPredicate</span> *regextestcm = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, CM];</span><br><span class="line">    <span class="built_in">NSPredicate</span> *regextestcu = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, CU];</span><br><span class="line">    <span class="built_in">NSPredicate</span> *regextestct = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, CT];</span><br><span class="line">    <span class="keyword">if</span> (([regextestmobile evaluateWithObject:mobileNum] == <span class="literal">YES</span>)</span><br><span class="line">        || ([regextestcm evaluateWithObject:mobileNum] == <span class="literal">YES</span>)</span><br><span class="line">        || ([regextestct evaluateWithObject:mobileNum] == <span class="literal">YES</span>)</span><br><span class="line">        || ([regextestcu evaluateWithObject:mobileNum] == <span class="literal">YES</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>2.</strong> 判断邮箱格式是否正确，利用正则表达式验证</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isAvailableEmail:(<span class="built_in">NSString</span> *)email</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *emailRegex = <span class="string">@"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]&#123;2,4&#125;"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *emailTest = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, emailRegex];</span><br><span class="line">    <span class="keyword">return</span> [emailTest evaluateWithObject:email];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>3.</strong> 判断字符串中是否含有空格</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isHaveSpaceInString:(<span class="built_in">NSString</span> *)string&#123;</span><br><span class="line">    <span class="built_in">NSRange</span> _range = [string rangeOfString:<span class="string">@" "</span>];</span><br><span class="line">    <span class="keyword">if</span> (_range.location != <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>4.</strong> 判断字符串中是否含有中文</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isHaveChineseInString:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; [string length]; i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> a = [string characterAtIndex:i];</span><br><span class="line">        <span class="keyword">if</span> (a &gt; <span class="number">0x4e00</span> &amp;&amp; a &lt; <span class="number">0x9fff</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>5.</strong> 判断字符串是否全部为数字</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isAllNum:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unichar</span> c;</span><br><span class="line">    for (int i=0; i&lt;string.length; i++) &#123;         c="[string characterAtIndex:i];"         if (!isdigit(c)) &#123;=""             return no;=""         &#125;=""     &#125;=""     return yes;="" &#125;&lt;="" pre=""&gt;&lt;p&gt;判断是否是纯数字&lt;/p&gt;&lt;pre class="brush:js;toolbar:false"&gt;+ (BOOL)isPureInteger:(NSString *)str &#123;</span><br><span class="line">    <span class="built_in">NSScanner</span> *scanner = [<span class="built_in">NSScanner</span> scannerWithString:str];</span><br><span class="line">    <span class="built_in">NSInteger</span> val;</span><br><span class="line">    <span class="keyword">return</span> [scanner scanInteger:&amp;val] &amp;&amp; [scanner isAtEnd];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>6.</strong> 过滤一些特殊字符 似乎只能去除头尾的特殊字符(不准)</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSString</span> *)filterSpecialWithString:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义一个特殊字符的集合</span></span><br><span class="line">    <span class="built_in">NSCharacterSet</span> *set = [<span class="built_in">NSCharacterSet</span> characterSetWithCharactersInString: @ <span class="string">"@／：；: ;（）?「」＂、[]&#123;&#125;#%-*+=_|~＜＞$?^?'@#$%^&amp;*()_+'"</span>];</span><br><span class="line">    <span class="comment">// 过滤字符串的特殊字符</span></span><br><span class="line">    <span class="built_in">NSString</span> *newString = [string stringByTrimmingCharactersInSet:set];</span><br><span class="line">    <span class="keyword">return</span> newString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>7.</strong> 让iOS应用直接退出</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)backOutApp &#123;</span><br><span class="line">    <span class="built_in">UIWindow</span> *window = [[<span class="built_in">UIApplication</span> sharedApplication].delegate window];</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span>f animations:^&#123;</span><br><span class="line">        window.alpha = <span class="number">0</span>;</span><br><span class="line">    &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">        exit(<span class="number">0</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>8.</strong> NSArray 快速求总和、最大值、最小值、平均值</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSString</span> *)caculateArray:(<span class="built_in">NSArray</span> *)array</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> sum = [[array valueForKeyPath:<span class="string">@"@sum.floatValue"</span>] floatValue];</span><br><span class="line">    <span class="built_in">CGFloat</span> avg = [[array valueForKeyPath:<span class="string">@"@avg.floatValue"</span>] floatValue];</span><br><span class="line">    <span class="built_in">CGFloat</span> max =[[array valueForKeyPath:<span class="string">@"@max.floatValue"</span>] floatValue];</span><br><span class="line">    <span class="built_in">CGFloat</span> min =[[array valueForKeyPath:<span class="string">@"@min.floatValue"</span>] floatValue];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%fn%fn%fn%f"</span>,sum,avg,max,min);</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%f"</span>,sum];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>9.</strong> 验证身份证</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)checkIdentityCardNo:(<span class="built_in">NSString</span>*)value &#123;</span><br><span class="line">    value = [value stringByTrimmingCharactersInSet:[<span class="built_in">NSCharacterSet</span> whitespaceAndNewlineCharacterSet]];</span><br><span class="line">    <span class="built_in">NSInteger</span> length =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        length = value.length;</span><br><span class="line">        <span class="keyword">if</span> (length !=<span class="number">15</span> &amp;&amp; length !=<span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 省份代码</span></span><br><span class="line">    <span class="built_in">NSArray</span> *areasArray =@[<span class="string">@"11"</span>,<span class="string">@"12"</span>, <span class="string">@"13"</span>,<span class="string">@"14"</span>, <span class="string">@"15"</span>,<span class="string">@"21"</span>, <span class="string">@"22"</span>,<span class="string">@"23"</span>, <span class="string">@"31"</span>,<span class="string">@"32"</span>, <span class="string">@"33"</span>,<span class="string">@"34"</span>, <span class="string">@"35"</span>,<span class="string">@"36"</span>, <span class="string">@"37"</span>,<span class="string">@"41"</span>, <span class="string">@"42"</span>,<span class="string">@"43"</span>, <span class="string">@"44"</span>,<span class="string">@"45"</span>, <span class="string">@"46"</span>,<span class="string">@"50"</span>, <span class="string">@"51"</span>,<span class="string">@"52"</span>, <span class="string">@"53"</span>,<span class="string">@"54"</span>, <span class="string">@"61"</span>,<span class="string">@"62"</span>, <span class="string">@"63"</span>,<span class="string">@"64"</span>, <span class="string">@"65"</span>,<span class="string">@"71"</span>, <span class="string">@"81"</span>,<span class="string">@"82"</span>, <span class="string">@"91"</span>];</span><br><span class="line">    <span class="built_in">NSString</span> *valueStart2 = [value substringToIndex:<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">BOOL</span> areaFlag =<span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *areaCode <span class="keyword">in</span> areasArray) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([areaCode isEqualToString:valueStart2]) &#123;</span><br><span class="line">            areaFlag =<span class="literal">YES</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!areaFlag) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSRegularExpression</span> *regularExpression;</span><br><span class="line">    <span class="built_in">NSUInteger</span> numberofMatch;</span><br><span class="line">    <span class="built_in">NSInteger</span> year =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">            year = [[value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">2</span>)] integerValue] +<span class="number">1900</span>;</span><br><span class="line">            <span class="keyword">if</span> (year %<span class="number">4</span> ==<span class="number">0</span> || (year <span class="number">0</span> ==<span class="number">0</span> &amp;&amp; year %<span class="number">4</span> ==<span class="number">0</span>)) &#123;</span><br><span class="line">                regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@"^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;$"</span></span><br><span class="line">                                                                       options:<span class="built_in">NSRegularExpressionCaseInsensitive</span></span><br><span class="line">                                                                         error:<span class="literal">nil</span>];<span class="comment">//测试出生日期的合法性</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@"^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;$"</span></span><br><span class="line">                                                                       options:<span class="built_in">NSRegularExpressionCaseInsensitive</span></span><br><span class="line">                                                                         error:<span class="literal">nil</span>];<span class="comment">//测试出生日期的合法性</span></span><br><span class="line">            &#125;</span><br><span class="line">            numberofMatch = [regularExpression numberOfMatchesInString:value                                                 options:<span class="built_in">NSMatchingReportProgress</span></span><br><span class="line">                           range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, value.length)];</span><br><span class="line">            <span class="keyword">if</span>(numberofMatch &gt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">            year = [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">4</span>)].intValue;</span><br><span class="line">            <span class="keyword">if</span> (year %<span class="number">4</span> ==<span class="number">0</span> || (year <span class="number">0</span> ==<span class="number">0</span> &amp;&amp; year %<span class="number">4</span> ==<span class="number">0</span>)) &#123;</span><br><span class="line">                regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@"^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;[0-9Xx]$"</span></span><br><span class="line">options:<span class="built_in">NSRegularExpressionCaseInsensitive</span>                                                                     error:<span class="literal">nil</span>];<span class="comment">//测试出生日期的合法性</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                regularExpression = [[<span class="built_in">NSRegularExpression</span> alloc]initWithPattern:<span class="string">@"^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;[0-9Xx]$"</span>                                                                      options:<span class="built_in">NSRegularExpressionCaseInsensitive</span>                                                                     error:<span class="literal">nil</span>];<span class="comment">//测试出生日期的合法性</span></span><br><span class="line">            &#125;</span><br><span class="line">            numberofMatch = [regularExpression numberOfMatchesInString:value                                                 options:<span class="built_in">NSMatchingReportProgress</span>                                                     range:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, value.length)];</span><br><span class="line">            <span class="keyword">if</span>(numberofMatch &gt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> S = ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">10</span>,<span class="number">1</span>)].intValue) *<span class="number">7</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">1</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">11</span>,<span class="number">1</span>)].intValue) *<span class="number">9</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">2</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">12</span>,<span class="number">1</span>)].intValue) *<span class="number">10</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">3</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">13</span>,<span class="number">1</span>)].intValue) *<span class="number">5</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">4</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">14</span>,<span class="number">1</span>)].intValue) *<span class="number">8</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">5</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">15</span>,<span class="number">1</span>)].intValue) *<span class="number">4</span> + ([value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">6</span>,<span class="number">1</span>)].intValue + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">16</span>,<span class="number">1</span>)].intValue) *<span class="number">2</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">7</span>,<span class="number">1</span>)].intValue *<span class="number">1</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">8</span>,<span class="number">1</span>)].intValue *<span class="number">6</span> + [value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">9</span>,<span class="number">1</span>)].intValue *<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">int</span> Y = S ;</span><br><span class="line">                <span class="built_in">NSString</span> *M =<span class="string">@"F"</span>;</span><br><span class="line">                <span class="built_in">NSString</span> *JYM =<span class="string">@"10X98765432"</span>;</span><br><span class="line">                M = [JYM substringWithRange:<span class="built_in">NSMakeRange</span>(Y,<span class="number">1</span>)];<span class="comment">// 判断校验位</span></span><br><span class="line">                <span class="keyword">if</span> ([M isEqualToString:[value substringWithRange:<span class="built_in">NSMakeRange</span>(<span class="number">17</span>,<span class="number">1</span>)]]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">YES</span>;<span class="comment">// 检测ID的校验位</span></span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/30/iOS开发——大大节省代码量的小技巧/" data-id="cjptr3x8o00e5lyz973n9a5za" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/常用小技巧/">常用小技巧</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Swift学习笔记（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/26/Swift学习笔记（二）/" class="article-date">
  <time datetime="2016-06-26T12:43:26.000Z" itemprop="datePublished">2016-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/26/Swift学习笔记（二）/">Swift学习笔记（二）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>###函数和闭包</p>
<ul>
<li>使用<code>func</code>来声明一个函数，使用名字和参数来调用函数。使用<code>-&gt;</code>来指定函数返回值的类型。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(name: String, food: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello <span class="subst">\(name)</span>, let's eat some <span class="subst">\(food)</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet(<span class="string">"Lin"</span>, food: <span class="string">"fruit"</span>)</span><br></pre></td></tr></table></figure></p>
<p>&lt;!--more--&gt;</p>
<ul>
<li>使用元组来让一个函数返回多个值。该元组的元素可以用名称或数字来表示。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateStatistics</span><span class="params">(scores: [Int])</span></span> -&gt; (<span class="built_in">min</span>: <span class="type">Int</span>, <span class="built_in">max</span>: <span class="type">Int</span>, sum: <span class="type">Int</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">min</span> = scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">max</span> = scores[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> score <span class="keyword">in</span> scores &#123;</span><br><span class="line">        <span class="keyword">if</span> score &gt; <span class="built_in">max</span>&#123;</span><br><span class="line">         <span class="built_in">max</span> = score</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> score &lt; <span class="built_in">min</span> &#123;</span><br><span class="line">            <span class="built_in">min</span> = score</span><br><span class="line">        &#125;</span><br><span class="line">        sum += score</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">min</span>, <span class="built_in">max</span>, sum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> statistics = calculateStatistics([<span class="number">10</span>, <span class="number">21</span>, <span class="number">25</span>, <span class="number">50</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(statistics.<span class="built_in">max</span>)</span><br><span class="line"><span class="built_in">print</span>(statistics.<span class="number">2</span>)   <span class="comment">//表示返回值的位置</span></span><br><span class="line"><span class="built_in">print</span>(statistics.sum)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>函数可以带有可变个数的参数，这些参数在函数内表现为数组的形式</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sumOf</span><span class="params">(numbers: Int...)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        sum += number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line">sumOf()</span><br><span class="line">sumOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算平均值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">averageCalculate</span><span class="params">(numbers: [Int])</span></span> -&gt; <span class="type">Float</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> average: <span class="type">Float</span> = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        sum += number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> doubleSum = <span class="type">Float</span>(sum)</span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">count</span> = <span class="type">Float</span> (numbers.<span class="built_in">count</span>)</span><br><span class="line">    average = doubleSum / <span class="built_in">count</span></span><br><span class="line">    <span class="keyword">return</span> average</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>函数可以嵌套,被嵌套的函数可以访问外侧函数的变量。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnFifteen</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y += <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    add()</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">returnFifteen()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>函数是第一等类型，这意味着函数可以作为另一个函数的返回值。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">makeIncrementer</span><span class="params">()</span></span> -&gt; (<span class="type">Int</span> -&gt; <span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">addOne</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> number + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> addOne</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> incrementer = makeIncrementer()</span><br><span class="line">incrementer(<span class="number">7</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>函数也可以当做参数传入另一个函数。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasAnyMatches</span><span class="params">(list: [Int], condition: Int -&gt; Bool)</span></span> -&gt; <span class="type">Bool</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> condition(item) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lessThanTen</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> number &gt; <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> numbers = [<span class="number">20</span>, <span class="number">19</span>,<span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>]</span><br><span class="line">hasAnyMatches(numbers, condition: lessThanTen)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>函数实际上是一种特殊的闭包:它是一段能之后被调取的代码。闭包中的代码能访问闭包所建作用域中能得到的变量和函数，即使闭包是在一个不同的作用域被执行的 - 你已经在嵌套函数例子中所看到。你可以使用<code>{}</code>来创建一个匿名闭包。使用<code>in</code>将参数和返回值类型声明与闭包函数体进行分离。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">numbers.<span class="built_in">map</span>(&#123;</span><br><span class="line">    (number: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> number % <span class="number">2</span> == <span class="number">0</span> &amp;&amp; number != <span class="number">0</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">numbers.<span class="built_in">map</span>(&#123;</span><br><span class="line">    (number: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">let</span> result = number * <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>有很多种创建更简洁的闭包的方法。如果一个闭包的类型已知，比如作为一个回调函数，你可以忽略参数的类型和返回值。单个语句闭包会把它语句的值当做结果返回。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mappedNumbers = numbers.<span class="built_in">map</span>(&#123; number <span class="keyword">in</span> <span class="number">3</span> * number &#125;)</span><br><span class="line"><span class="built_in">print</span>(mappedNumbers)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>你可以通过参数位置而不是参数名字来引用参数——这个方法在非常短的闭包中非常有用。当一个闭包作为最后一个参数传给一个函数的时候，它可以直接跟在括号后面。当一个闭包是传给函数的唯一参数，你可以完全忽略括号。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sortedNumbers = numbers.<span class="built_in">sort</span> &#123;$<span class="number">0</span> &lt; $<span class="number">1</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(sortedNumbers)</span><br></pre></td></tr></table></figure></p>
<h3>对象和类</h3>
<ul>
<li>使用<code>class</code>和类名来创建一个类。类中属性的声明和常量、变量声明一样，唯一的区别就是它们的上下文是类。同样，方法和函数声明也一样。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> word = <span class="string">"Hi"</span></span><br><span class="line">    <span class="keyword">var</span> numberOfSides = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A shape with <span class="subst">\(numberOfSides)</span> sides"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">phrase</span><span class="params">(name: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"<span class="subst">\(word)</span>, <span class="subst">\(name)</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>要创建一个类的实例，在类名后面加上括号。使用点语法来访问实例的属性和方法。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shape = <span class="type">Shape</span>()</span><br><span class="line">shape.numberOfSides = <span class="number">7</span></span><br><span class="line"><span class="keyword">var</span> shapeDescription = shape.simpleDescription()</span><br><span class="line"><span class="keyword">var</span> shapePhrase = shape.phrase(<span class="string">"Lin"</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>这个版本的<code>Shape</code>类缺少了一些重要的东西：一个构造函数来初始化类实例。使用<code>init</code>来创建一个构造器。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfSides: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span> (name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A shape with <span class="subst">\(numberOfSides)</span> sides"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>注意<code>self</code>被用来区别实例变量,当你创建实例的时候，像传入函数参数一样给类传入构造器的参数。</p>
</li>
<li>
<p>子类的定义方法是在它们的类名后面加上父类的名字，用冒号分割。创建类的时候并不需要一个标准的根类，所以你可以忽略父类。</p>
</li>
<li>
<p>子类如果要重写父类的方法的话，需要用<code>override</code>标记——如果没有添加<code>override</code>就重写父类方法的话编译器会报错。编译器同样会检测<code>override</code>标记的方法是否确实在父类中。</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength = sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">area</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sideLength * sideLength</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A square with sides of length <span class="subst">\(sideLength)</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> test = <span class="type">Square</span>(sideLength: <span class="number">1.2</span>, name: <span class="string">"Lin"</span>)</span><br><span class="line">test.area()</span><br><span class="line">test.simpleDescription()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(radius: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.radius = radius</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides = <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">area</span><span class="params">()</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius * radius * <span class="number">3.1415</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"this is a circle named <span class="subst">\(name)</span>, area is <span class="subst">\(area()</span>)"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> testCircle = <span class="type">Circle</span>(radius: <span class="number">7.24</span>, name: <span class="string">"Lin"</span>)</span><br><span class="line">testCircle.simpleDescription()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>除了储存简单的属性之外，属性可以有 getter 和 setter 。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EquilateralTriangle</span>: <span class="title">NamedShape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sideLength: <span class="type">Double</span> = <span class="number">0.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(sideLength: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.sideLength = sideLength</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(name: name)</span><br><span class="line">        numberOfSides = <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> perimeter: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3.0</span> * sideLength</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sideLength = newValue / <span class="number">3.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">simpleDescription</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"An equilateral triangle with sides of length <span class="subst">\(sideLength)</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> triangle = <span class="type">EquilateralTriangle</span>(sideLength: <span class="number">9.0</span>, name: <span class="string">"Triangle"</span>)</span><br><span class="line">triangle.perimeter</span><br><span class="line">triangle.perimeter = <span class="number">99.0</span></span><br><span class="line">triangle.sideLength</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>在<code>perimeter</code>的 <code>setter</code> 中，新值的名字是<code>newValue</code>。你可以在set之后显式的设置一个名字。</p>
</li>
<li>
<p>注意EquilateralTriangle类的构造器执行了三步：</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置子类声明的属性值</span><br><span class="line">调用父类的构造器</span><br><span class="line">改变父类定义的属性值。其他的工作比如调用方法、getters和setters也可以在这个阶段完成。</span><br></pre></td></tr></table></figure></p>
<ul>
<li>如果你不需要计算属性，但是仍然需要在设置一个新值之前或者之后运行代码，使用<code>willSet</code>和<code>didSet</code>。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SquareAndTriangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> triangle: <span class="type">EquilateralTriangle</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            square.sideLength = newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> square: <span class="type">Square</span> &#123;</span><br><span class="line">        <span class="keyword">willSet</span> &#123;</span><br><span class="line">            triangle.sideLength = newValue.sideLength</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(size: <span class="type">Double</span>, name: <span class="type">String</span>) &#123;</span><br><span class="line">        square = <span class="type">Square</span>(sideLength: size, name: name)</span><br><span class="line">        triangle = <span class="type">EquilateralTriangle</span>(sideLength: size, name: name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> triangleAndSquare = <span class="type">SquareAndTriangle</span>(size: <span class="number">3.0</span>, name: <span class="string">"T&amp;S"</span>)</span><br><span class="line">triangleAndSquare.square.sideLength</span><br><span class="line">triangleAndSquare.triangle.sideLength</span><br><span class="line">triangleAndSquare.square = <span class="type">Square</span>(sideLength: <span class="number">8.0</span>, name: <span class="string">"Lix"</span>)</span><br><span class="line">triangleAndSquare.triangle.sideLength</span><br></pre></td></tr></table></figure></p>
<ul>
<li>处理变量的可选值时，你可以在操作（比如方法、属性和子脚本）之前加<code>?</code>。如果?之前的值是<code>nil</code>，<code>?</code>后面的东西都会被忽略，并且整个表达式返回<code>nil</code>。否则，<code>?</code>之后的东西都会被运行。在这两种情况下，整个表达式的值也是一个可选值。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> optionalSquare: <span class="type">Square</span>? = <span class="type">Square</span>(sideLength: <span class="number">8.0</span>, name: <span class="string">"Lin"</span>)</span><br><span class="line"><span class="keyword">let</span> sideLength = optionalSquare?.sideLength</span><br><span class="line">sideLength</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/26/Swift学习笔记（二）/" data-id="cjptr3x8j00dvlyz9trqk83n1" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift学习/">Swift学习</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Swift学习笔记（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/24/Swift学习笔记（一）/" class="article-date">
  <time datetime="2016-06-24T13:58:43.000Z" itemprop="datePublished">2016-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/24/Swift学习笔记（一）/">Swift学习笔记（一）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>简单记录学习Swift的笔记</p>
<p>###简单值</p>
<ul>
<li>
<p>使用<code>let</code>来声明常量，使用<code>var</code>来声明变量。</p>
</li>
<li>
<p>常量或者变量的类型，必须和你赋给它们的值一样。然而，不用明确地声明类型，声明的同时赋值的话，编译器会自动推断类型。</p>
</li>
<li>
<p>如果初始值没有提供足够的信息（或者没有初始值），那你需要在变量后面声明类型，用冒号分割。</p>
</li>
<li>
<p>值永远不会被隐式转换为其他类型。如果你需要把一个值转换成其他类型，请显式转换。</p>
</li>
</ul>
<p>例如</p>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> label = <span class="string">"The width is"</span></span><br><span class="line"><span class="keyword">let</span> width = <span class="number">94</span></span><br><span class="line"><span class="keyword">let</span> widthLabel = label + <span class="type">String</span>(width)</span><br></pre></td></tr></table></figure></p>
<p>&lt;!--more--&gt;</p>
<ul>
<li>有一种更简单的把值转换成字符串的方法：把值写到括号中，并且在括号之前写一个反斜杠。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstWord = <span class="string">"Lin"</span></span><br><span class="line"><span class="keyword">let</span> secondWord = <span class="string">"i love <span class="subst">\(firstWord)</span>"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>使用方括号[]来创建数组和字典，并使用下标或者键（key）来访问元素。最后一个元素后面允许有个逗号。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shoppingList = [<span class="string">"catfish"</span>, <span class="string">"water"</span>, <span class="string">"tulips"</span>, <span class="string">"blue paint"</span>]</span><br><span class="line">shoppingList[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> occupations = [</span><br><span class="line">    <span class="string">"Malcolm"</span>: <span class="string">"Captain"</span>,</span><br><span class="line">    <span class="string">"Kaylee"</span>: <span class="string">"Mechanic"</span>,</span><br><span class="line">]</span><br><span class="line">occupations[<span class="string">"Jayne"</span>] = <span class="string">"Public Relations"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>要创建一个空数组或者字典，使用初始化语法。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> emptyArray = [<span class="type">String</span>]()</span><br><span class="line"><span class="keyword">let</span> emptyDictionary = [<span class="type">String</span>: <span class="type">String</span>]()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>如果类型信息可以被推断出来，你可以用<code>[]</code>和<code>[:]</code>来创建空数组和空字典——就像你声明变量或者给函数传参数的时候一样。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shoppingList = []</span><br><span class="line">occupations = [:]</span><br></pre></td></tr></table></figure></p>
<h3>控制流</h3>
<ul>
<li>
<p>使用<code>if</code>和<code>switch</code>来进行条件操作，使用<code>for-in</code>、<code>for</code>、<code>while</code>和<code>repeat-while</code>来进行循环。</p>
</li>
<li>
<p>包裹条件和循环变量括号可以省略，但是语句体的大括号是必须的。</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> individualScores = [<span class="number">75</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">87</span>, <span class="number">12</span>]</span><br><span class="line"><span class="keyword">var</span> teamScore = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> score <span class="keyword">in</span> individualScores &#123;</span><br><span class="line">    <span class="keyword">if</span> score &gt; <span class="number">50</span> &#123;</span><br><span class="line">        teamScore += <span class="number">3</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        teamScore += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(teamScore)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>在<code>if</code>语句中，条件必须是一个布尔表达式</p>
</li>
<li>
<p>你可以一起使用<code>if</code>和<code>let</code>来处理值缺失的情况。这些值可由可选值来代表。一个可选的值是一个具体的值或者是<code>nil</code>以表示值缺失。在类型后面加一个问号来标记这个变量的值是可选的。</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> optionalString: <span class="type">String</span>? = <span class="string">"Hello"</span></span><br><span class="line"><span class="built_in">print</span>(optionalString == <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> optionalName: <span class="type">String</span>? = <span class="string">"Lin"</span></span><br><span class="line"><span class="keyword">var</span> greeting = <span class="string">"Hello!"</span></span><br><span class="line"></span><br><span class="line">optionalName = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">if</span> optionalName == <span class="literal">nil</span> &#123;</span><br><span class="line">   greeting = <span class="string">"Lix love Lin 🙄"</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name = optionalName</span><br><span class="line">    greeting = <span class="string">"<span class="subst">\(name)</span> love Lix 🌚"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>如果变量的可选值是<code>nil</code>，条件会判断为<code>false</code>，大括号中的代码会被跳过。如果不是<code>nil</code>，会将值赋给<code>let</code>后面的常量，这样代码块中就可以使用这个值了。</p>
</li>
<li>
<p>另一种处理可选值的方法是通过使用<code>??</code>操作符来提供一个默认值。如果可选值缺失的话，可以使用默认值来代替。</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nickName: <span class="type">String</span>? = <span class="string">"球球 🤗"</span></span><br><span class="line"><span class="keyword">let</span> fullName: <span class="type">String</span>? = <span class="string">"LinHong"</span></span><br><span class="line"><span class="keyword">let</span> informalGreeting = <span class="string">"Hi <span class="subst">\(nickName ?? fullName)</span>"</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>switch</code>支持任意类型的数据以及各种比较操作——不仅仅是整数以及测试相等。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sport = <span class="string">"basketball"</span></span><br><span class="line"><span class="keyword">switch</span> sport &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"football"</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"this is the first sport"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">case</span> <span class="string">"running"</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Lin was running everyday"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> x <span class="keyword">where</span> x.hasSuffix(<span class="string">"ball"</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Lix play <span class="subst">\(sport)</span> everyday"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"keep moving"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>运行<code>switch</code>中匹配到的子句之后，程序会退出<code>switch</code>语句，并不会继续向下运行，所以不需要在每个子句结尾写<code>break</code>。</p>
</li>
<li>
<p>你可以使用<code>for-in</code>来遍历字典，需要两个变量来表示每个键值对。字典是一个无序的集合，所以他们的键和值以任意顺序迭代结束。</p>
</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> interestingNumbers = [</span><br><span class="line">    <span class="string">"Prime"</span>: [<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>],</span><br><span class="line">    <span class="string">"Fibonacci"</span>: [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">13</span>],</span><br><span class="line">    <span class="string">"Square"</span>: [<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">16</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> largest = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> numberClass = <span class="string">"number"</span></span><br><span class="line"><span class="keyword">for</span> (kind, numbers) <span class="keyword">in</span> interestingNumbers &#123;</span><br><span class="line">    <span class="keyword">for</span> number <span class="keyword">in</span> numbers &#123;</span><br><span class="line">        <span class="keyword">if</span> number &gt; largest &#123;</span><br><span class="line">            largest = number</span><br><span class="line">            numberClass = kind</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(largest)</span><br><span class="line"><span class="built_in">print</span>(numberClass)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>使用<code>while</code>来重复运行一段代码直到不满足条件。循环条件也可以在结尾，保证能至少循环一次。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span> n &lt; <span class="number">100</span> &#123;</span><br><span class="line">    n = n * <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m = <span class="number">2</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line"> m = m * <span class="number">2</span></span><br><span class="line">&#125; <span class="keyword">while</span> m &lt; <span class="number">100</span>     <span class="comment">//循环条件可以在结尾，至少保证循环一次</span></span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>你可以在循环中使用<code>..&lt;</code>来表示范围。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">4</span> &#123;</span><br><span class="line">    total += i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>使用<code>..&lt;</code>创建的范围不包含上界，如果想包含的话需要使用<code>...</code>。</li>
</ul>
<p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...<span class="number">100</span> &#123;</span><br><span class="line">    total += i</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/24/Swift学习笔记（一）/" data-id="cjptr3x4b0016lyz9pl3lfx9q" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift学习/">Swift学习</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——Core-Graphics绘图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/04/iOS开发——Core-Graphics绘图/" class="article-date">
  <time datetime="2016-06-04T12:12:54.000Z" itemprop="datePublished">2016-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/04/iOS开发——Core-Graphics绘图/">iOS开发——Core Graphics绘图</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>我们在搭建UI界面时，有很多时候，我们会用到iOS自带的绘图功能来完成一些界面的效果，很常用也很方便。今天我们在这里就一起讨论一下iOS的绘图功能。</p>
<ul>
<li>
<p>CoreGraphics也称为Quartz 2D 是UIKit下的主要绘图系统，频繁的用于绘制自定义视图。Core Graphics是高度集成于UIView和其他UIKit部分的。Core Graphics数据结构和函数可以通过前缀CG来识别。</p>
</li>
<li>
<p>视图可以通过子视图、图层或实现drawRect：方法来表现内容，如果说实现了drawRect：方法，那么最好就不要混用其他方法了，如图层和子视图。自定义绘图大部分是由UIKit或者Core Graphics来实现的。</p>
</li>
<li>
<p>由于像素是依赖于目标的，所以2D绘图并不能操作单独的像素，我们可以从上下文（Context）读取它。
绘图就好比在画布上拿着画笔机械的进行画画，通过制定不同的参数来进行不同的绘制。</p>
</li>
</ul>
<p>&lt;!--more--&gt;</p>
<h1>iOS常见的图形绘制</h1>
<ul>
<li>画线</li>
<li>画圆、圆弧、贝塞尔曲线</li>
<li>画矩形、椭圆形、多边形</li>
<li>绘制图片</li>
<li>绘制文字</li>
</ul>
<hr>
<h1>iOS绘图基础</h1>
<p>在绘图之前，我们先来了解一下几个基本的概念</p>
<ul>
<li>
<p>context：上下文，ios绘图的方法都需要传一个上下文context，这个context在重写uiview的drawRect的方法里调用UIGraphicsGetCurrentContext()获取</p>
</li>
<li>
<p>path：路径，ios绘图可以想象为你拿着一支笔去画图，画几条线或几个点从而形成一个路径，之后可以利用理解去填色或者描边</p>
</li>
<li>
<p>stroke,fill 描边和填充，每个路径都需要填充或者描边后才能在视图中看见，他们都各自有很多样式可以设置，常见的有颜色、粗细、渐变，连接样式等等。</p>
</li>
<li>
<p>画图可以使用默认路径画，或者单独创建path画图，对应画图的api并不完全相同，是两组名称相似的api，两组api常用的方法如下</p>
</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGContextMoveToPoint</span>   <span class="comment">//设置起点</span></span><br><span class="line"><span class="built_in">CGContextClosePath</span>     <span class="comment">//连接起点和当前点</span></span><br><span class="line"><span class="built_in">CGPathCreateMutable</span>    <span class="comment">//类似于 CGContextBeginPath</span></span><br><span class="line"><span class="built_in">CGPathMoveToPoint</span>      <span class="comment">//类似于 CGContextMoveToPoint</span></span><br><span class="line"><span class="built_in">CGPathAddLineToPoint</span>   <span class="comment">//类似于 CGContextAddLineToPoint</span></span><br><span class="line"><span class="built_in">CGPathAddCurveToPoint</span>  <span class="comment">//类似于 CGContextAddCurveToPoint</span></span><br><span class="line"><span class="built_in">CGPathAddEllipseInRect</span> <span class="comment">//类似于 CGContextAddEllipseInRect</span></span><br><span class="line"><span class="built_in">CGPathAddArc</span>           <span class="comment">//类似于 CGContextAddArc</span></span><br><span class="line"><span class="built_in">CGPathAddRect</span>          <span class="comment">//类似于 CGContextAddRect</span></span><br><span class="line"><span class="built_in">CGPathCloseSubpath</span>     <span class="comment">//类似于 CGContextClosePath</span></span><br><span class="line"><span class="built_in">CGContextAddPath</span>       <span class="comment">//函数把一个路径添加到graphics</span></span><br></pre></td></tr></table></figure></p>
<h2>画图步骤</h2>
<ul>
<li>获取context</li>
<li>设置Path</li>
<li>填充或描边路径</li>
</ul>
<h2>关于填充颜色 有三种方式</h2>
<ul>
<li>填充笔触，就是只给路径描边</li>
<li>根据路径填充颜色</li>
<li>填充笔触和颜色</li>
</ul>
<p><strong>填充颜色也分为非零绕数规则和奇偶规则，这个概念比较复杂难以解释，大家可以百度看看或者画几个图试试就明白。</strong></p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGContextStrokePath</span>(ctx);    <span class="comment">//描出路径</span></span><br><span class="line"><span class="built_in">CGContextFillPath</span>(ctx)       <span class="comment">//使用非零绕数规则填充当前路径</span></span><br><span class="line"><span class="built_in">CGContextDrawPath</span>	         <span class="comment">//两个参数决定填充规则，kCGPathFill表示用非零绕数规则，kCGPathEOFill表示用奇偶规则，kCGPathFillStroke表示填充，kCGPathEOFillStroke表示描线，不是填充</span></span><br><span class="line"><span class="built_in">CGContextEOFillPath</span>	         <span class="comment">//使用奇偶规则填充当前路径</span></span><br><span class="line"><span class="built_in">CGContextFillRect</span>	         <span class="comment">//填充指定的矩形</span></span><br><span class="line"><span class="built_in">CGContextFillRects</span>	         <span class="comment">//填充指定的一些矩形</span></span><br><span class="line"><span class="built_in">CGContextFillEllipseInRect</span>	  <span class="comment">//填充指定矩形中的椭圆</span></span><br></pre></td></tr></table></figure></p>
<h1>常见的图形绘制</h1>
<p><strong>准备工作</strong></p>
<ul>
<li>新建一个文件，继承UIView</li>
<li>重写<code>-(void)drawRect:(CGRect)rect</code>方法</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">super</span> drawRect:rect];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取ctx</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置画图相关样式参数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置笔触颜色</span></span><br><span class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> blackColor].CGColor);<span class="comment">//设置颜色有很多方法，我觉得这个方法最好用</span></span><br><span class="line">    <span class="comment">//设置笔触宽度</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">//设置填充色</span></span><br><span class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> purpleColor].CGColor);</span><br><span class="line">    <span class="comment">//设置拐点样式</span></span><br><span class="line">    <span class="comment">//    enum CGLineJoin &#123;</span></span><br><span class="line">    <span class="comment">//        kCGLineJoinMiter, //尖的，斜接</span></span><br><span class="line">    <span class="comment">//        kCGLineJoinRound, //圆</span></span><br><span class="line">    <span class="comment">//        kCGLineJoinBevel //斜面</span></span><br><span class="line">    <span class="comment">//    &#125;;</span></span><br><span class="line">    <span class="built_in">CGContextSetLineJoin</span>(ctx, kCGLineJoinRound);</span><br><span class="line">    <span class="comment">//Line cap 线的两端的样式</span></span><br><span class="line">    <span class="comment">//    enum CGLineCap &#123;</span></span><br><span class="line">    <span class="comment">//        kCGLineCapButt,</span></span><br><span class="line">    <span class="comment">//        kCGLineCapRound,</span></span><br><span class="line">    <span class="comment">//        kCGLineCapSquare</span></span><br><span class="line">    <span class="comment">//    &#125;;</span></span><br><span class="line">    <span class="built_in">CGContextSetLineCap</span>(ctx, kCGLineCapRound);</span><br><span class="line">    <span class="comment">//虚线线条样式</span></span><br><span class="line">    <span class="comment">//CGFloat lengths[] = &#123;10,10&#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画线</span></span><br><span class="line">    [<span class="keyword">self</span> drawLine:ctx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画圆、圆弧</span></span><br><span class="line">    [<span class="keyword">self</span> drawCircle:ctx];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画矩形,画椭圆，多边形</span></span><br><span class="line">    [<span class="keyword">self</span> drawShape:ctx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画图片</span></span><br><span class="line">    [<span class="keyword">self</span> drawPicture:ctx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画文字</span></span><br><span class="line">    [<span class="keyword">self</span> drawText:ctx];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2>画线</h2>
<p><strong>第一个方法我写的比较详细，写了使用path的方式和直接画线的方式。推荐使用path的方式画线。 另外，第一个方法也写了移动笔触画线和用点集合画线。后面方法只会涉及其中一种，因为方法都比较类似。</strong></p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//画线</span></span><br><span class="line">  -(<span class="keyword">void</span>)drawLine:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//画一条简单的线</span></span><br><span class="line">      <span class="built_in">CGPoint</span> points1[] = &#123;<span class="built_in">CGPointMake</span>(<span class="number">10</span>, <span class="number">30</span>),<span class="built_in">CGPointMake</span>(<span class="number">300</span>, <span class="number">30</span>)&#125;;</span><br><span class="line">      <span class="built_in">CGContextAddLines</span>(ctx,points1, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//画线方法1，使用CGContextAddLineToPoint画线，需要先设置一个起始点</span></span><br><span class="line">      <span class="comment">//设置起始点</span></span><br><span class="line">      <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">      <span class="comment">//添加一个点</span></span><br><span class="line">      <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">100</span>,<span class="number">50</span>);</span><br><span class="line">      <span class="comment">//在添加一个点，变成折线</span></span><br><span class="line">      <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">150</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//画线方法2</span></span><br><span class="line">      <span class="comment">//构造线路径的点数组</span></span><br><span class="line">      <span class="built_in">CGPoint</span> points2[] = &#123;<span class="built_in">CGPointMake</span>(<span class="number">60</span>, <span class="number">60</span>),<span class="built_in">CGPointMake</span>(<span class="number">80</span>, <span class="number">120</span>),<span class="built_in">CGPointMake</span>(<span class="number">20</span>, <span class="number">300</span>)&#125;;</span><br><span class="line">      <span class="built_in">CGContextAddLines</span>(ctx,points2, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//利用路径去画一组点（推荐使用路径的方式，虽然多了几行代码，但是逻辑更清晰了）</span></span><br><span class="line">      <span class="comment">//第一个路径</span></span><br><span class="line">      <span class="built_in">CGMutablePathRef</span> path1 = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">      <span class="built_in">CGPathMoveToPoint</span>(path1, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">0</span>, <span class="number">200</span>);</span><br><span class="line">      <span class="comment">//CGAffineTransformIdentity 类似于初始化一些参数</span></span><br><span class="line">      <span class="built_in">CGPathAddLineToPoint</span>(path1, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">100</span>, <span class="number">250</span>);</span><br><span class="line">      <span class="built_in">CGPathAddLineToPoint</span>(path1, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">310</span>, <span class="number">210</span>);</span><br><span class="line">      <span class="comment">//路径1加入context</span></span><br><span class="line">      <span class="built_in">CGContextAddPath</span>(ctx, path1);</span><br><span class="line">      <span class="comment">//path同样有方法CGPathAddLines(),和CGContextAddLines()差不多用户，可以自己试下</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//描出笔触</span></span><br><span class="line">      <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2>画矩形、椭圆形、多边形</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//画矩形,画椭圆，多边形</span></span><br><span class="line">-(<span class="keyword">void</span>)drawSharp:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> redColor].CGColor);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画椭圆，如果长宽相等就是圆</span></span><br><span class="line">    <span class="built_in">CGContextAddEllipseInRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">250</span>, <span class="number">50</span>, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//画矩形,长宽相等就是正方形</span></span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(ctx, <span class="built_in">CGRectMake</span>(<span class="number">70</span>, <span class="number">250</span>, <span class="number">50</span>, <span class="number">50</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//画多边形，多边形是通过path完成的</span></span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">    <span class="built_in">CGPathMoveToPoint</span>(path, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">120</span>, <span class="number">250</span>);</span><br><span class="line">    <span class="built_in">CGPathAddLineToPoint</span>(path, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">200</span>, <span class="number">250</span>);</span><br><span class="line">    <span class="built_in">CGPathAddLineToPoint</span>(path, &amp;<span class="built_in">CGAffineTransformIdentity</span>, <span class="number">180</span>, <span class="number">300</span>);</span><br><span class="line">    <span class="built_in">CGPathCloseSubpath</span>(path);</span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//填充</span></span><br><span class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>画图</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//画图片</span></span><br><span class="line">-(<span class="keyword">void</span>)drawPicture:(<span class="built_in">CGContextRef</span>)context&#123;</span><br><span class="line">    <span class="comment">/*图片*/</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"head.jpeg"</span>];</span><br><span class="line">    [image drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">100</span>)];<span class="comment">//在坐标中画出图片</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2>画文字</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//画文字</span></span><br><span class="line"> -(<span class="keyword">void</span>)drawText:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">//文字样式</span></span><br><span class="line">     <span class="built_in">UIFont</span> *font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">18</span>];</span><br><span class="line">     <span class="built_in">NSDictionary</span> *dict = @&#123;<span class="built_in">NSFontAttributeName</span>:font,</span><br><span class="line">                            <span class="built_in">NSForegroundColorAttributeName</span>:[<span class="built_in">UIColor</span> whiteColor]&#125;;</span><br><span class="line"></span><br><span class="line">     [<span class="string">@"hello world"</span> drawInRect:<span class="built_in">CGRectMake</span>(<span class="number">120</span> , <span class="number">350</span>, <span class="number">500</span>, <span class="number">50</span>) withAttributes:dict];</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h2>画圆、圆弧、贝塞尔曲线</h2>
<p><strong>画圆和圆弧是一回事，只是起点和重点位置不同，画圆画弧线主要依赖于这几个方法 <code>CGContextAddArc</code>,<code>CGContextAddArcToPoint</code>, <code>CGContextAddCurveToPoint</code>,<code>CGContextAddQuadCurveToPoint</code> 后面两个方法是贝塞尔二次曲线和三次曲线</strong></p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//画圆、圆弧</span></span><br><span class="line"> -(<span class="keyword">void</span>)drawCircle:(<span class="built_in">CGContextRef</span>)ctx&#123;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> purpleColor].CGColor);</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* 绘制路径 方法一</span></span><br><span class="line"><span class="comment">      void CGContextAddArc (</span></span><br><span class="line"><span class="comment">      CGContextRef c,</span></span><br><span class="line"><span class="comment">      CGFloat x,             //圆心的x坐标</span></span><br><span class="line"><span class="comment">      CGFloat y,    //圆心的x坐标</span></span><br><span class="line"><span class="comment">      CGFloat radius,   //圆的半径</span></span><br><span class="line"><span class="comment">      CGFloat startAngle,    //开始弧度</span></span><br><span class="line"><span class="comment">      CGFloat endAngle,   //结束弧度</span></span><br><span class="line"><span class="comment">      int clockwise          //0表示顺时针，1表示逆时针</span></span><br><span class="line"><span class="comment">      );</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//圆</span></span><br><span class="line">     <span class="built_in">CGContextAddArc</span> (ctx, <span class="number">100</span>, <span class="number">100</span>, <span class="number">50</span>, <span class="number">0</span>, M_PI* <span class="number">2</span> , <span class="number">0</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//半圆</span></span><br><span class="line">     <span class="built_in">CGContextAddArc</span> (ctx, <span class="number">100</span>, <span class="number">200</span>, <span class="number">50</span>, <span class="number">0</span>, M_PI*<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//绘制路径 方法二，这方法适合绘制弧度 ，端点p1和p2是弧线的控制点，类似photeshop中钢笔工具控制曲线，还不明白请去了解贝塞尔曲线</span></span><br><span class="line">     <span class="comment">//    void CGContextAddArcToPoint(</span></span><br><span class="line">     <span class="comment">//                                CGContextRef c,</span></span><br><span class="line">     <span class="comment">//                                CGFloat x1,  //端点1的x坐标</span></span><br><span class="line">     <span class="comment">//                                CGFloat y1,  //端点1的y坐标</span></span><br><span class="line">     <span class="comment">//                                CGFloat x2,  //端点2的x坐标</span></span><br><span class="line">     <span class="comment">//                                CGFloat y2,  //端点2的y坐标</span></span><br><span class="line">     <span class="comment">//                                CGFloat radius //半径</span></span><br><span class="line">     <span class="comment">//                                )；</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//1/4弧度 * 4</span></span><br><span class="line">     <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">     <span class="built_in">CGContextAddArcToPoint</span>(ctx, <span class="number">200</span>, <span class="number">100</span>,<span class="number">300</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextAddArcToPoint</span>(ctx, <span class="number">400</span>, <span class="number">100</span>,<span class="number">400</span>, <span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextAddArcToPoint</span>(ctx, <span class="number">400</span>, <span class="number">300</span>,<span class="number">300</span>, <span class="number">300</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextAddArcToPoint</span>(ctx, <span class="number">200</span>, <span class="number">300</span>,<span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//贝塞尔曲线</span></span><br><span class="line">     <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> orangeColor].CGColor);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//三次曲线函数</span></span><br><span class="line">     <span class="comment">//void CGContextAddCurveToPoint (</span></span><br><span class="line">     <span class="comment">//                               CGContextRef c,</span></span><br><span class="line">     <span class="comment">//                               CGFloat cp1x, //控制点1 x坐标</span></span><br><span class="line">     <span class="comment">//                               CGFloat cp1y, //控制点1 y坐标</span></span><br><span class="line">     <span class="comment">//                               CGFloat cp2x, //控制点2 x坐标</span></span><br><span class="line">     <span class="comment">//                               CGFloat cp2y, //控制点2 y坐标</span></span><br><span class="line">     <span class="comment">//                               CGFloat x,  //直线的终点 x坐标</span></span><br><span class="line">     <span class="comment">//                               CGFloat y  //直线的终点 y坐标</span></span><br><span class="line">     <span class="comment">//                               );</span></span><br><span class="line"></span><br><span class="line">     <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">     <span class="built_in">CGContextAddCurveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">200</span>, <span class="number">400</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//三次曲线可以画圆弧，比如这里画一条之前用CGContextAddArcToPoint构成的圆弧</span></span><br><span class="line">     <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">     <span class="built_in">CGContextAddCurveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">300</span> ,<span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">     <span class="comment">//二次曲线函数</span></span><br><span class="line">     <span class="comment">//void CGContextAddQuadCurveToPoint (</span></span><br><span class="line">     <span class="comment">//                                   CGContextRef c,</span></span><br><span class="line">     <span class="comment">//                                   CGFloat cpx,  //控制点 x坐标</span></span><br><span class="line">     <span class="comment">//                                   CGFloat cpy,  //控制点 y坐标</span></span><br><span class="line">     <span class="comment">//                                   CGFloat x,  //直线的终点 x坐标</span></span><br><span class="line">     <span class="comment">//                                   CGFloat y  //直线的终点 y坐标</span></span><br><span class="line">     <span class="comment">//                                   );</span></span><br><span class="line"></span><br><span class="line">     <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">     <span class="built_in">CGContextAddQuadCurveToPoint</span>(ctx, <span class="number">200</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">150</span>);</span><br><span class="line">     <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>因为代码可以直接拷贝下去用，也就不上传到Github上的demo里了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/04/iOS开发——Core-Graphics绘图/" data-id="cjptr3x8m00e1lyz9s6xqbn15" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Core-Graphics绘图/">Core Graphics绘图</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Quartz-2D/">Quartz 2D</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——MJExtension的实际使用，JSON格式解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/25/iOS开发——MJExtension的实际使用，JSON格式解析/" class="article-date">
  <time datetime="2016-05-25T11:40:42.000Z" itemprop="datePublished">2016-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/25/iOS开发——MJExtension的实际使用，JSON格式解析/">iOS开发——MJExtension的实际使用，JSON格式解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>现在的iOS在跟服务器进行交互式，采取的常用数据格式是XML和JSON，而今天就探讨一个JSON解析框架 —— MJExtension。</p>
<p>MJExtension是李明杰老师写的一个开源框架，是一个转换速度快，使用简单方便的字典转模型框架。</p>
<p>&lt;!--more--&gt;</p>
<p>它可以完成的数据转换是有如下方式的:</p>
<ul>
<li><code>JSON</code> --&gt; <code>Model</code>、<code>Core Data Model</code></li>
<li><code>JSONString</code> --&gt; <code>Model</code>、<code>Core Data Model</code></li>
<li><code>Model</code>、<code>Core Data Model</code> --&gt; <code>JSON</code></li>
<li><code>JSON Array</code> --&gt; <code>Model Array</code>、<code>Core Data Model Array</code></li>
<li><code>JSONString</code> --&gt; <code>Model Array</code>、<code>Core Data Model Array</code></li>
<li><code>Model Array</code>、<code>Core Data Model Array</code> --&gt; <code>JSON Array</code></li>
</ul>
<p>在MJExtension的GitHub上，文档中已经很清楚的写明了这个框架的简单用法，所以我就不赘述这个框架最基本的使用了。今天我打算举一个很简单的例子，来告诉大家，实际项目中该如何使用MJExtension框架来处理Model数据。</p>
<p>首先我们先来看一个JSON数据格式。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"group"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"roomgroup"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"device_name"</span>: <span class="string">"海尔"</span>,</span><br><span class="line">                    <span class="string">"address"</span>: <span class="string">"客厅电视机"</span>,</span><br><span class="line">                    <span class="string">"device_id"</span>: <span class="string">"c6f7cd61-245f-46fc-8e81-1e32a0f38cd6"</span>,</span><br><span class="line">                    <span class="string">"device_status"</span>: <span class="string">"0"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"device_name"</span>: <span class="string">"乐视"</span>,</span><br><span class="line">                    <span class="string">"address"</span>: <span class="string">"餐厅电视机"</span>,</span><br><span class="line">                    <span class="string">"device_id"</span>: <span class="string">"7c756f4a-d3cf-492a-817b-92311f6ea34b"</span>,</span><br><span class="line">                    <span class="string">"device_status"</span>: <span class="string">"0"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"room"</span>: <span class="string">"厨房"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"roomgroup"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"device_name"</span>: <span class="string">"海尔"</span>,</span><br><span class="line">                    <span class="string">"address"</span>: <span class="string">"客厅电视机"</span>,</span><br><span class="line">                    <span class="string">"device_id"</span>: <span class="string">"784ec8cd-723d-44bc-a6cc-3ae78022e6e9"</span>,</span><br><span class="line">                    <span class="string">"device_status"</span>: <span class="string">"0"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"room"</span>: <span class="string">"客厅"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"roomgroup"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"device_name"</span>: <span class="string">"乐视"</span>,</span><br><span class="line">                    <span class="string">"address"</span>: <span class="string">"餐厅电视机"</span>,</span><br><span class="line">                    <span class="string">"device_id"</span>: <span class="string">"3d141e71-95ce-4e04-845a-9f0a455d37c2"</span>,</span><br><span class="line">                    <span class="string">"device_status"</span>: <span class="string">"0"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"room"</span>: <span class="string">"阳台"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"message"</span>: &#123;</span><br><span class="line">        <span class="string">"code"</span>: <span class="string">"200"</span>,</span><br><span class="line">        <span class="string">"message"</span>: <span class="string">"操作成功！"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"rows"</span>: null,</span><br><span class="line">    <span class="string">"total"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>观察这个JSON数据，我们能发现它里面装着数组属性，而数组中又装着其他模型。这里主要就是要提取<code>group</code>这个数组中的数据。</p>
<ul>
<li>那么首先我们定义一个模型，我把它命名为<code>GroupRoomModel</code>。</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableArray</span> *roomGroup;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableArray</span> *group; </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *room; </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableArray</span> *deviceDetail;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>接着再定义一个模型，我把它命名为<code>RoomModel</code>,用来存储<code>roomgroup</code>中的数据</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *deviceName;   </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *deviceStatus; </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *deviceID;     </span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *address;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>接下来我们要重新映射<code>Model</code>中的键值与<code>JSON</code>数据中的对应。</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[GroupRoomModel mj_setupReplacedKeyFromPropertyName:^<span class="built_in">NSDictionary</span> *&#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">        <span class="string">@"roomGroup"</span>:<span class="string">@"roomgroup"</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">    [RoomModel mj_setupReplacedKeyFromPropertyName:^<span class="built_in">NSDictionary</span> *&#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">                         <span class="string">@"deviceID"</span>:<span class="string">@"device_id"</span>,</span><br><span class="line">                         <span class="string">@"deviceName"</span>:<span class="string">@"device_name"</span>,</span><br><span class="line">                         <span class="string">@"deviceStatus"</span>:<span class="string">@"device_status"</span>,</span><br><span class="line">             &#125;;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>之后先解析我们拿到的<code>data</code>，这里可以直接解析出group</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GroupRoomModel *groupRoomModel = [GroupRoomModel mj_objectWithKeyValues:data];</span><br></pre></td></tr></table></figure></p>
<p>一行代码搞定，是不是很简单。</p>
<p>之后我们解析<code>group</code>这个数组中的数据，把<code>room</code>中的字符串提取出来存在<code>Model</code>的<code>room</code>里，把<code>roomgroup</code>里的字典分别提取出来，存在<code>RoomModel</code>类型的Model里，并且把<code>RoomModel</code>添加到<code>GroupRoomModel</code>中的<code>deviceDetail</code>这个可变数组中。</p>
<p>具体的代码如下</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *modelArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  _dataSource = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dic <span class="keyword">in</span> groupRoomModel.group) &#123;</span><br><span class="line">      GroupRoomModel *model = [GroupRoomModel mj_objectWithKeyValues:dic];</span><br><span class="line">      <span class="built_in">NSMutableArray</span> *deviceArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *deviceDic <span class="keyword">in</span> model.roomGroup) &#123;</span><br><span class="line">          RoomModel *roomModel = [RoomModel mj_objectWithKeyValues:deviceDic];</span><br><span class="line">          [deviceArray addObject:roomModel];</span><br><span class="line">      &#125;</span><br><span class="line">      [modelArray addObject:model];</span><br><span class="line">      model.deviceDetail = [<span class="built_in">NSMutableArray</span> arrayWithArray:deviceArray];</span><br><span class="line">      [_dataSource addObject:model];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们就完成了多层的JSON数据解析。</p>
<p>其实MJExtension的使用非常简单，多看看文档，很容易掌握。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/25/iOS开发——MJExtension的实际使用，JSON格式解析/" data-id="cjptr3x4s0023lyz9otl8u89r" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JSON解析/">JSON解析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MJExtension/">MJExtension</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——数据持久化之归档" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/19/iOS开发——数据持久化之归档/" class="article-date">
  <time datetime="2016-05-19T12:23:49.000Z" itemprop="datePublished">2016-05-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/19/iOS开发——数据持久化之归档/">iOS开发——数据持久化之归档</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>在实际的项目开发中，数据持久化是我们必须要考虑的一个事情，如何把我们需要的数据进行持久化处理。</p>
<p>在此之前，一些轻量级的数据类型我一般比较喜欢用NSUserDefaults来存储，因为首先这是一个单例，而且使用简便，数据之间传递自由，所以很适合用来保存简单的数据。</p>
<p>而昨天我在实际工作中，有一个数组NSMutableArray需要存储，但是使用时，报了一个错误 <code>reason: '*** -[NSUserDefaults setObject:forKey:]: attempt to insert non-property list object</code>，这个报错提示我试图加入一个不支持的数据类型。可是明明NSUserDefaults支持的数据类型有：NSNumber（NSInteger、float、double），NSString，NSDate，NSArray，NSDictionary，BOOL，为什么我的NSArray不能加入呢。后来发现我的数组中的对象，是Model类的对象。</p>
<p>&lt;!--more--&gt;</p>
<p>既然涉及到了Model类的对象，就要考虑用归档（NSKeyedArchiver）来处理它了。NSKeyedArchiver能够存储的数据范围很广，因为它对应着MVC中的Model层，即实体类。在程序中，我们会在Model层定义很多的entity，例如name、room、device等。</p>
<p>那么对自定义对象的归档显得重要的多，因为很多时候我们都要在程序退出时保存数据，再程序恢复时重新加载，那么，归档便是一个好的选择。</p>
<p>接下来我们来讲讲NSKeyedArchiver的使用。</p>
<ul>
<li>要使对象可以归档，对象必须实现NSCoding协议，大部分对象都符合NSCoding的协议，一般我们可以在我们的Model类中实现NSCoding协议。</li>
</ul>
<p>遵循NSCoding协议，我们需要实现两个方法。</p>
<ul>
<li>
<p><code>- (void)encodeWithCoder:(NSCoder *)aCoder;</code></p>
</li>
<li>
<p><code>- (nullable instancetype)initWithCoder:(NSCoder *)aDecoder;</code></p>
</li>
<li>
<p>同时也建议对象实现<code>NSCoping</code>协议，该协议允许复制对象，遵循该协议要实现<code>- (id)copyWithZone:(nullable NSZone *)zone;</code>方法</p>
</li>
</ul>
<p>下面我们来看归档协议方法的实现</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)aCoder&#123;</span><br><span class="line"><span class="comment">// 这里放置需要持久化的属性</span></span><br><span class="line">    [aCoder encodeObject:_deviceType forKey:<span class="string">@"deviceType"</span>];</span><br><span class="line">    [aCoder encodeObject:_roomType forKey:<span class="string">@"roomType"</span>];</span><br><span class="line">    [aCoder encodeObject:_brand forKey:<span class="string">@"brand"</span>];</span><br><span class="line">    [aCoder encodeObject:_version forKey:<span class="string">@"version"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来是解档的协议方法实现</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)aDecoder&#123;</span><br><span class="line"><span class="comment">//  这里务必和encodeWithCoder方法里面的内容一致，不然会读不到数据</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.deviceType = [aDecoder decodeObjectForKey:<span class="string">@"deviceType"</span>];</span><br><span class="line">        <span class="keyword">self</span>.roomType = [aDecoder decodeObjectForKey:<span class="string">@"roomType"</span>];</span><br><span class="line">        <span class="keyword">self</span>.brand = [aDecoder decodeObjectForKey:<span class="string">@"brand"</span>];</span><br><span class="line">        <span class="keyword">self</span>.version = [aDecoder decodeObjectForKey:<span class="string">@"version"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来是遵循了<code>NSCopying</code>协议的方法实现</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark NSCoping</span></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;</span><br><span class="line">    AddDeviceModel *<span class="keyword">copy</span> = [[[<span class="keyword">self</span> <span class="keyword">class</span>] allocWithZone:zone] init];</span><br><span class="line">    <span class="keyword">copy</span>.deviceType = [<span class="keyword">self</span>.deviceType copyWithZone:zone];</span><br><span class="line">    <span class="keyword">copy</span>.roomType = [<span class="keyword">self</span>.roomType copyWithZone:zone];</span><br><span class="line">    <span class="keyword">copy</span>.brand = [<span class="keyword">self</span>.brand copyWithZone:zone];</span><br><span class="line">    <span class="keyword">copy</span>.version = [<span class="keyword">self</span>.version copyWithZone:zone];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">copy</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>特别注意</code> 如果需要归档的类是某个自定义类的子类时，就需要在归档和解档之前先实现父类的归档和解档方法。即 <code>[super encodeWithCoder:aCoder]</code> 和<code>[super initWithCoder:aDecoder]</code> 方法</li>
</ul>
<p><code>使用</code> ：</p>
<p>因为之前我提过 我们要存储一个数组，那么我们可以把数组中的数据转化成NSData类型来存储，使用<code>+ (NSData *)archivedDataWithRootObject:(id)rootObject;</code>方法。即 ：</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:_dataSource];</span><br><span class="line">[[<span class="built_in">NSUserDefaults</span> standardUserDefaults] setObject:data forKey:kEditInfraredRepeater];</span><br><span class="line">[[<span class="built_in">NSUserDefaults</span> standardUserDefaults]synchronize];</span><br></pre></td></tr></table></figure></p>
<p>三行代码，就把NSKeyedArchiver和NSUserDefaults结合来存储数据了。</p>
<p>而要解档使用数据，只要使用解档<code>NSKeyedUnarchiver</code>类中的<code>+ (nullable id)unarchiveObjectWithData:(NSData *)data;</code>方法就可以实现</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSData</span> *data = [[<span class="built_in">NSUserDefaults</span> standardUserDefaults] objectForKey:kEditInfraredRepeater];</span><br><span class="line"><span class="built_in">NSArray</span> *array = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:data];</span><br><span class="line">_dataSource = [<span class="built_in">NSMutableArray</span> arrayWithArray:array];</span><br></pre></td></tr></table></figure></p>
<p>同样也是三行代码实现。</p>
<p>以上就是最简单的归档解档数据持久化的实现方式，至于如何用runtime进行自动归档解档，就又需要日后深入研究了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/19/iOS开发——数据持久化之归档/" data-id="cjptr3x53002ulyz9yjjfa7yf" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NSKeyedArchiver/">NSKeyedArchiver</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/归档/">归档</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据持久化/">数据持久化</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——Block在实际项目中的传值" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/12/iOS开发——Block在实际项目中的传值/" class="article-date">
  <time datetime="2016-05-12T09:00:45.000Z" itemprop="datePublished">2016-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/12/iOS开发——Block在实际项目中的传值/">iOS开发——Block在实际项目中的传值</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>在iOS开发中，我们会在实际过程中大量使用Block，其中Block有个很基础的功能，就是完成两个页面间的传值。而今天，我就用实际的项目中的页面，来展示如何完成两个页面间的传值。</p>
<p>&lt;!--more--&gt;</p>
<p><img src="https://raw.githubusercontent.com/originalix/OuGeCameraTest/master/%E6%B5%B7%E5%BA%B7C2C%E6%B5%8B%E8%AF%95/img/IMG_5389.PNG" alt=""></p>
<p><img src="https://raw.githubusercontent.com/originalix/OuGeCameraTest/master/%E6%B5%B7%E5%BA%B7C2C%E6%B5%8B%E8%AF%95/img/IMG_5391.PNG" alt=""></p>
<p>首先我们先来看，这个界面中，我们需要传递什么值。我们需要在点击选择房间之后，跳转到房间列表界面，在<code>UITableViewController</code>中，选择房间名，之后按下<code>确定</code>按钮后，跳转回第一个界面，使我们选择的房间名，显示在<code>房间</code>选项处。</p>
<h1>房间列表界面</h1>
<p>因为事件其实是发生在第二个界面，按下<code>确定</code>按钮时，所以我们在第二个界面，声明并定义Block。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SelectedRoomBlock)(<span class="built_in">NSString</span> *roomName);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SelectRoomTypeVC</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) SelectedRoomBlock selectedRoomBlock;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)returnRoomName:(SelectedRoomBlock)block;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>
<p>我们先用<code>typedef</code>声明一个叫<code>SelectedRoomBlock</code>的<code>Block</code>，它需要有一个类型为<code>NSString</code>的参数。</p>
</li>
<li>
<p>之后我们声明一个类型为<code>SelectedRoomBlock</code>的变量<code>selectedRoomBlok</code>。</p>
</li>
<li>
<p>我们定义一个函数，需要传入一个<code>Block</code>类型的参数，这个方法不用也可以，目的是为了减少代码量，使我们使用Block的过程更加清晰。</p>
</li>
</ul>
<p>接下来我们就要开始来使用Block传值了，我们先来实现刚刚定义的函数方法。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)returnRoomName:(SelectedRoomBlock)block&#123;</span><br><span class="line">    <span class="keyword">self</span>.selectedRoomBlock = block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很清晰的实现，就是为了再后来调用时，出现一个Block代码块，更加清晰。</p>
<p>把传进来的Block语句块保存到本类的实例变量selectedRoomBlock（.h中定义的属性）中，然后寻找一个时机调用，而这个时机就是上面说到的，当确认按钮按下时。</p>
<p>之后声明一个字符串类型的变量，保存我们刚刚存储的房间的值。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *selectedRoomStr;</span><br></pre></td></tr></table></figure></p>
<p>而获取值在<code>UITableView</code>的代理方法中实现，这里就不赘述了。</p>
<p>因为我们按下确定按钮开始传值，所以我们在<code>ButtonAction</code>中来实现。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-  (<span class="keyword">void</span>)ButtonAction:(<span class="built_in">UIBarButtonItem</span> *)sender&#123;</span><br><span class="line">    <span class="keyword">switch</span> (sender.tag) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">107</span>:&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">self</span>.selectedRoomBlock != <span class="literal">nil</span>) &#123;</span><br><span class="line">                <span class="keyword">self</span>.selectedRoomBlock(<span class="keyword">self</span>.selectedRoom);</span><br><span class="line">            &#125;</span><br><span class="line">            [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1>第一个视图界面</h1>
<p>我们回到第一个视图界面，在<code>Push</code>出第二个界面时生成第二个界面的地方，调用我们的Block属性。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.navigationController pushViewController:_selectRoomVC animated:<span class="literal">YES</span>];</span><br><span class="line">   </span><br><span class="line">[_selectRoomVC returnRoomName:^(<span class="built_in">NSString</span> *roomName) &#123;</span><br><span class="line">        _addDeviceCellInfo.roomName = roomName;</span><br><span class="line">  &#125;];</span><br></pre></td></tr></table></figure></p>
<p>这里我们就可以用任意的变量，来匹配Block传递进来的roomName参数。</p>
<p><img src="https://raw.githubusercontent.com/originalix/OuGeCameraTest/master/%E6%B5%B7%E5%BA%B7C2C%E6%B5%8B%E8%AF%95/img/IMG_5392.PNG" alt=""></p>
<p>至此，就已经完成了Block在两个页面间的传值，效果如上图,是不是其实也特别简单呢。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/12/iOS开发——Block在实际项目中的传值/" data-id="cjptr3x4m001rlyz9eu5u8jca" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Block/">Block</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——UITableView勾选效果" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/11/iOS开发——UITableView勾选效果/" class="article-date">
  <time datetime="2016-05-11T14:05:31.000Z" itemprop="datePublished">2016-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/11/iOS开发——UITableView勾选效果/">iOS开发——UITableView勾选效果</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>今天整理了一下项目中常用的一些控件功能，整理一些UI效果来总结一下。</p>
<p>如今的APP开发中，<code>UITableView</code>是最常用的控件之一，而<code>UITableView</code>中有个很常见的效果就是勾选效果，这个效果是由<code>UITableViewCell</code>中的<code>accessoryType</code>属性来决定的。</p>
<p><code>accessoryType</code>中的变量是一个枚举值<code>UITableViewCellAccessoryType</code>，让我们来看一下其中包含的东西。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">UITableViewCellAccessoryType</span>) &#123;</span><br><span class="line">    <span class="built_in">UITableViewCellAccessoryNone</span>,                                                      <span class="comment">// 不显示任何效果</span></span><br><span class="line">    <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>,                                       <span class="comment">// 常用的V形引导图标</span></span><br><span class="line">    <span class="built_in">UITableViewCellAccessoryDetailDisclosureButton</span> <span class="comment">//信息提示+V形引导图标</span></span><br><span class="line">    <span class="built_in">UITableViewCellAccessoryCheckmark</span>,                                                 <span class="comment">// 勾选效果</span></span><br><span class="line">    <span class="built_in">UITableViewCellAccessoryDetailButton</span> <span class="comment">//信息图标</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这几个效果我已经罗列在上面了，今天我们要探讨的，就是<code>UITableViewCellAccessoryCheckmark</code>勾选效果。我们要实现的，就是单选一个列表中的信息。</p>
<p>&lt;!--more--&gt;</p>
<p>有以下几个注意点：</p>
<ul>
<li>
<p>首先在<code>- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath</code> 方法中实现判断被选中的单元格的功能。记录下之前选择的单元格，并且实时更新。</p>
</li>
<li>
<p>其次，解决单元格的复用问题。不然当单元格复用时，会显示多个勾选的BUG。看了一下网上分享的很多的方法，都没有解决单元格复用的问题，或者问的很笼统。</p>
</li>
</ul>
<p>好了，解释的差不多，下面来上代码。</p>
<p>首先我们先声明一个变量，用来存储被选择的行数的标志</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSIndexPath</span> *selectPath; <span class="comment">//存放被点击的哪一行的标志</span></span><br></pre></td></tr></table></figure></p>
<p>之后我们实现<code>- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath</code>这个代理方法</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="keyword">int</span> newRow = (<span class="keyword">int</span>)[indexPath row];</span><br><span class="line">    <span class="keyword">int</span> oldRow = (<span class="keyword">int</span>)(_selectPath != <span class="literal">nil</span>) ? (<span class="keyword">int</span>)[_selectPath row]:<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newRow != oldRow) &#123;</span><br><span class="line">        <span class="built_in">UITableViewCell</span> *newCell = [tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">        newCell.accessoryType = <span class="built_in">UITableViewCellAccessoryCheckmark</span>;</span><br><span class="line">        </span><br><span class="line">         <span class="built_in">UITableViewCell</span> *oldCell = [tableView cellForRowAtIndexPath:_selectPath];</span><br><span class="line">        oldCell.accessoryType = <span class="built_in">UITableViewCellAccessoryNone</span>;</span><br><span class="line">        _selectPath = [indexPath <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后看一下怎么在<code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath</code>中添加一段代码，解决复用问题</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (_selectPath == indexPath) &#123;</span><br><span class="line">        cell.accessoryType = <span class="built_in">UITableViewCellAccessoryCheckmark</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        cell.accessoryType = <span class="built_in">UITableViewCellAccessoryNone</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cell.roomType = _dataSource[indexPath.row];</span><br></pre></td></tr></table></figure></p>
<p>至此，单选效果就已经完成，并且不会有单元格复用的问题，代码很简单，也不想过多解释了,不清楚的可以接着问.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/11/iOS开发——UITableView勾选效果/" data-id="cjptr3x4u002alyz9flkair0n" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UITableView勾选/">UITableView勾选</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——多线程完成短信获取按钮倒计时" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/07/iOS开发——多线程完成短信获取按钮倒计时/" class="article-date">
  <time datetime="2016-05-07T13:07:35.000Z" itemprop="datePublished">2016-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/07/iOS开发——多线程完成短信获取按钮倒计时/">iOS开发——多线程完成短信获取按钮倒计时</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>现在的APP应用中，用手机获取短信验证码是非常常见的一个功能，而往往要求的效果就是在按下获取验证码之后，验证码的按钮开始倒计时，例如30秒后重新获取。而我们如何来完成这个效果呢，其实很简单，用一个定时器来计时，设置定时器的时间为UIButton的Title，而这个步骤我们一般用多线程的定时器dispatch source来定时产生事件。</p>
<p>在网上看了别人写的代码，复用性比较差，没有对这个方法进行良好的封装，我在这里贴一段修改后的代码，基本上大家黏贴过去就能复用。而后面我会解释这个代码的多线程方面的一些问题。</p>
<p>&lt;!--more--&gt;</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - 倒计时获取验证码</span></span><br><span class="line">-(<span class="keyword">void</span>)changeTimeOut:(<span class="keyword">int</span>)timeOut btnTag:(<span class="keyword">int</span>)btnTag&#123;</span><br><span class="line">    __block <span class="keyword">int</span> timeout=timeOut;</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue=dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">    dispatch_source_t _timer=dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line">    dispatch_source_set_timer(_timer, dispatch_walltime(<span class="literal">NULL</span>, <span class="number">0</span>), <span class="number">1.0</span>*<span class="built_in">NSEC_PER_SEC</span>, <span class="number">0</span>);</span><br><span class="line">    dispatch_source_set_event_handler(_timer, ^&#123;</span><br><span class="line">        <span class="keyword">if</span> (timeout&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">            dispatch_source_cancel(_timer);</span><br><span class="line">            <span class="comment">//dispatch_release(_timer);</span></span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="comment">//倒计时结束</span></span><br><span class="line">                _smsCodeBtn=(<span class="built_in">UIButton</span>*)[<span class="keyword">self</span>.view viewWithTag:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>,btnTag] intValue]];</span><br><span class="line">                [_smsCodeBtn setTitle:<span class="string">@"重新获取验证码"</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">                [_smsCodeBtn setUserInteractionEnabled:<span class="literal">YES</span>];</span><br><span class="line">                [_smsCodeBtn setTitleColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">53.0</span>f/<span class="number">255.0</span>f   green:<span class="number">53.0</span>f/<span class="number">255.0</span>f blue:<span class="number">68.0</span>f/<span class="number">255.0</span>f alpha:<span class="number">1</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">                [_smsCodeBtn.layer setBorderColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">53.0</span>f/<span class="number">255.0</span>f green:<span class="number">53.0</span>f/<span class="number">255.0</span>f blue:<span class="number">68.0</span>f/<span class="number">255.0</span>f alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">NSString</span>* strTime=[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d秒后重新获取"</span>,(<span class="keyword">int</span>)(timeout)];</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="comment">//倒计时</span></span><br><span class="line">                _smsCodeBtn=(<span class="built_in">UIButton</span>*)[<span class="keyword">self</span>.view viewWithTag:[[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%d"</span>,(<span class="keyword">int</span>)btnTag] intValue]];</span><br><span class="line">                [_smsCodeBtn setTitle:strTime forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">                [_smsCodeBtn setTitleColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">153.0</span>f/<span class="number">255.0</span>f green:<span class="number">153.0</span>f/<span class="number">255.0</span>f blue:<span class="number">153.0</span>f/<span class="number">255.0</span>f alpha:<span class="number">1</span>] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">                [_smsCodeBtn.layer setBorderColor:[<span class="built_in">UIColor</span> colorWithRed:<span class="number">153.0</span>f/<span class="number">255.0</span>f green:<span class="number">153.0</span>f/<span class="number">255.0</span>f blue:<span class="number">153.0</span>f/<span class="number">255.0</span>f alpha:<span class="number">1</span>].CGColor];</span><br><span class="line">                [_smsCodeBtn setUserInteractionEnabled:<span class="literal">NO</span>];</span><br><span class="line">            &#125;);</span><br><span class="line">            timeout--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_resume(_timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码中smsCodeBtn就是我定义的获取短信验证码的UIButton，你们复制下去只要把frame属性和ui属性改一改，就完全可以直接用了。</p>
<p>那么接下来我们来讲讲这段代码中多线程的问题。</p>
<p>首先我们先用<code>dispatch_get_global_queue</code>来开启一个全局队列，之后用<code>dispatch_source_t</code>来产生定时事件。所有定时器<code>dispatch_source</code>都是间隔定时器，一旦创建，会按你指定的间隔定期递送事件。你需要为定时器<code>dispatch_source</code>指定一个期望的定时器事件精度，也就是leeway值，让系统能够灵活地管理电源并唤醒内核。例如系统可以使用leeway值来提前或延迟触发定时器，使其更好地与其他系统事件结合。创建自己的定时器时，你应该尽量指定一个leeway值。</p>
<p>就算你指定的leeway值为0，也不要期望定时器能够按照精确地纳秒来触发事件，系统会尽可能地满足你的需求，但是无法保证完全精确的触发时间。</p>
<p>如果你使用<code>dispatch_walltime</code>函数来设置定时器<code>dispatch_source</code>，则定时器会根据挂钟时间来跟踪，这种定时器比较适合触发间隔相对比较大的场合，可以防止定时器触发时间出现太大误差。</p>
<p><code>dispatch_time</code>类型的时间我们可以通过<code>dispatch_time</code>来创建，也可以通过<code>dispatch_walltime</code>来创建。前者创建的时间多以第一个参数为参照物，之后过多久执行任务。后者多用于创建绝对时间，如某年某月某日某时某分执行某任务，比如闹钟的设置。</p>
<p>最后我们用<code>dispatch_source_set_event_handler</code>这个方法来创建我们要完成的任务，很简单的语句，一个block闭包，里面的内容当然是自由发挥的咯。</p>
<p>所以交代清楚GCD中时间事件，这段代码就非常容易理解了。</p>
<p>代码很短也就不传到Github上的demo了。如果有写的不对的地方，欢迎交流。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/07/iOS开发——多线程完成短信获取按钮倒计时/" data-id="cjptr3x4x002glyz9rhb35hir" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/多线程/">多线程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/获取短信按钮倒计时/">获取短信按钮倒计时</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——正则表达式验证密码、手机号" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/03/iOS开发——正则表达式验证密码、手机号/" class="article-date">
  <time datetime="2016-05-03T13:03:28.000Z" itemprop="datePublished">2016-05-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/03/iOS开发——正则表达式验证密码、手机号/">iOS开发——正则表达式验证密码、手机号</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>App的实际应用中，用户登陆功能基本是每个App都有需求的一个功能。而当前我们很常规的做法，就是让用户把手机号作为自己的用户名，而在注册获取短信验证码的过程中，我们首先要完成的一个步骤，就是校验用户的手机号是否是符合规则的手机号，而这种问题，一般称之为字符串匹配问题。</p>
<p>当遇到字符串匹配问题时，有一种常用的解决方法就是正则表达式。通过iOS中的NSRegularExpression这个类就可以帮助我们实现这个。</p>
<p><strong>下面先来介绍一下正则表达式的基本语法。</strong></p>
<p>&lt;!--more--&gt;</p>
<h1>正则表达式基本语法</h1>
<h2>正则表达式常见字符</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">test            <span class="meta"># 匹配包含test的字符串</span></span><br><span class="line">.               <span class="meta"># 匹配除换行符外任意字符</span></span><br><span class="line">\               <span class="meta"># 转义字符</span></span><br><span class="line">[abc]或[a-c]    <span class="meta"># 匹配字符类，如例子匹配a,b,c中的任何一个</span></span><br><span class="line">[^abc]          <span class="meta"># 匹配除了a,b,c以外的所有字符</span></span><br></pre></td></tr></table></figure></p>
<h2>正则表达式特殊字符</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">\d                  <span class="meta"># 数字，等同于[0-9]</span></span><br><span class="line">\D                  <span class="meta"># 非数字</span></span><br><span class="line">\s                  <span class="meta"># 空白字符（包括换行、Tab等）</span></span><br><span class="line">\S                  <span class="meta"># 非空白字符</span></span><br><span class="line">\w                  <span class="meta"># 单词，等用于[a-zA-Z0-9_]</span></span><br><span class="line">\W                  <span class="meta"># 非单词</span></span><br></pre></td></tr></table></figure></p>
<h2>正则表达式数量词</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c*                  <span class="meta"># 匹配字符<span class="meta-string">"c"</span> 0或无限次</span></span><br><span class="line">c+                  <span class="meta"># 匹配字符<span class="meta-string">"c"</span> 1次以上</span></span><br><span class="line">c?                  <span class="meta"># 匹配字符<span class="meta-string">"c"</span> 0或1次</span></span><br><span class="line">c&#123;<span class="number">3</span>&#125;                <span class="meta"># 匹配字符<span class="meta-string">"c"</span> 3次</span></span><br><span class="line">c&#123;<span class="number">3</span>,<span class="number">5</span>&#125;              <span class="meta"># 匹配字符<span class="meta-string">"c"</span> 3到5次</span></span><br></pre></td></tr></table></figure></p>
<h2>正则表达式边界匹配</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^abc                <span class="meta"># 匹配<span class="meta-string">"abc"</span>开头的字符串</span></span><br><span class="line">abc$                <span class="meta"># 匹配<span class="meta-string">"abc"</span>结尾的字符串</span></span><br></pre></td></tr></table></figure></p>
<h2>正则表达式逻辑或分组</h2>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c|b                 <span class="meta"># 匹配<span class="meta-string">"c"</span>或<span class="meta-string">"b"</span></span></span><br><span class="line">(ab|cd)             <span class="meta"># 匹配<span class="meta-string">"ab"</span>或<span class="meta-string">"cd"</span></span></span><br><span class="line">(?P&lt;name&gt;abc)       <span class="meta"># 匹配<span class="meta-string">"abc"</span>并命名为name</span></span><br><span class="line">(?P=name)           <span class="meta"># 前文中的name组</span></span><br></pre></td></tr></table></figure></p>
<h1>实例分析 匹配用户手机号</h1>
<p>根据上面的语法，我用OC语言写出来的正则表达式匹配手机号的代码如下:</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *pattern = <span class="string">@"^1+[3578]+\\d&#123;9&#125;"</span>;</span><br><span class="line"><span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line"><span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:telNumber];</span><br><span class="line"><span class="keyword">return</span> isMatch;</span><br></pre></td></tr></table></figure></p>
<p>我们来分析我写的这段正则表达式，首先是边界匹配**^1**手机号一定是1开头，所以我们的开头用边界匹配1。</p>
<p><strong>[3578]</strong> 我们用中括号**[]**来匹配字符类，说明第二位数字是3、5、7、8中任意一个就可以，目前17也是新开号段，所以得考虑进去匹配上。</p>
<p>最后**\\d{9}<strong>这里要拆分开看，首先\d表示数字，等同于</strong>[0-9]<strong>,而</strong>{9}<strong>表示匹配数字</strong>\d** 9次。这样，就完成了一个11位手机号码的校验。</p>
<h1>封装常用的正则表达式方法</h1>
<p>在这里，我把常用的正则表达式的匹配方法，封装起来，项目中基本都会用到</p>
<ul>
<li>以下是.h头文件中的声明</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma 正则匹配手机号</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkTelNumber:(<span class="built_in">NSString</span> *) telNumber;</span><br><span class="line"><span class="meta">#pragma 正则匹配用户密码6-18位数字和字母组合</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkPassword:(<span class="built_in">NSString</span> *) password;</span><br><span class="line"><span class="meta">#pragma 正则匹配用户姓名,20位的中文或英文</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkUserName : (<span class="built_in">NSString</span> *) userName;</span><br><span class="line"><span class="meta">#pragma 正则匹配用户身份证号</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkUserIdCard: (<span class="built_in">NSString</span> *) idCard;</span><br><span class="line"><span class="meta">#pragma 正则匹配URL</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkURL : (<span class="built_in">NSString</span> *) url;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>以下是.m文件中的具体实现,直接复制到自己的项目中即可用</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma 正则匹配手机号</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkTelNumber:(<span class="built_in">NSString</span> *) telNumber</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"^1+[3578]+\\d&#123;9&#125;"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:telNumber];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma 正则匹配用户密码6-18位数字和字母组合</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkPassword:(<span class="built_in">NSString</span> *) password</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"^(?![0-9]+$)(?![a-zA-Z]+$)[a-zA-Z0-9]&#123;6,18&#125;"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:password];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma 正则匹配用户姓名,20位的中文或英文</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkUserName : (<span class="built_in">NSString</span> *) userName</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"^[a-zA-Z\u4E00-\u9FA5]&#123;1,20&#125;"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:userName];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma 正则匹配用户身份证号15或18位</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkUserIdCard: (<span class="built_in">NSString</span> *) idCard</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"(^[0-9]&#123;15&#125;$)|([0-9]&#123;17&#125;([0-9]|X)$)"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:idCard];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma 正则匹员工号,12位的数字</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkEmployeeNumber : (<span class="built_in">NSString</span> *) number</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"^[0-9]&#123;12&#125;"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:number];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma 正则匹配URL</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)checkURL : (<span class="built_in">NSString</span> *) url</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *pattern = <span class="string">@"^[0-9A-Za-z]&#123;1,50&#125;"</span>;</span><br><span class="line">    <span class="built_in">NSPredicate</span> *pred = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"SELF MATCHES %@"</span>, pattern];</span><br><span class="line">    <span class="built_in">BOOL</span> isMatch = [pred evaluateWithObject:url];</span><br><span class="line">    <span class="keyword">return</span> isMatch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>今天的正则表达式就分析到这里，正则表达式的关键点，还是根据语法来自己判断，实在不行，就敲敲代码实践咯~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/03/iOS开发——正则表达式验证密码、手机号/" data-id="cjptr3x55002xlyz9u6mm82jm" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/正则表达式/">正则表达式</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——32位MD5加密" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/24/iOS开发——32位MD5加密/" class="article-date">
  <time datetime="2016-04-24T08:12:16.000Z" itemprop="datePublished">2016-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/24/iOS开发——32位MD5加密/">iOS开发——32位MD5加密</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>在IOS开发过程中，为了保证数据的安全，我们通常要采取一些加密方法，常见的加密有Base64加密和MD5加密。Base64加密是可逆的，MD5加密目前来说一般是不可逆的。我们在开发一款App过程中，对于发的请求，其中有个“sign”的字段，这个key对应的value是MD5加密的字段，旁边的安卓同事问php后台，说MD5加密是32位的还是16位的，由于以前未曾注意过，所以就搜索了下，现在稍微总结下：</p>
<p>&lt;!--more--&gt;</p>
<p>MD5即Message-Digest Algorithm 5（信息-摘要算法5），用于确保信息传输完整一致。是计算机广泛使用的杂凑算法之一（又译摘要算法、哈希算法），主流编程语言普遍已有MD5实现。MD5的作用是让大容量信息在用数字签名软件签署私人密钥前被&quot;压缩&quot;成一种保密的格式（就是把一个任意长度的字节串变换成一定长的十六进制数字串）。（引用自百度百科）</p>
<p>注意生成“一定长”，这个“一定长”到底是多长呢！看了好多资料，包括维基百科和一些论坛，说MD5其实进过算法产生的是固定的128bit，即128个0和1的二进制位，而在实际应用开发中，通常是以16进制输出的，所以正好就是32位的16进制，说白了也就是32个16进制的数字。</p>
<p>下面就来说说在Objective-C中我们怎么进行MD5加密，首先我们需要包含头文件是</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;CommonCrypto/CommonDigest.h&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>接下来，我们有两种方式来生成32位的16进制小写的md5串，下面直接贴代码。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  32位md5加密算法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @param str 传入要加密的字符串</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  @return NSString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)md5:(<span class="built_in">NSString</span> *)str</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *cStr = [str UTF8String];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> result[<span class="number">16</span>];</span><br><span class="line">    CC_MD5(cStr, strlen(cStr), result); <span class="comment">// This is the md5 call</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x%02x"</span>,</span><br><span class="line">            result[<span class="number">0</span>], result[<span class="number">1</span>], result[<span class="number">2</span>], result[<span class="number">3</span>],</span><br><span class="line">            result[<span class="number">4</span>], result[<span class="number">5</span>], result[<span class="number">6</span>], result[<span class="number">7</span>],</span><br><span class="line">            result[<span class="number">8</span>], result[<span class="number">9</span>], result[<span class="number">10</span>], result[<span class="number">11</span>],</span><br><span class="line">            result[<span class="number">12</span>], result[<span class="number">13</span>], result[<span class="number">14</span>], result[<span class="number">15</span>]</span><br><span class="line">            ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而另一种方法:</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSString</span> *)md5HexDigest:(<span class="built_in">NSString</span>*)password</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *original_str = [password UTF8String];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> result[CC_MD5_DIGEST_LENGTH];</span><br><span class="line">    CC_MD5(original_str, strlen(original_str), result);</span><br><span class="line">    <span class="built_in">NSMutableString</span> *hash = [<span class="built_in">NSMutableString</span> string];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; CC_MD5_DIGEST_LENGTH; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         %02X是格式控制符：‘x’表示以16进制输出，‘02’表示不足两位，前面补0；</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        [hash appendFormat:<span class="string">@"%02X"</span>, result[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSString</span> *mdfiveString = [hash lowercaseString];</span><br><span class="line">    <span class="keyword">return</span> mdfiveString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中%02x是格式控制符：‘x’表示以16进制输出，‘02’表示不足两位，前面补0；如‘f’输出为0f，‘1f3’则输出1f3;本来一般的都会介绍到这里就完了，我想多介绍一下代码中result是个字符数组，那为什么是[16]呢，这是因为MD5算法最后生成的是128位，而在计算机的最小存储单位为字节，1个字节是8位，对应一个char类型，计算可得需要16个char。所以result是[16]。那么为什么输出的格式一定是%02x呢，而不是其它呢。这也是有原因的：因为约定MD5一般是以16进制的格式输出，那么其实这个问题就转换为把128个0和1以16进制来表示，每4位二进制对应一个16进制的元素，则需要32个16进制的元素，如果元素全部为0，放到char的数组中，正常是不会输出，如00001111，以%x输出，则是f,那么就会丢失0；但如果以%02x表示则输出结果是0f，正好是转换的正确结果。</p>
<p>所以以上就是char[16]和%02x的来历。</p>
<p>至于人们说的16位MD5加密，其实是这样的：举例如果产生的MD5加密字符串是：01234567abcdefababcdefab76543210，则16位的MD加密字符是abcdefababcdefab，也就是只是截取了中间的16位。实际上这个操作已经不是MD5加密算法所包括的，而应当是对MD5加密算法结果的二次处理。其它的64位和大小写什么的，都属于对MD5算法结果的二次处理。因为MD5算法产生的结果就是128bit，128个二进制数字。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/24/iOS开发——32位MD5加密/" data-id="cjptr3x4k001olyz9kk5rr223" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MD5加密/">MD5加密</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——字典的升序排列以及字符串拼接" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/22/iOS开发——字典的升序排列以及字符串拼接/" class="article-date">
  <time datetime="2016-04-22T09:03:23.000Z" itemprop="datePublished">2016-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/22/iOS开发——字典的升序排列以及字符串拼接/">iOS开发——字典的升序排列以及字符串拼接</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>在调用SDK包的时候，很多时候我们自己开发的第三方应用想要取得数据的时候得获得登陆令牌以及其他很多信息，比如accessToken等登陆令牌信息，而第三方SDK包往往会要求我们完成签名算法，我今天在项目中集成海康威视的网络摄像头时，就要求我必须完成签名算法才能获得信息，而签名算法的要求是这样子的。</p>
<p>&lt;!--more--&gt;</p>
<ul>
<li>签名算法要求如下：</li>
<li>第一步： 算出“签名原始串”= params中参数集合字符串（将所有字段按升序排列后，依次连接所有字段名及对应值）+ method（接口名字）+ time(UTC时间戳) +请求源secret。样式如下：“&lt;attr&gt;:&lt;val&gt;,…,&lt;attr&gt;:&lt;val&gt;, method:&lt;val&gt;,time:&lt;val&gt;,secret:&lt;val&gt;”</li>
<li>第二步： 将“签名原始串”进行MD5校验，并转化为16进制的32位小写字符串，作为签名值sign。（注：编码格式为UTF-8）</li>
</ul>
<p>所以这里我们分析，我们要完成的步骤如下，首先我们先讲集合内的字符串以升序排列，第二步我们依次按照规定的样式拼接字符串，最后我们把拼接好的字符串进行MD5校验，转化为16进制的32位小写字符串。</p>
<p>下面我们先从字典的升序排列开始说起，我先假定一个字典。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDictionary</span> *params = @&#123;</span><br><span class="line">                           <span class="string">@"name"</span>:<span class="string">@"LinH"</span>,</span><br><span class="line">                           <span class="string">@"hometown"</span>:<span class="string">@"Dongying"</span>,</span><br><span class="line">                           <span class="string">@"userID"</span>:<span class="string">@"330909199301271234"</span>,</span><br><span class="line">                           <span class="string">@"phone"</span>:<span class="string">@"18814868888"</span></span><br><span class="line">                           &#125;;</span><br></pre></td></tr></table></figure></p>
<p>这个参数字典中一共有4个key:name、hometown、userID、phone。
我们该怎么样把这四个字符串按升序排列呢？</p>
<p>首先我们定义一个数组，存储字典中的所有key值:</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *keyArray = [params allKeys];</span><br></pre></td></tr></table></figure></p>
<p>接下来我们定义一个排序数组，存储排序好之后的key值</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *sortArray = [keyArray sortedArrayUsingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span>  _Nonnull obj1, <span class="keyword">id</span>  _Nonnull obj2) &#123;</span><br><span class="line">    <span class="keyword">return</span> [obj1 compare:obj2 options:<span class="built_in">NSNumericSearch</span>];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></p>
<p><strong>sortedArrayUsingComparator</strong>方法是苹果为我们提供的一个数组排序方法，利用block语法来完成排序功能。</p>
<p>而这时，我们排序好的key值，已经按顺序存储在<strong>sortArray</strong>数组中，这时我们再创建一个数组，来按升序存储key对应的Value，通过遍历<strong>sortArray</strong>的方法。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *valueArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSString</span> *sortString <span class="keyword">in</span> sortArray) &#123;</span><br><span class="line">    [valueArray addObject:[params objectForKey:sortString]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在我们有两个数组，分别对应升序排序的key和value，所以再创建一个keyValue的数组来存储每一个key和value的格式。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *signArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sortArray.count; i++) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *keyValueStr = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@:%@"</span>,sortArray[i],valueArray[i]];</span><br><span class="line">    [signArray addObject:keyValueStr];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后的一步，就是用**“,”**把每个字符串拼接起来，很简单。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *sign = [signArray componentsJoinedByString:<span class="string">@","</span>];</span><br><span class="line"><span class="keyword">return</span> sign;</span><br></pre></td></tr></table></figure></p>
<p>这时，字符串sign里存储的就是要求我们完成的，没有进行MD5校验的签名字符串了，可以打印出来看一下。</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">24923</span>:<span class="number">3184830</span>] hometown:Dongying,name:LinH,phone:<span class="number">18814868888</span>,userID:<span class="number">330909199301271234</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到hometown,name,phone,userID已经按首字母排序并且完成拼接。所以字典的排序我们就讲到这里，MD5加密下一篇再来讲述。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/22/iOS开发——字典的升序排列以及字符串拼接/" data-id="cjptr3x4y002ilyz9w4of11ww" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/字典排序/">字典排序</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/字符串拼接/">字符串拼接</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-iOS开发——系统原生二维码扫描" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/20/iOS开发——系统原生二维码扫描/" class="article-date">
  <time datetime="2016-04-20T13:14:42.000Z" itemprop="datePublished">2016-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/20/iOS开发——系统原生二维码扫描/">iOS开发——系统原生二维码扫描</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>对于现在的App应用来说，扫描二维码这个功能是再正常不过的一个功能了，在早期开发这些功能的时候，大家或多或少的都接触过ZXing和ZBar这类的第三方库，但从iOS7以后，苹果就给我们提供了系统原生的API来支持我们扫描获取二维码，ZXing和ZBar在使用中或多或少有不尽如人意的地方，再之停止更新很久了，所以今天我们就来聊聊如何用系统原生的方法扫描获取二维码。</p>
<p>&lt;!--more--&gt;</p>
<h1>相机权限</h1>
<p>众所周知，在使用App扫一扫功能的时候，获取相机权限是第一步要做的事情，而编写代码的时候也是一样，首先我们要判断用户是否已经授权能够访问相机。相机的授权是一组枚举值</p>
<ul>
<li>授权枚举值</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">AVAuthorizationStatus</span>) &#123;</span><br><span class="line">	<span class="built_in">AVAuthorizationStatusNotDetermined</span> = <span class="number">0</span>,   <span class="comment">//当前还没有确认是否授权</span></span><br><span class="line">	<span class="built_in">AVAuthorizationStatusRestricted</span>,</span><br><span class="line">	<span class="built_in">AVAuthorizationStatusDenied</span>,</span><br><span class="line">	<span class="built_in">AVAuthorizationStatusAuthorized</span></span><br><span class="line">&#125; <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0) __TVOS_PROHIBITED;</span><br></pre></td></tr></table></figure></p>
<p>而这样一组枚举值，首先我们要判断<strong>AVAuthorizationStatusNotDetermined</strong>是否已经授权，而判断授权情况的方法就是</p>
<ul>
<li>判断授权方法</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVAuthorizationStatus</span> authorizationStatus = [<span class="built_in">AVCaptureDevice</span> authorizationStatusForMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>完整的授权逻辑</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (authorizationStatus) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">AVAuthorizationStatusNotDetermined</span>:&#123;</span><br><span class="line">        [<span class="built_in">AVCaptureDevice</span> requestAccessForMediaType:<span class="built_in">AVMediaTypeVideo</span> completionHandler:^(<span class="built_in">BOOL</span> granted) &#123;</span><br><span class="line">            <span class="keyword">if</span> (granted) &#123;</span><br><span class="line">                [<span class="keyword">self</span> initQRScanView];</span><br><span class="line">                [<span class="keyword">self</span> setupCapture];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,<span class="string">@"访问受限"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">AVAuthorizationStatusRestricted</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">AVAuthorizationStatusDenied</span>: &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,<span class="string">@"访问受限"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">case</span> <span class="built_in">AVAuthorizationStatusAuthorized</span>:&#123;</span><br><span class="line">       <span class="comment">//获得权限</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面这段代码，就是在完成授权方法之后的一段完整的Switch条件判断授权的逻辑代码，而当你获得权限时，可以在里面写下你想要进一步运行的方法。</p>
<h1>扫码</h1>
<p>扫码是使用系统原生的<strong>AVCaptureSession</strong>类来发起的，这个类在官方文档中给出的解释是<strong>AVFundation</strong>框架中<strong>Capture</strong>类的中枢，起到管理协调的作用，而扫码是一个从摄像头（input）到 解析出字符串（output） 的过程，用AVCaptureSession 来协调。其中是通过 AVCaptureConnection 来连接各个 input 和 output，还可以用它来控制 input 和 output 的 数据流向。</p>
<ul>
<li>创建扫描代码</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">     <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">             <span class="built_in">AVCaptureSession</span> * session= [[<span class="built_in">AVCaptureSession</span> alloc] init];</span><br><span class="line">        <span class="built_in">AVCaptureDevice</span> *device = [<span class="built_in">AVCaptureDevice</span> defaultDeviceWithMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">        <span class="built_in">NSError</span> *error;</span><br><span class="line">        <span class="built_in">AVCaptureDeviceInput</span> *deviceInput = [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:device error:&amp;error];</span><br><span class="line">        <span class="keyword">if</span> (deviceInput) &#123;</span><br><span class="line">            [session addInput:deviceInput];</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="built_in">AVCaptureMetadataOutput</span> *metadataOutput = [[<span class="built_in">AVCaptureMetadataOutput</span> alloc] init];</span><br><span class="line">            [metadataOutput setMetadataObjectsDelegate:<span class="keyword">self</span> queue:dispatch_get_main_queue()];</span><br><span class="line">            [session addOutput:metadataOutput];</span><br><span class="line">            </span><br><span class="line">            metadataOutput.metadataObjectTypes = @[<span class="built_in">AVMetadataObjectTypeQRCode</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">AVCaptureVideoPreviewLayer</span> *previewLayer = [[<span class="built_in">AVCaptureVideoPreviewLayer</span> alloc] initWithSession:session];</span><br><span class="line">            previewLayer.videoGravity = <span class="built_in">AVLayerVideoGravityResizeAspectFill</span>;</span><br><span class="line">            previewLayer.frame = <span class="keyword">self</span>.view.frame;</span><br><span class="line">            [<span class="keyword">self</span>.view.layer insertSublayer:previewLayer atIndex:<span class="number">0</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CGFloat</span> screenHeight = ScreenSize.height;</span><br><span class="line">            <span class="built_in">CGFloat</span> screenWidth = ScreenSize.width;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>.scanRect = <span class="built_in">CGRectMake</span>((screenWidth - TransparentArea([QRScanView width], [QRScanView height]).width) / <span class="number">2</span>,</span><br><span class="line">                                       (screenHeight - TransparentArea([QRScanView width], [QRScanView height]).height) / <span class="number">2</span>,</span><br><span class="line">                                       TransparentArea([QRScanView width], [QRScanView height]).width,</span><br><span class="line">                                       TransparentArea([QRScanView width], [QRScanView height]).height);</span><br><span class="line">            </span><br><span class="line">            __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">            [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserverForName:<span class="built_in">AVCaptureInputPortFormatDescriptionDidChangeNotification</span></span><br><span class="line">                object:<span class="literal">nil</span></span><br><span class="line">                queue:[<span class="built_in">NSOperationQueue</span> currentQueue]</span><br><span class="line">                usingBlock:^(<span class="built_in">NSNotification</span> * _Nonnull note) &#123;</span><br><span class="line">                [metadataOutput setRectOfInterest:<span class="built_in">CGRectMake</span>(</span><br><span class="line">                            weakSelf.scanRect.origin.y / screenHeight,</span><br><span class="line">                            weakSelf.scanRect.origin.x / screenWidth,</span><br><span class="line">                            weakSelf.scanRect.size.height / screenHeight,</span><br><span class="line">                            weakSelf.scanRect.size.width / screenWidth)];</span><br><span class="line">                            <span class="comment">//如果不设置 整个屏幕都会扫描</span></span><br><span class="line">                &#125;];</span><br><span class="line">            [session startRunning];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"error = %@"</span>,error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>中间CGRect的设置，是我想根据现在大多数产品的二维码扫描规则，定义个一个框扫描，这个我们在后面也会说到。</p>
<h1>扫描框</h1>
<p>扫码时 previewLayer 的扫描范围是整个可视范围的，但有些需求可能需要指定扫描的区域，虽然我觉得这样很没有必要，因为整个屏幕都可以扫又何必指定到某个框呢？但如果真的需要这么做可以设定 metadataOutput 的 rectOfInterest。</p>
<ul>
<li>设置二维码扫描框  这段代码已经集成在上面的代码中，这里单独列出来只是给大家看一下，若是要复制使用的话，这段可不用复制</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> screenHeight = ScreenSize.height;</span><br><span class="line">           <span class="built_in">CGFloat</span> screenWidth = ScreenSize.width;</span><br><span class="line">           </span><br><span class="line">           <span class="keyword">self</span>.scanRect = <span class="built_in">CGRectMake</span>((screenWidth - TransparentArea([QRScanView width], [QRScanView height]).width) / <span class="number">2</span>,</span><br><span class="line">                                      (screenHeight - TransparentArea([QRScanView width], [QRScanView height]).height) / <span class="number">2</span>,</span><br><span class="line">                                      TransparentArea([QRScanView width], [QRScanView height]).width,</span><br><span class="line">                                      TransparentArea([QRScanView width], [QRScanView height]).height);</span><br><span class="line">           </span><br><span class="line">           __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">           [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserverForName:<span class="built_in">AVCaptureInputPortFormatDescriptionDidChangeNotification</span></span><br><span class="line">               object:<span class="literal">nil</span></span><br><span class="line">               queue:[<span class="built_in">NSOperationQueue</span> currentQueue]</span><br><span class="line">               usingBlock:^(<span class="built_in">NSNotification</span> * _Nonnull note) &#123;</span><br><span class="line">               [metadataOutput setRectOfInterest:<span class="built_in">CGRectMake</span>(</span><br><span class="line">                           weakSelf.scanRect.origin.y / screenHeight,</span><br><span class="line">                           weakSelf.scanRect.origin.x / screenWidth,</span><br><span class="line">                           weakSelf.scanRect.size.height / screenHeight,</span><br><span class="line">                           weakSelf.scanRect.size.width / screenWidth)];</span><br><span class="line">                           <span class="comment">//如果不设置 整个屏幕都会扫描</span></span><br><span class="line">               &#125;];</span><br></pre></td></tr></table></figure></p>
<p>这个<strong>self.scanRect</strong>是我先前定义的一个二维码扫描框的尺寸，而赋值我们在现在已经为他们设定好，现在不管适配什么机型，都会出现在屏幕的中间。</p>
<ul>
<li>获取扫描的值</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - AVCaptureMetadataOutputObjectsDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)captureOutput:(<span class="built_in">AVCaptureOutput</span> *)captureOutput didOutputMetadataObjects:(<span class="built_in">NSArray</span> *)metadataObjects fromConnection:(<span class="built_in">AVCaptureConnection</span> *)connection&#123;</span><br><span class="line">    <span class="built_in">AVMetadataMachineReadableCodeObject</span> *metadataObject = metadataObjects.firstObject;</span><br><span class="line">    <span class="keyword">if</span> ([metadataObject.type isEqualToString:<span class="built_in">AVMetadataObjectTypeQRCode</span>] &amp;&amp; !<span class="keyword">self</span>.isQRCodeCaptured) &#123;</span><br><span class="line">        <span class="keyword">self</span>.isQRCodeCaptured = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span> showAlertViewWithMessage:metadataObject.stringValue];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>获取扫描的值，必须要实现上面的这个代理方法，中间的自定义方法可以略去，直接看实现的步骤就好。</p>
<h1>扫描框的外观</h1>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    <span class="built_in">CGContextSetRGBFillColor</span>(context, <span class="number">40</span>/<span class="number">255.0</span>, <span class="number">40</span>/<span class="number">255.0</span>, <span class="number">40</span>/<span class="number">255.0</span>, <span class="number">.5</span>);</span><br><span class="line">    <span class="built_in">CGContextFillRect</span>(context, rect);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="built_in">NSStringFromCGSize</span>(TransparentArea([QRScanView width], [QRScanView height])));</span><br><span class="line">    <span class="built_in">CGRect</span> clearDrawRect = <span class="built_in">CGRectMake</span>(rect.size.width / <span class="number">2</span> - TransparentArea([QRScanView width], [QRScanView height]).width / <span class="number">2</span>,</span><br><span class="line">                                      rect.size.height / <span class="number">2</span> - TransparentArea([QRScanView width], [QRScanView height]).height / <span class="number">2</span>,</span><br><span class="line">                                      TransparentArea([QRScanView width], [QRScanView height]).width,TransparentArea([QRScanView width], [QRScanView height]).height);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextClearRect</span>(context, clearDrawRect);</span><br><span class="line">    [<span class="keyword">self</span> addWhiteRect:context rect:clearDrawRect];</span><br><span class="line">    [<span class="keyword">self</span> addCornerLineWithContext:context rect:clearDrawRect];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addWhiteRect:(<span class="built_in">CGContextRef</span>)ctx rect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="built_in">CGContextStrokeRect</span>(ctx, rect);</span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(ctx, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">0.8</span>);</span><br><span class="line">    <span class="built_in">CGContextAddRect</span>(ctx, rect);</span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addCornerLineWithContext:(<span class="built_in">CGContextRef</span>)ctx rect:(<span class="built_in">CGRect</span>)rect&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//画四个边角</span></span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">CGContextSetRGBStrokeColor</span>(ctx, <span class="number">83</span> /<span class="number">255.0</span>, <span class="number">239</span>/<span class="number">255.0</span>, <span class="number">111</span>/<span class="number">255.0</span>, <span class="number">1</span>);<span class="comment">//绿色</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//左上角</span></span><br><span class="line">    <span class="built_in">CGPoint</span> poinsTopLeftA[] = &#123;</span><br><span class="line">        <span class="built_in">CGPointMake</span>(rect.origin.x+<span class="number">0.7</span>, rect.origin.y),</span><br><span class="line">        <span class="built_in">CGPointMake</span>(rect.origin.x+<span class="number">0.7</span> , rect.origin.y + <span class="number">15</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">CGPoint</span> poinsTopLeftB[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x, rect.origin.y +<span class="number">0.7</span>),<span class="built_in">CGPointMake</span>(rect.origin.x + <span class="number">15</span>, rect.origin.y+<span class="number">0.7</span>)&#125;;</span><br><span class="line">    [<span class="keyword">self</span> addLine:poinsTopLeftA pointB:poinsTopLeftB ctx:ctx];</span><br><span class="line">    <span class="comment">//左下角</span></span><br><span class="line">    <span class="built_in">CGPoint</span> poinsBottomLeftA[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x+ <span class="number">0.7</span>, rect.origin.y + rect.size.height - <span class="number">15</span>),<span class="built_in">CGPointMake</span>(rect.origin.x +<span class="number">0.7</span>,rect.origin.y + rect.size.height)&#125;;</span><br><span class="line">    <span class="built_in">CGPoint</span> poinsBottomLeftB[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x , rect.origin.y + rect.size.height - <span class="number">0.7</span>) ,<span class="built_in">CGPointMake</span>(rect.origin.x+<span class="number">0.7</span> +<span class="number">15</span>, rect.origin.y + rect.size.height - <span class="number">0.7</span>)&#125;;</span><br><span class="line">    [<span class="keyword">self</span> addLine:poinsBottomLeftA pointB:poinsBottomLeftB ctx:ctx];</span><br><span class="line">    <span class="comment">//右上角</span></span><br><span class="line">    <span class="built_in">CGPoint</span> poinsTopRightA[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x+ rect.size.width - <span class="number">15</span>, rect.origin.y+<span class="number">0.7</span>),<span class="built_in">CGPointMake</span>(rect.origin.x + rect.size.width,rect.origin.y +<span class="number">0.7</span> )&#125;;</span><br><span class="line">    <span class="built_in">CGPoint</span> poinsTopRightB[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x+ rect.size.width<span class="number">-0.7</span>, rect.origin.y),<span class="built_in">CGPointMake</span>(rect.origin.x + rect.size.width<span class="number">-0.7</span>,rect.origin.y + <span class="number">15</span> +<span class="number">0.7</span> )&#125;;</span><br><span class="line">    [<span class="keyword">self</span> addLine:poinsTopRightA pointB:poinsTopRightB ctx:ctx];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPoint</span> poinsBottomRightA[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x+ rect.size.width <span class="number">-0.7</span> , rect.origin.y+rect.size.height+ <span class="number">-15</span>),<span class="built_in">CGPointMake</span>(rect.origin.x<span class="number">-0.7</span> + rect.size.width,rect.origin.y +rect.size.height )&#125;;</span><br><span class="line">    <span class="built_in">CGPoint</span> poinsBottomRightB[] = &#123;<span class="built_in">CGPointMake</span>(rect.origin.x+ rect.size.width - <span class="number">15</span> , rect.origin.y + rect.size.height<span class="number">-0.7</span>),<span class="built_in">CGPointMake</span>(rect.origin.x + rect.size.width,rect.origin.y + rect.size.height - <span class="number">0.7</span> )&#125;;</span><br><span class="line">    [<span class="keyword">self</span> addLine:poinsBottomRightA pointB:poinsBottomRightB ctx:ctx];</span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addLine:(<span class="built_in">CGPoint</span>[])pointA pointB:(<span class="built_in">CGPoint</span>[])pointB ctx:(<span class="built_in">CGContextRef</span>)ctx &#123;</span><br><span class="line">    <span class="built_in">CGContextAddLines</span>(ctx, pointA, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">CGContextAddLines</span>(ctx, pointB, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们对于扫描框是直接采用了复写drawRect的方法来绘制的，包括我们常见的四个边框。</p>
<ul>
<li>二维码扫描线的样式</li>
</ul>
<p>对于二维码的扫描线，我给定了四种模式</p>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, ScanLineMode) &#123;</span><br><span class="line">    ScanLineModeNone, <span class="comment">//没有扫描线</span></span><br><span class="line">    ScanLineModeDeafult, <span class="comment">//默认</span></span><br><span class="line">    ScanLineModeImge,  <span class="comment">//以一个图为扫描线 类似一根绿色的线上下扫动</span></span><br><span class="line">    ScanLineModeGrid, <span class="comment">//网格状，类似于支付宝的扫一扫</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>所以在我封装的类里，切换不同的模式，可以实现各种二维码扫描的状态。代码稍后会传到GitHub上分享。</p>
<p>至此就已经完成了基本的二维码功能，今天的分享也到这里了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/20/iOS开发——系统原生二维码扫描/" data-id="cjptr3x8s00edlyz9rnhlq4ov" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/QRCode/">QRCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/二维码扫描/">二维码扫描</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-使用KVC来自定义UISearchBar的外观" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/16/使用KVC来自定义UISearchBar的外观/" class="article-date">
  <time datetime="2016-04-16T14:18:42.000Z" itemprop="datePublished">2016-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/16/使用KVC来自定义UISearchBar的外观/">使用KVC来自定义UISearchBar的外观</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>以前我们在项目中使用搜索框的时候，如果用系统自带的控件则是使用UISearchDisplayController，而自从iOS8之后，系统重新给我们提供了一个搜索控件：UISearchController。在UISearchController中我们无需再自己初始化UISearchBar，只需要提供searchResult展示的视图。然而在开发中，我们往往需要根据项目的风格来改变UISearchBar的外观，通过继承的方式，我们可以完全定制符合项目风格的外观，然而有些情况下我们很难短时间内完成全部的外观定制工作，譬如我们项目用的好几个旧框架，代码中充斥着各种写好的UISearchBar的展示，而改动底层框架并不是一个较好地实践。于是我开始搜索并总结出了几个不通过继承的方式来更改UISearchBar外观的方法。</p>
<p>&lt;!--more--&gt;</p>
<p>#获取子View</p>
<p>我们在UISearchController或者是UISearchDisplayController中都可以直接获取到UISearchBar的实例，我们可以从这里改变一些UISearchBar的属性来改变外观显示。同时我们也可以直接获取UISearchBar的subViews,UISearchBar的subView是一个UIView的实例，这个UIView包含了所有在UISearchBar上可以展示的子视图，iOS SDK提供的UISearchBar，在iOS7之前是分为UISearchBarBackground、UISearchBarTextField、UIButton这几个类的实例组成，而在iOS7之后，是将UIButton转换为了UINavigationButton的实例。</p>
<ul>
<li>我们可以通过循环遍历出UISearchBar上所有展示出来的子视图</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="built_in">UIView</span>*viewin[[[_searchController.searchBar</span><br><span class="line"> subviews]lastObject]subviews] ) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([viewisKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"UISearchBarBackground"</span>)]) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([viewisKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"UISearchBarTextField"</span>)]) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([viewisKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"UINavigationButton"</span>)]) &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>通过KVC获取子视图</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span>*backgroundView = [_searchController.searchBar valueForKey:<span class="string">@"_background"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UITextField</span>*searchField = [_searchController.searchBar valueForKey:<span class="string">@"_searchField"</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">UIButton</span>*cancelButton = [_searchController.searchBar valueForKey:<span class="string">@"_cancelButton"</span>];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>当我们获取cancelButton时，一定要确保cancelButton包含在了UISearchBar中，必要时可以提前调用：</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[_searchController.searchBar setShowsCancelButton:<span class="literal">YES</span> animated:<span class="literal">NO</span>];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>去掉搜索框背景</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="built_in">UIView</span>*viewin[[[_searchController.searchBar subviews]lastObject]subviews] ) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([viewisKindOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"UISearchBarBackground"</span>)]) &#123;</span><br><span class="line"></span><br><span class="line">[view removeFromSuperview];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>去掉搜索框边框</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[_searchController.searchBar setBackgroundImage:[<span class="built_in">UIImage</span> new]];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>改变输入框文本</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//提示文本颜色</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UITextField</span>*searchField = [_searchController.searchBar valueForKey:<span class="string">@"_searchField"</span>];</span><br><span class="line"></span><br><span class="line">[searchFieldsetTextColor:[<span class="built_in">UIColorblackColor</span>]];</span><br><span class="line"></span><br><span class="line">[searchFieldsetValue:[<span class="built_in">UIColorgrayColor</span>]forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</span><br><span class="line"></span><br><span class="line">[searchFieldsetFont:[<span class="built_in">UIFontsystemFontOfSize</span>:<span class="number">14</span>]];</span><br><span class="line"></span><br><span class="line">[searchFieldsetBackgroundColor:[<span class="built_in">UIColorwhiteColor</span>]];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>改变取消按钮的title</li>
</ul>
<p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIButton</span>*cancelButton = [_searchController.searchBar valueForKey:<span class="string">@"_cancelButton"</span>];</span><br><span class="line"></span><br><span class="line">[cancelButtonsetTitle:<span class="string">@"Close"</span>forState:<span class="built_in">UIControlStateNormal</span>];</span><br></pre></td></tr></table></figure></p>
<p>以上就是基于KVC模式来自定义UISearchBar的外观，至于怎样使用UISearchController来搜索，以及谓词的使用，下一篇文章再更新。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/16/使用KVC来自定义UISearchBar的外观/" data-id="cjptr3x5l003nlyz9imks63t0" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UISearchBar/">UISearchBar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UISearchController/">UISearchController</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-Cocoapods使用详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/10/Cocoapods使用详解/" class="article-date">
  <time datetime="2016-04-10T09:03:07.000Z" itemprop="datePublished">2016-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/10/Cocoapods使用详解/">Cocoapods使用详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1>CocoaPods使用</h1>
<p><a href="#a1">CocoaPods简介</a></p>
<p><a href="#a2">CocoaPods 的安装和使用介绍</a></p>
<p>&lt;div id=&quot;a1&quot;&gt;&lt;/div&gt;</p>
<h2>CocoaPods简介</h2>
<p>当你开发iOS应用时，会经常使用到很多第三方开源类库，比如JSONKit，AFNetWorking等等。可能某个类库又用到其他类库，所以要使用它，必须得另外下载其他类库，而其他类库又用到其他类库，“子子孙孙无穷尽也”，这也许是比较特殊的情况。另外一种常见情况是，你项目中用到的类库有更新，你必须得重新下载新版本，重新加入到项目中，十分麻烦。如果能有什么工具能解决这些恼人的问题，那将“善莫大焉”。所以，你需要 CocoaPods。 CocoaPods应该是iOS最常用最有名的类库管理工具了，上述两个烦人的问题，通过cocoaPods，只需要一行命令就可以完全解决，当然前提是你必须正确设置它。重要的是，绝大部分有名的开源类库，都支持CocoaPods。所以，作为iOS程序员的我们，掌握CocoaPods的使用是必不可少的基本技能了。</p>
<p>&lt;!--more--&gt;</p>
<h1>CocoaPods 的安装和使用介绍</h1>
<h3>安装</h3>
<p>安装方式异常简单 , Mac 下都自带 ruby，使用 ruby 的 gem 命令即可下载安装：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install cocoapods</span><br><span class="line">$ pod setup</span><br></pre></td></tr></table></figure></p>
<p>如果你的 gem 太老，可能也会有问题，可以尝试用如下命令升级 gem:</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem update --system</span><br></pre></td></tr></table></figure></p>
<p>另外，ruby 的软件源 https://rubygems.org 因为使用的是亚马逊的云服务，所以被墙了，需要更新一下 ruby 的源，使用如下代码将官方的 ruby 源替换成国内淘宝的源：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gem sources --remove https:<span class="comment">//rubygems.org/</span></span><br><span class="line">gem sources -a http:<span class="comment">//ruby.taobao.org/</span></span><br><span class="line">gem sources -l</span><br></pre></td></tr></table></figure></p>
<p>还有一点需要注意，pod setup在执行时，会输出Setting up CocoaPods master repo，但是会等待比较久的时间。这步其实是 Cocoapods 在将它的信息下载到 ~/.cocoapods目录下，如果你等太久，可以试着 cd 到那个目录，用du -sh *来查看下载进度。你也可以参考本文接下来的使用 cocoapods 的镜像索引一节的内容来提高下载速度。</p>
<h3>使用 CocoaPods 的镜像索引</h3>
<p>所有的项目的 Podspec 文件都托管在https://github.com/CocoaPods/Specs。第一次执行pod setup时，CocoaPods 会将这些podspec索引文件更新到本地的 ~/.cocoapods/目录下，这个索引文件比较大，有 80M 左右。所以第一次更新时非常慢，笔者就更新了将近 1 个小时才完成。</p>
<p>一个叫 akinliu 的朋友在 gitcafe 和 oschina 上建立了 CocoaPods 索引库的镜像，因为 gitcafe 和 oschina 都是国内的服务器，所以在执行索引更新操作时，会快很多。如下操作可以将 CocoaPods 设置成使用 gitcafe 镜像：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pod repo remove master</span><br><span class="line">pod repo add master https:<span class="comment">//gitcafe.com/akuandev/Specs.git</span></span><br><span class="line">pod repo update</span><br></pre></td></tr></table></figure></p>
<p>将以上代码中的 https://gitcafe.com/akuandev/Specs.git 替换成 http://git.oschina.net/akuandev/Specs.git 即可使用 oschina 上的镜像。</p>
<h3>使用 CocoaPods</h3>
<p>使用时需要新建一个名为 Podfile 的文件，以如下格式，将依赖的库名字依次列在文件中即可</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">platform :ios</span><br><span class="line">pod <span class="string">'JSONKit'</span>,       <span class="string">'~&gt; 1.4'</span></span><br><span class="line">pod <span class="string">'Reachability'</span>,  <span class="string">'~&gt; 3.0.0'</span></span><br><span class="line">pod <span class="string">'ASIHTTPRequest'</span></span><br><span class="line">pod <span class="string">'RegexKitLite'</span></span><br></pre></td></tr></table></figure></p>
<p>然后你将编辑好的 Podfile 文件放到你的项目根目录中，执行如下命令即可：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="string">"your project home"</span></span><br><span class="line">pod install</span><br></pre></td></tr></table></figure></p>
<p>现在，你的所有第三方库都已经下载完成并且设置好了编译参数和依赖，你只需要记住如下 2 点即可：</p>
<p>使用 CocoaPods 生成的 .xcworkspace 文件来打开工程，而不是以前的 .xcodeproj 文件。
每次更改了 Podfile 文件，你需要重新执行一次pod update命令。
查找第三方库</p>
<p>你如果不知道 cocoaPods 管理的库中，是否有你想要的库，那么你可以通过 pod search 命令进行查找，以下是我用 pod search json 查找到的所有可用的库：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ pod search json</span><br><span class="line"></span><br><span class="line">-&gt; AnyJSON (<span class="number">0.0</span>.1)</span><br><span class="line">   Encode / Decode JSON by any means possible.</span><br><span class="line">   - Homepage: https:<span class="comment">//github.com/mattt/AnyJSON</span></span><br><span class="line">   - Source:   https:<span class="comment">//github.com/mattt/AnyJSON.git</span></span><br><span class="line">   - Versions: <span class="number">0.0</span>.1 [master repo]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-&gt; JSONKit (<span class="number">1.5</span>pre)</span><br><span class="line">   A Very High Performance Objective-C JSON Library.</span><br><span class="line">   - Homepage: https:<span class="comment">//github.com/johnezang/JSONKit</span></span><br><span class="line">   - Source:   git:<span class="comment">//github.com/johnezang/JSONKit.git</span></span><br><span class="line">   - Versions: <span class="number">1.5</span>pre, <span class="number">1.4</span> [master repo]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 以下省略若干行</span></span><br></pre></td></tr></table></figure></p>
<p>关于 Podfile.lock</p>
<p>当你执行pod install之后，除了 Podfile 外，CocoaPods 还会生成一个名为Podfile.lock的文件，Podfile.lock 应该加入到版本控制里面，不应该把这个文件加入到.gitignore中。因为Podfile.lock会锁定当前各依赖库的版本，之后如果多次执行pod install 不会更改版本，要pod update才会改Podfile.lock了。这样多人协作的时候，可以防止第三方库升级时造成大家各自的第三方库版本不一致。</p>
<p>CocoaPods 的这篇 官方文档 也在What is a Podfile.lock一节中介绍了Podfile.lock的作用，并且指出：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This file should always be kept under version control.</span><br></pre></td></tr></table></figure></p>
<h3>不更新 podspec</h3>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod install --no-repo-update</span><br><span class="line">pod update --no-repo-update</span><br></pre></td></tr></table></figure></p>
<p>&lt;div id=&quot;a3&quot;&gt;&lt;/div&gt;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/10/Cocoapods使用详解/" data-id="cjptr3x3o0008lyz9z6ufpzbk" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoapods/">Cocoapods</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoapods教程/">Cocoapods教程</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS开发/">iOS开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS第三方库管理/">iOS第三方库管理</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-HTTP-API设计指南" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/10/HTTP-API设计指南/" class="article-date">
  <time datetime="2016-04-10T08:48:56.000Z" itemprop="datePublished">2016-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/10/HTTP-API设计指南/">HTTP API设计指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1>HTTP API 设计指南</h1>
<h2>前言</h2>
<p>这篇指南介绍描述了 HTTP+JSON API 的一种设计模式，最初摘录整理自 Heroku 平台的 API 设计指引 <a href="https://devcenter.heroku.com/articles/platform-api-reference" target="_blank" rel="noopener">Heroku 平台 API 指引</a>。</p>
<p>这篇指南除了详细介绍现有的 API 外，Heroku 将来新加入的内部 API 也会符合这种设计模式，我们希望非 Heroku 员工的API设计者也能感兴趣。</p>
<p>我们的目标是保持一致性，专注业务逻辑同时避免过度设计。我们一直试图找出一种良好的、一致的、显而易见的 API 设计方法，而并不是所谓的&quot;最终/理想模式&quot;。</p>
<p>我们假设你熟悉基本的 HTTP+JSON API 设计方法，所以本篇指南并不包含所有的 API 设计基础。</p>
<p>&lt;!--more--&gt;</p>
<h2>目录</h2>
<ul>
<li>基础
<ul>
<li>强制使用安全连接（Secure Connections）</li>
<li>强制头信息 Accept 中提供版本号</li>
<li>支持Etag缓存</li>
<li>为内省而提供 Request-Id</li>
<li>通过请求中的范围（Range）拆分大的响应</li>
</ul>
</li>
<li>请求（Requests）
<ul>
<li>在请求的body体使用JSON格式数据</li>
<li>使用统一的资源路径格式</li>
<li>路径和属性要小写</li>
<li>支持方便的无id间接引用</li>
<li>最小化路径嵌套</li>
</ul>
</li>
<li>响应（Responses）
<ul>
<li>返回合适的状态码</li>
<li>提供全部可用的资源</li>
<li>提供资源的(UU)ID</li>
<li>提供标准的时间戳</li>
<li>使用UTC（世界标准时间）时间，用ISO8601进行格式化</li>
<li>嵌套外键关系</li>
<li>生成结构化的错误</li>
<li>显示频率限制状态</li>
<li>保证响应JSON最小化</li>
</ul>
</li>
<li>工件（Artifacts）
<ul>
<li>提供机器可读的JSON模式</li>
<li>提供人类可读的文档</li>
<li>提供可执行的例子</li>
<li>描述稳定性</li>
</ul>
</li>
<li>译者注</li>
</ul>
<h3>基础</h3>
<h4>隔离关注点</h4>
<p>设计时通过将请求和响应之间的不同部分隔离来让事情变得简单。保持简单的规则让我们能更关注在一些更大的更困难的问题上。</p>
<p>请求和响应将解决一个特定的资源或集合。使用路径（path）来表明身份，body来传输内容（content）还有头信息（header）来传递元数据（metadata）。查询参数同样可以用来传递头信息的内容，但头信息是首选，因为他们更灵活、更能传达不同的信息。</p>
<h4>强制使用安全连接（Secure Connections）</h4>
<p>所有的访问API行为，都需要用 TLS 通过安全连接来访问。没有必要搞清或解释什么情况需要 TLS 什么情况不需要 TLS，直接强制任何访问都要通过 TLS。</p>
<p>理想状态下，通过拒绝所有非 TLS 请求，不响应 http 或80端口的请求以避免任何不安全的数据交换。如果现实情况中无法这样做，可以返回<code>403 Forbidden</code>响应。</p>
<p>把非 TLS 的请求重定向(Redirect)至 TLS 连接是不明智的，这种含混/不好的客户端行为不会带来明显好处。依赖于重定向的客户端访问不仅会导致双倍的服务器负载，还会使 TLS 加密失去意义，因为在首次非 TLS 调用时，敏感信息就已经暴露出去了。</p>
<h4>强制头信息 Accept 中提供版本号</h4>
<p>制定版本并在版本之间平缓过渡对于设计和维护一套API是个巨大的挑战。所以，最好在设计之初就使用一些方法来预防可能会遇到的问题。</p>
<p>为了避免API的变动导致用户使用中产生意外结果或调用失败，最好强制要求所有访问都需要指定版本号。请避免提供默认版本号，一旦提供，日后想要修改它会相当困难。</p>
<p>最适合放置版本号的位置是头信息(HTTP Headers)，在 <code>Accept</code> 段中使用自定义类型(content type)与其他元数据(metadata)一起提交。例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept: application/vnd.heroku+json; version=3</span><br></pre></td></tr></table></figure></p>
<h4>支持Etag缓存</h4>
<p>在所有返回的响应中包含<code>ETag</code>头信息，用来标识资源的版本。这让用户对资源进行缓存处理成为可能，在后续的访问请求中把<code>If-None-Match</code>头信息设置为之前得到的<code>ETag</code>值，就可以侦测到已缓存的资源是否需要更新。</p>
<h4>为内省而提供 Request-Id</h4>
<p>为每一个请求响应包含一个<code>Request-Id</code>头，并使用UUID作为该值。通过在客户端、服务器或任何支持服务上记录该值，它能为我们提供一种机制来跟踪、诊断和调试请求。</p>
<h4>通过请求中的范围（Range）拆分大的响应</h4>
<p>一个大的响应应该通过多个请求使用<code>Range</code>头信息来拆分，并指定如何取得。详细的请求和响应的头信息（header），状态码(status code)，范围(limit)，排序(ordering)和迭代(iteration)等，参考<a href="https://devcenter.heroku.com/articles/platform-api-reference#ranges" target="_blank" rel="noopener">Heroku Platform API discussion of Ranges</a>.</p>
<p>###请求（Requests）</p>
<h4>在请求的body体使用JSON格式数据</h4>
<p>在 <code>PUT</code>/<code>PATCH</code>/<code>POST</code> 请求的正文（request bodies）中使用JSON格式数据，而不是使用 form 表单形式的数据。这与我们使用JSON格式返回请求相对应，例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST https://service.com/apps \</span><br><span class="line">    -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">    -d &apos;&#123;&quot;name&quot;: &quot;demoapp&quot;&#125;&apos;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;demoapp&quot;,</span><br><span class="line">  &quot;owner&quot;: &#123;</span><br><span class="line">    &quot;email&quot;: &quot;username@example.com&quot;,</span><br><span class="line">    &quot;id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>使用统一的资源路径格式</h4>
<h5>资源名（Resource names）</h5>
<p>使用复数形式为资源命名，除非这个资源在系统中是单例的 (例如，在大多数系统中，给定的用户帐户只有一个)。 这种方式保持了特定资源的统一性。</p>
<h5>行为（Actions）</h5>
<p>好的末尾不需要为资源指定特殊的行为，但在特殊情况下，为某些资源指定行为却是必要的。为了描述清楚，在行为前加上一个标准的<code>actions</code>：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/resources/:resource/actions/:action</span><br></pre></td></tr></table></figure></p>
<p>例如：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/runs/&#123;run_id&#125;/actions/stop</span><br></pre></td></tr></table></figure></p>
<h4>路径和属性要小写</h4>
<p>为了和域名命名规则保持一致，使用小写字母并用<code>-</code>分割路径名字，例如：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service-api.com/users</span><br><span class="line">service-api.com/app-setups</span><br></pre></td></tr></table></figure></p>
<p>属性也使用小写字母，但是属性名要用下划线<code>_</code>分割，以便在Javascript中省略引号。 例如：</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service_class: "first"</span><br></pre></td></tr></table></figure></p>
<h4>支持方便的无id间接引用</h4>
<p>在某些情况下，让用户提供ID去定位资源是不方便的。例如，一个用户想取得他在Heroku平台app信息，但是这个app的唯一标识是UUID。这种情况下，你应该支持接口通过名字和ID都能访问，例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://service.com/apps/&#123;app_id_or_name&#125;</span><br><span class="line">$ curl https://service.com/apps/97addcf0-c182</span><br><span class="line">$ curl https://service.com/apps/www-prod</span><br></pre></td></tr></table></figure></p>
<p>不要只接受使用名字而放弃了使用id。</p>
<h4>最小化路径嵌套</h4>
<p>在一些有父路径/子路径嵌套关系的资源数据模块中，路径可能有非常深的嵌套关系，例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/orgs/&#123;org_id&#125;/apps/&#123;app_id&#125;/dynos/&#123;dyno_id&#125;</span><br></pre></td></tr></table></figure></p>
<p>推荐在根(root)路径下指定资源来限制路径的嵌套深度。使用嵌套指定范围的资源。在上述例子中，dyno属于app，app属于org可以表示为：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/orgs/&#123;org_id&#125;</span><br><span class="line">/orgs/&#123;org_id&#125;/apps</span><br><span class="line">/apps/&#123;app_id&#125;</span><br><span class="line">/apps/&#123;app_id&#125;/dynos</span><br><span class="line">/dynos/&#123;dyno_id&#125;</span><br></pre></td></tr></table></figure></p>
<h3>响应（Responses）</h3>
<h4>返回合适的状态码</h4>
<p>为每一次的响应返回合适的HTTP状态码。 好的响应应该使用如下的状态码:</p>
<ul>
<li><code>200</code>: <code>GET</code>请求成功，及<code>DELETE</code>或<code>PATCH</code>同步请求完成，或者<code>PUT</code>同步更新一个已存在的资源</li>
<li><code>201</code>: <code>POST</code> 同步请求完成，或者<code>PUT</code>同步创建一个新的资源</li>
<li><code>202</code>: <code>POST</code>，<code>PUT</code>，<code>DELETE</code>，或<code>PATCH</code>请求接收，将被异步处理</li>
<li><code>206</code>: <code>GET</code> 请求成功，但是只返回一部分，参考：<a href="#%E6%8C%89%E8%8C%83%E5%9B%B4%E5%88%86%E9%A1%B5">上文中范围分页</a></li>
</ul>
<p>使用身份认证（authentication）和授权（authorization）错误码时需要注意：</p>
<ul>
<li><code>401 Unauthorized</code>: 用户未认证，请求失败</li>
<li><code>403 Forbidden</code>: 用户无权限访问该资源，请求失败</li>
</ul>
<p>当用户请求错误时，提供合适的状态码可以提供额外的信息：</p>
<ul>
<li><code>422 Unprocessable Entity</code>: 请求被服务器正确解析，但是包含无效字段</li>
<li><code>429 Too Many Requests</code>: 因为访问频繁，你已经被限制访问，稍后重试</li>
<li><code>500 Internal Server Error</code>: 服务器错误，确认状态并报告问题</li>
</ul>
<p>对于用户错误和服务器错误情况状态码，参考：  <a href="https://tools.ietf.org/html/rfc7231#section-6" target="_blank" rel="noopener">HTTP response code spec</a></p>
<h4>提供全部可用的资源</h4>
<p>提供全部可显现的资源表述 (例如： 这个对象的所有属性) ，当响应码为200或是201时返回所有可用资源，包含 <code>PUT</code>/<code>PATCH</code> 和 <code>DELETE</code>
请求，例如:</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE \  </span><br><span class="line">  https://service.com/apps/1f9b/domains/0fd4</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=utf-8</span><br><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"created_at"</span>: <span class="string">"2012-01-01T12:00:00Z"</span>,</span><br><span class="line">  <span class="attr">"hostname"</span>: <span class="string">"subdomain.example.com"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span>,</span><br><span class="line">  <span class="attr">"updated_at"</span>: <span class="string">"2012-01-01T12:00:00Z"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当请求状态码为202时，不返回所有可用资源，例如：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE \  </span><br><span class="line">  https://service.com/apps/1f9b/dynos/05bd</span><br><span class="line"></span><br><span class="line">HTTP/1.1 202 Accepted</span><br><span class="line">Content-Type: application/json;charset=utf-8</span><br><span class="line">...</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<h4>提供资源的(UU)ID</h4>
<p>在默认情况给每一个资源一个<code>id</code>属性。除非有更好的理由，否则请使用UUID。不要使用那种在服务器上或是资源中不是全局唯一的标识，尤其是自动增长的id。</p>
<p>生成小写的UUID格式 <code>8-4-4-4-12</code>，例如：</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"id": "01234567-89ab-cdef-0123-456789abcdef"</span><br></pre></td></tr></table></figure></p>
<h4>提供标准的时间戳</h4>
<p>为资源提供默认的创建时间 <code>created_at</code> 和更新时间 <code>updated_at</code>，例如:</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  "created_at": "2012-01-01T12:00:00Z",</span><br><span class="line">  "updated_at": "2012-01-01T13:00:00Z",</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>有些资源不需要使用时间戳那么就忽略这两个字段。</p>
<h4>使用UTC（世界标准时间）时间，用ISO8601进行格式化</h4>
<p>仅接受和返回UTC格式的时间。ISO8601格式的数据，例如:</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"finished_at": "2012-01-01T12:00:00Z"</span><br></pre></td></tr></table></figure></p>
<h4>嵌套外键关系</h4>
<p>使用嵌套对象序列化外键关联，例如:</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"service-production"</span>,</span><br><span class="line">  <span class="attr">"owner"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"5d8201b0..."</span></span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而不是像这样:</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"service-production"</span>,</span><br><span class="line">  <span class="attr">"owner_id"</span>: <span class="string">"5d8201b0..."</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这种方式尽可能的把相关联的资源信息内联在一起，而不用改变资源的结构，或者引入更多的顶层字段，例如:</p>
<p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"service-production"</span>,</span><br><span class="line">  <span class="attr">"owner"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="string">"5d8201b0..."</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"Alice"</span>,</span><br><span class="line">    <span class="attr">"email"</span>: <span class="string">"alice@heroku.com"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4>生成结构化的错误</h4>
<p>响应错误的时，生成统一的、结构化的错误信息。包含一个机器可读的错误 <code>id</code>，一个人类可读的错误信息（<code>message</code>），根据情况可以添加一个<code>url</code>来告诉客户端关于这个错误的更多信息以及如何去解决它，例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 429 Too Many Requests</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"id"</span>:      <span class="string">"rate_limit"</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"Account reached its API rate limit."</span>,</span><br><span class="line">  <span class="attr">"url"</span>:     <span class="string">"https://docs.service.com/rate-limits"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>文档化错误信息格式，以及客户端可能遇到的错误信息<code>id</code>。</p>
<h4>显示频率限制状态</h4>
<p>客户端的访问速度限制可以维护服务器的良好状态，保证为其他客户端请求提供高性的服务。你可以使用<a href="http://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="noopener">token bucket algorithm</a>技术量化请求限制。</p>
<p>为每一个带有<code>RateLimit-Remaining</code>响应头的请求，返回预留的请求tokens。</p>
<h4>保证响应JSON最小化</h4>
<p>请求中多余的空格会增加响应大小，而且现在很多的HTTP客户端都会自己输出可读格式（&quot;prettify&quot;）的JSON。所以最好保证响应JSON最小化，例如：</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"beta"</span>:<span class="literal">false</span>,<span class="attr">"email"</span>:<span class="string">"alice@heroku.com"</span>,<span class="attr">"id"</span>:<span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span>,<span class="attr">"last_login"</span>:<span class="string">"2012-01-01T12:00:00Z"</span>,<span class="attr">"created_at"</span>:<span class="string">"2012-01-01T12:00:00Z"</span>,<span class="attr">"updated_at"</span>:<span class="string">"2012-01-01T12:00:00Z"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>而不是这样：</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"beta"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"email"</span>: <span class="string">"alice@heroku.com"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span>,</span><br><span class="line">  <span class="attr">"last_login"</span>: <span class="string">"2012-01-01T12:00:00Z"</span>,</span><br><span class="line">  <span class="attr">"created_at"</span>: <span class="string">"2012-01-01T12:00:00Z"</span>,</span><br><span class="line">  <span class="attr">"updated_at"</span>: <span class="string">"2012-01-01T12:00:00Z"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>你可以提供可选的方式为客户端提供更详细可读的响应，使用查询参数（例如：<code>?pretty=true</code>）或者通过<code>Accept</code>头信息参数（例如：<code>Accept: application/vnd.heroku+json; version=3; indent=4;</code>）。</p>
<p>###工件（Artifacts）</p>
<h4>提供机器可读的JSON模式</h4>
<p>提供一个机器可读的模式来恰当的表现你的API。使用
<a href="https://github.com/interagent/prmd" target="_blank" rel="noopener">prmd</a>管理你的模式，并且确保用<code>prmd verify</code>验证是有效的。</p>
<h4>提供人类可读的文档</h4>
<p>提供人类可读的文档让客户端开发人员可以理解你的API。</p>
<p>如果你用prmd创建了一个概要并且按上述要求描述，你可以为所有节点很容易的使用<code>prmd doc</code>生成Markdown文档。</p>
<p>除了节点信息，提供一个API概述信息:</p>
<ul>
<li>验证授权，包含如何取得和如何使用token。</li>
<li>API稳定及版本管理，包含如何选择所需要的版本。</li>
<li>一般情况下的请求和响应的头信息。</li>
<li>错误的序列化格式。</li>
<li>不同编程语言客户端使用API的例子。</li>
</ul>
<h4>提供可执行的例子</h4>
<p>提供可执行的示例让用户可以直接在终端里面看到API的调用情况，最大程度的让这些示例可以简单的使用，以减少用户尝试使用API的工作量。例如:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export TOKEN=... # acquire from dashboard</span><br><span class="line">$ curl -is https://$TOKEN@service.com/users</span><br></pre></td></tr></table></figure></p>
<p>如果你使用<a href="https://github.com/interagent/prmd" target="_blank" rel="noopener">prmd</a>生成Markdown文档，每个节点都会自动获取一些示例。</p>
<h4>描述稳定性</h4>
<p>描述您的API的稳定性或是它在各种各样节点环境中的完备性和稳定性，例如：加上 原型版（prototype）/开发版（development）/产品版（production）等标记。</p>
<p>更多关于可能的稳定性和改变管理的方式，查看 <a href="https://devcenter.heroku.com/articles/api-compatibility-policy" target="_blank" rel="noopener">Heroku API compatibility policy</a></p>
<p>一旦你的API宣布产品正式版本及稳定版本时，不要在当前API版本中做一些不兼容的改变。如果你需要，请创建一个新的版本的API。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/10/HTTP-API设计指南/" data-id="cjptr3x8g00dslyz95diltzrh" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API设计/">API设计</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP-API/">HTTP-API</a></li></ul>

    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">下一页&raquo;</a>
  </nav>
</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/12/18/Nodejs中编写异步的单元测试代码/">Nodejs中编写异步的单元测试代码</a>
          </li>
        
          <li>
            <a href="/2018/11/30/理解JavaScript中的浮点数/">理解JavaScript中的浮点数</a>
          </li>
        
          <li>
            <a href="/2018/11/21/理解prototype、getPrototypeOf和-proto-之间的不同/">理解prototype、getPrototypeOf和 _proto _之间的不同</a>
          </li>
        
          <li>
            <a href="/2018/11/14/javascript——为自己的库编写更健壮的API函数/">javascript——为自己的库编写更健壮的API函数</a>
          </li>
        
          <li>
            <a href="/2018/10/09/服务器的Mysql初始化设置/">服务器的Mysql初始化设置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 李晓&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;xiao.liunit@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>