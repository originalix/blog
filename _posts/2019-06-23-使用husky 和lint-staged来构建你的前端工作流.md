---
layout: post
title: ä½¿ç”¨ husky å’Œ lint-staged æ¥æ„å»ºä½ çš„å‰ç«¯å·¥ä½œæµ
categories: å‰ç«¯åœˆ
description: å‰ç«¯å·¥ä½œæµæ„å»º
keywords: husky, lint-staged, ESLint
---

ESLint æ˜¯ä¸€ä¸ªåœ¨å‰ç«¯å·¥å…·é“¾ä¸­è¢«ä¼—äººç†ŸçŸ¥çš„ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿè¢«å¼€å‘è€…çµæ´»çš„é…ç½®ï¼Œä½¿å…¶èƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬æå‰åˆ¶å®šå¥½çš„ä»£ç è§„èŒƒçš„è¦æ±‚ï¼Œå¹¶ä¸”åœ¨ç¼–ç è¿‡ç¨‹ä¸­å®æ—¶æ£€æµ‹è¾“å…¥çš„ä»£ç ï¼Œå¯¹äºä¸ç¬¦åˆä»£ç è§„èŒƒçš„ä»£ç è­¦å‘Šæˆ–æŠ¥é”™ã€‚ä¸å¾—ä¸è¯´ï¼Œåœ¨æœ‰äº† ESLint è¿™ä¸ªå·¥å…·ä¹‹åï¼Œå›¢é˜Ÿä¹‹é—´å¼€å‘ç»´æŠ¤ä¼šèˆ’æœå¾ˆå¤šï¼Œå› ä¸ºåœ¨å¼ºåˆ¶çº¦æŸä¸‹ï¼Œä½ åªéœ€è¦å»ç†è§£ä»£ç æœ¬èº«çš„å«ä¹‰å°±å¯ä»¥äº†ï¼Œå¯¹äºé£æ ¼çš„é—®é¢˜åˆ™å°‘äº†å¾ˆå¤šéº»çƒ¦ã€‚

æ—¢ç„¶ ESLint è¿™ä¹ˆå¥½ç”¨ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆåˆè¦å¼•å…¥ä»Šå¤©è¦ä»‹ç»çš„è¿™ä¸¤ç§å·¥å…·å‘¢ï¼Ÿå› ä¸ºåœ¨æ—¥å¸¸çš„å›¢é˜Ÿå·¥ä½œä¸­ï¼Œè‡ªè§‰åœ°åŒå­¦ä¼šå°† ESLint çš„è­¦å‘Šæˆ–æŠ¥é”™ä¿®å¤äº†å†æäº¤ä»£ç ï¼Œè€Œæ€»æœ‰ä¸€äº›ä¸è‡ªè§‰çš„ï¼Œå¯¹äºä»£ç é£æ ¼ä¸é‡è§†çš„åŒå­¦ï¼Œä¼šä¸ç®¡æŠ¥é”™ï¼Œç›´æ¥å°†ä»£ç é£æ ¼ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç æäº¤åˆ° git ä»“åº“ä¸­ï¼Œä¹…è€Œä¹…ä¹‹éšä¹‹é¡¹ç›®çš„ä»£ç æ•°é‡è¶Šæ¥è¶Šå¤šï¼ŒESLint æŠ¥é”™çš„åœ°æ–¹ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œæƒ³è¦ä¸€ä¸ªä¸€ä¸ªä¿®å¤å®åœ¨æ˜¯ç§¯é‡éš¾è¿”ã€‚äºæ˜¯å½“æˆ‘åœ¨ä½¿ç”¨ Vant è¿™ä¸ªå‰ç«¯å¼€æºç»„ä»¶åº“çš„æ—¶å€™ï¼Œæäº¤ä»£ç çš„è¿‡ç¨‹ä¸­å‘ç°ä»–ä»¬åœ¨ commit ä¹‹å‰ä¼šæ£€æŸ¥ä½ æäº¤çš„ä»£ç æ˜¯å¦è§„èŒƒï¼Œå½“æ—¶å°±è§‰å¾—è¿™ä¸ªéå¸¸å®ç”¨ï¼Œåæ¥å‘ç°ç”¨ git æä¾›çš„ä¸€ç»„ hook å¯ä»¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œ`git commit` æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥è§¦å‘å››ä¸ª hook ï¼Œåˆ†åˆ«æ˜¯ `pre-commit`, `prepare-commit-msg`, `commit-msg` å’Œ `post-commit`ã€‚ ä»å­—é¢ä¸ŠçŒœæµ‹ç€å››ä¸ª hook åˆ†åˆ«å¯¹åº”äº† â€œcommit ä¹‹å‰â€ï¼Œâ€œå‡†å¤‡ commit log message çš„æ—¶å€™â€ï¼Œâ€œç”Ÿæˆ commit log message çš„æ—¶å€™â€ï¼Œâ€œcommit ä¹‹åâ€å››ä¸ªé˜¶æ®µã€‚

è€Œæˆ‘ä»¬è¦è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œå…¶å®åªéœ€è¦åœ¨ 'pre-commit' è¿™ä¸ªé˜¶æ®µå»å†™ä¸€æ®µè„šæœ¬ï¼Œå°±èƒ½è§£å†³æˆ‘ä»¬æ£€æµ‹ä»£ç çš„é—®é¢˜ã€‚

æ­£å½“æˆ‘å‡†å¤‡å†™è„šæœ¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå‘ç° github ä¸Šæœ‰ä¸€ä¸ªå·²ç»è¢«é€ å¥½çš„è½®å­ï¼Œæœ‰å¾ˆå¤šçš„ starï¼Œäºæ˜¯ä¹ï¼Œæœ¬ç€ä¸é‡å¤é€ è½®å­çš„ç²¾ç¥ï¼Œæˆ‘å»çœ‹äº†ä¸€ä¸‹è¿™ä¸¤ä¸ªå·¥å…·çš„æ–‡æ¡£ã€‚

### husky

husky è¿™ä¸ªåº“ï¼Œè€å¸ˆè¯´æˆ‘çœ‹ä»–çš„æ–‡æ¡£çš„æ—¶å€™çœ‹ç¬‘äº†ï¼Œä¸ä¸ºåˆ«çš„ï¼Œå°±ä¸ºäº†è¿™ä¸ªå‘½åã€‚æˆ‘çš„ç†è§£æ˜¯ä½œè€…è§‰å¾—è¿™ä¸ªåº“çš„ä½œç”¨æ˜¯çœ‹(chai)å®¶æŠ¤é™¢çš„äºŒå“ˆä¹ˆï¼Ÿ

> Husky can prevent bad git commit, git push and more ğŸ¶ woof!

Husky èƒ½å¤Ÿå¸®ä½ é˜»æŒ¡ä½ä¸å¥½çš„ä»£ç æäº¤å’Œæ¨é€ã€‚ä¸€å¥è¯å¾ˆç²¾å‡†çš„è¯´æ˜äº†è¿™ä¸ªåº“çš„æ„ä¹‰ï¼Œè€Œé…ç½®ä¹Ÿéå¸¸ç®€å•ï¼Œ

```js
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm test",
      "pre-push": "npm test",
      "...": "..."
    }
  }
}
```

å°±åƒè¿™æ ·ï¼Œåœ¨æˆ‘ä»¬çš„ `package.json` ä¸­é…ç½® huskyï¼Œå¹¶ä¸”åœ¨å¯¹åº”çš„ git hook é˜¶æ®µæ¥æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚äºæ˜¯ä¹ï¼Œä¸ç”¨ç¹ççš„å»é…ç½® git hook é˜¶æ®µçš„è„šæœ¬æ–‡ä»¶äº†ï¼Œæä¾›å¯¹åº”çš„ node æ“ä½œå˜å¥½ã€‚

### lint-staged

lint-stage è¿™ä¸ªåº“æ˜¯è¿™ä¹ˆè§£é‡Šå®ƒçš„å­˜åœ¨çš„ã€‚

åœ¨ä½ æäº¤ä»£ç ä¹‹å‰ï¼ŒLinting çš„è¿è¡Œæ˜¯æ›´æœ‰æ„ä¹‰çš„ã€‚å½“ä½ è¿™æ ·å»åšäº†ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ›´å°‘çš„é”™è¯¯è¿›å…¥ä½ çš„ä»£ç åº“ã€‚

æœ‰å¤šç§æ–¹å¼èƒ½å¤Ÿé…ç½® lint-stagedï¼Œä¾‹å¦‚åœ¨ `package.json` ä¸­æ·»åŠ å¯¹åº”çš„å¯¹è±¡ï¼Œä¾‹å¦‚ä½¿ç”¨ JSON æˆ–è€… YML æ–‡ä»¶æ¥é…ç½®ï¼Œä¾‹å¦‚å†™ä¸€ä¸ª js æ–‡ä»¶æ¥é…ç½®ç­‰ç­‰ã€‚

è€Œé‰´äºæˆ‘ä»¬çš„ husky ä½¿ç”¨äº† package.json çš„æ–¹å¼æ¥é…ç½®ï¼Œé‚£ä¹ˆ lint-staged ä¹Ÿä¿æŒç»Ÿä¸€ä½¿ç”¨åŒæ ·çš„æ–¹å¼å¥½äº†ã€‚

```js
// in package.json
{
  "lint-staged": {
    "*.{js, vue, css}": [
      "eslint",
      "git add"
    ]
  }
}

```

å½“ä½ è¿™æ ·é…ç½®å®Œæˆï¼Œåœ¨ä½ çš„ git commit ä¹‹å‰ï¼Œä¼šè‡ªåŠ¨è§¦å‘ eslint æ£€æŸ¥ï¼Œå¦‚æœä½ çš„ä»£ç é£æ ¼æ²¡é—®é¢˜ï¼Œcommit ä¼šæˆåŠŸï¼Œå¦åˆ™æäº¤ä¼šå¤±è´¥å“¦ã€‚

å¯¹äºè¿™æ ·å¥½çš„å·¥å…·ï¼Œé—­ç€çœ¼ç›å°±èƒ½æŒ‰ star äº†ï¼Œç»Ÿä¸€å›¢é˜Ÿçš„ä»£ç é£æ ¼ï¼ŒçœŸçš„å¾ˆé‡è¦ã€‚èƒ½å¤Ÿè®©é”™è¯¯é˜²èŒƒäºæœªç„¶ã€‚
