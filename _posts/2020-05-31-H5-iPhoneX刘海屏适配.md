---
layout: post
title: H5 é¡µé¢ iPhoneX åˆ˜æµ·å±é€‚é…
categories: CSS
description: H5åˆ˜æµ·å±é€‚é…
keywords: CSS, å‰ç«¯, Hybrid, iPhoneX, åˆ˜æµ·å±
---

> éšç€è¿™ä¸¤å¹´è‹¹æœåšå®šä¸ç§»çš„èµ°åˆ˜æµ·å±è·¯çº¿ï¼ŒHybrid é¡µé¢åœ¨ iPhoneX ä¸Šåˆ˜æµ·å±çš„é€‚é…ä¹Ÿæ˜¯æ¯ä¸ªå‰ç«¯å¼€å‘çš„å°ä¼™ä¼´éƒ½ä¼šç¢°åˆ°çš„é—®é¢˜ï¼Œä»Šå¤©å°±è®°å½•ä¸€ä¸‹æˆ‘å…³äºåˆ˜æµ·å±é€‚é…çš„éƒ¨åˆ†ç»éªŒã€‚

å¯¹äºåˆ˜æµ·å±çš„é€‚é…ï¼Œä½ çš„è„‘å­é‡Œé¦–å…ˆå¾—æœ‰è‹¹æœæ‰‹æœºçš„ Safe Area çš„æ¦‚å¿µï¼Œå…³äº Safe Area ç½‘ä¸Šçš„èµ„æ–™å·²ç»éå¸¸å¤šäº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ï¼Œæ›´åå‘å®æˆ˜ä¸€ç‚¹ã€‚ä½†æ˜¯ä¸ºäº†æ¯”è¾ƒï¼Œæˆ‘è¿™é‡Œç»™å‡ºä¸€å¼ è‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒiPhone8ä¹‹å‰çš„å¸¸è§„å±å¹•å’Œåˆ˜æµ·å± Safe Area åŒºåŸŸçš„å¯¹æ¯”å›¾ã€‚

![](https://github.com/originalix/originalix.github.io/blob/master/assets/images/safe-area.png?raw=true)

å¾ˆæ˜æ˜¾ï¼Œåœ¨è®¨è®ºé€‚é…ä¹‹å‰ï¼Œæˆ‘ä»¬çš„é¡µé¢ä¸€èˆ¬æœ‰ä¸¤ç§åˆ†ç±»ï¼š
- 1ã€H5 é¡µé¢ä½¿ç”¨åŸç”Ÿ App çš„ Navigation Bar å¯¼èˆªæ ï¼Œæ­¤æ—¶ï¼Œstatus bar çŠ¶æ€æ å’Œå¯¼èˆªæ éƒ½æ˜¯åŸç”Ÿæ§ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸“æ³¨çš„é€‚é…åº•éƒ¨å°é»‘æ¡å¤„çš„é«˜åº¦å·®å¼‚å³å¯ã€‚
- 2ã€H5 é¡µé¢åœ¨ iOS ä¸­å æ®å…¨å±é¡µé¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤äº†è¦å…¼é¡¾åº•éƒ¨å°é»‘æ¡ï¼Œæˆ‘ä»¬è¿˜è¦å¤„ç†é¡µé¢ä¸Šéƒ¨è·Ÿ çŠ¶æ€æ æ¥è§¦çš„éƒ¨åˆ†ï¼Œé¿å…å†…å®¹å‡ºç°åœ¨çŠ¶æ€æ ä¸Šã€‚

## env å‡½æ•°

åœ¨ä»‹ç»é€‚é…ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹é€‚é…ç”¨åˆ°çš„å…³é”® CSS å‡½æ•° â€”â€” `env()`ã€‚`env()`å‡½æ•°ä»¥ç±»ä¼¼äº`var`å‡½æ•°çš„æ–¹å¼å°†ç”¨æˆ·ä»£ç†å®šä¹‰çš„ç¯å¢ƒå˜é‡å€¼æ’å…¥åˆ°ä½ çš„ CSS ä¸­å»ã€‚è¿™ä¸ªå‡½æ•°æœ€åˆç”± iOS æµè§ˆå™¨æä¾›ï¼Œç”¨äºå…è®¸å¼€å‘äººå‘˜å°†å…¶å†…å®¹æ”¾ç½®åœ¨è§†å£çš„å®‰å…¨åŒºåŸŸä¸­ï¼Œè¯¥è§„èŒƒä¸­å®šä¹‰çš„ `safe-area-inset-*` å€¼ç”¨äºç¡®ä¿å†…å®¹å³ä½¿åœ¨éçŸ©å½¢çš„è§†åŒºä¸­ä¹Ÿå¯ä»¥å®Œå…¨æ˜¾ç¤ºã€‚

## é¡µé¢é€‚é…

åœ¨ä¸ºé¡µé¢é€‚é…åˆ˜æµ·å±ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—åœ¨é¡µé¢çš„ meta ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å€¼ï¼š`viewport-fit=cover`

```html
<meta name="viewport" content="viewport-fit=cover">
```

è¿™ä¹ˆè®¾ç½®ä¹‹åï¼Œè§†å›¾ç«¯å£è¢«ç¼©æ”¾ä»¥å¡«å……è®¾å¤‡æ˜¾ç¤ºã€‚æ¢å¥è¯è¯´å°±æ˜¯ç½‘é¡µä¼šæ‰©å±•åˆ°æ•´ä¸ªå±å¹•ã€‚

çœ‹ä¸€é¡µç›®å‰çš„é¡µé¢æ•ˆæœï¼š

![](https://github.com/originalix/originalix.github.io/blob/master/assets/images/safe-area-viewport.png?raw=true)

å¯ä»¥çœ‹åˆ°ç°åœ¨æˆ‘ä»¬çš„æµ‹è¯•é¡µé¢å·²ç»é“ºæ»¡äº†æ•´ä¸ªå±å¹•ã€‚

è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨ä¹‹å‰æåˆ°çš„ env å‡½æ•°ï¼Œé€‚é…åˆ˜æµ·å±å¹•ã€‚

```css
body {
  padding:
    constant(safe-area-inset-top)
    constant(safe-area-inset-right)
    constant(safe-area-inset-bottom)
    constant(safe-area-inset-left); /* å…¼å®¹ iOS < 11.2 */
  padding:
    env(safe-area-inset-top)
    env(safe-area-inset-right)
    env(safe-area-inset-bottom)
    env(safe-area-inset-left); /* å…¼å®¹ iOS >= 11.2 */
}
```

ä¸ºä»€ä¹ˆè¿™é‡Œä¼šä½¿ç”¨ constant å‘¢ï¼Ÿæºäºå®˜æ–¹æ–‡æ¡£çš„ä¸€æ®µæ³¨é‡Šï¼š

```
The env() function shipped in iOS 11 with the name constant(). Beginning with Safari Technology Preview 41 and the iOS 11.2 beta, constant() has been removed and replaced with env(). You can use the CSS fallback mechanism to support both versions, if necessary, but should prefer env() going forward.
```
æ„å‘³ç€ iOS11.2 ä»¥å `constant()` ä¸èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦å‘åå…¼å®¹ã€‚

æ­¤æ—¶å†çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„é¡µé¢æ•ˆæœï¼š

![](https://github.com/originalix/originalix.github.io/blob/master/assets/images/safe-area-top.png?raw=true)

![](https://github.com/originalix/originalix.github.io/blob/master/assets/images/safe-area-bottom.png?raw=true)

å¯ä»¥çœ‹åˆ°é¡µé¢çš„é¡¶éƒ¨ï¼Œå› ä¸º `safe-area-inset-top` é¿å¼€äº†çŠ¶æ€æ ï¼Œè€Œåº•éƒ¨å› ä¸º `safe-area-inset-bottom` é¿å¼€äº†å°é»‘æ¡ï¼Œå®Œç¾çš„æ˜¾ç¤ºåœ¨äº† Safe Area çš„åŒºåŸŸä¸­ã€‚

å½“ä½ çš„é¡µé¢ä¸ä½¿ç”¨åŸç”Ÿå¯¼èˆªæ é“ºåœ¨æ•´ä¸ªå±å¹•ä¸­æ—¶ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªä¸é”™çš„é€‚é…æ–¹æ¡ˆã€‚

è€Œå½“ä½ ä½¿ç”¨äº†åŸç”Ÿå¯¼èˆªæ ï¼Œä»…ä»…éœ€è¦é€‚é…åº•éƒ¨å°é»‘æ¡æ—¶ï¼Œè§£å†³æ–¹æ¡ˆå°±æ›´ç®€å•äº†ï¼Œç®€å•è®¾ç½® `safe-area-inset-bottom`å°±å¯ä»¥ï¼š

```css
body {
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
}
```

## å¤„ç† Fixed å’Œ ç»å¯¹å®šä½çš„æƒ…å†µ

æœ‰æ—¶æˆ‘ä»¬åº•éƒ¨çš„å…ƒç´ æ˜¯é€šè¿‡ fixed æˆ–è€… absolute å®šä½æ”¾ç½®çš„ï¼Œä¾‹å¦‚åº•éƒ¨çš„æŒ‰é’®ã€å·¥å…·æ ç­‰ç­‰ï¼Œå¯¹äºè¿™äº›å…ƒç´ ï¼Œç®€å•çš„ä½¿ç”¨ `safe-area-inset-bottom` æ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹è¯¥å…ƒç´ å•ç‹¬å¢åŠ å†…è¾¹è·çš„ padding æ¥è§£å†³ã€‚

```css
.element {
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
}
```

æˆ–è€…é€šè¿‡å¢åŠ è¯¥å…ƒç´ çš„é«˜åº¦æ¥è§£å†³

```css
@element-height: 60px; /* å…ƒç´ åŸå§‹é«˜åº¦ */
.element {
  height: calc(@element-height + constant(safe-area-inset-bottom));
  height: calc(@element-height + env(safe-area-inset-bottom));
}
```

ä»¥åŠä½ å¯ä»¥é€šè¿‡ lessã€sass çš„å‡½æ•°ï¼Œé€šè¿‡åª’ä½“æŸ¥è¯¢æ¥å‡†ç¡®çš„å®šä½åˆ°åˆ˜æµ·å±çš„æ‰‹æœºï¼Œç„¶åå†™å…¥ä½ å¸Œæœ›åˆ˜æµ·å±æ‰‹æœºå±•ç¤ºçš„ä»»ä½•æ ·å¼ã€‚

ä¸‹é¢æˆ‘å°±æ”¾ä¸€ä¸ªæˆ‘å†™çš„ less é€‚é…åˆ˜æµ·å±çš„ä¾‹å­ï¼š

```css
/**
 *  é€‚é… iPhoneX åŠä»¥åçš„åˆ˜æµ·å±æ‰‹æœºï¼Œå¯ä»¥è‡ªè¡Œç¼–å†™ rules è§„åˆ™
 */
.safe-area(@rules) {
  /* iphone x / xs / 11 pro*/
  @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) { @rules(); }
  /* iphone xr / 11  stackoverflow æä¾›åˆ¤æ–­ */
  @media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) { @rules(); }
  // å®é™…å¯ç”¨çš„ xr åˆ¤æ–­
  @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 2) { @rules(); }
  /* iphone xs max / 11 pro max */
  @media only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) { @rules(); }
}

// å…·ä½“ä½¿ç”¨
.safe-area({
  height: 100px;
  padding-bottom: env(safe-area-bottom-height);
});
```

å½“ç¼–è¯‘åï¼Œå°±å¯ä»¥æ ¹æ®æœºå‹å®Œæˆé€‚é…ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå®æµ‹æ—¶ï¼Œå¯¹äº iPhone XR æˆ‘ç”¨åœ¨ stackoverflow ä¸Šæ‰¾åˆ°çš„ media query æ¡ä»¶æ¥åˆ¤æ–­ä¸ç”Ÿæ•ˆï¼Œåæ¥ç»è¿‡æŸ¥æ‰¾èµ„æ–™ï¼Œæˆ‘æ‰¾åˆ°ä¸€ä¸ªåœ¨ iPhone XR ä¸Šå®é™…å¯ç”¨çš„æ¡ä»¶ï¼Œä¹Ÿä¸€å¹¶æ”¾åœ¨ä¸Šé¢çš„ä»£ç ä¸­ã€‚

æœ€åï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°ä½ åœ¨é€‚é…ä¸­å¡«å‘ï¼Œè¯·ç»™æˆ‘ç‚¹ä¸ªèµå“¦ ğŸ‘‘
