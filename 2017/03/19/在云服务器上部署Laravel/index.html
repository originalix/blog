<!DOCTYPE html><html lang=""><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在云服务器上部署Laravel | Originalee的博客</title><meta name="description" content="在云服务器上部署Laravel - Originalee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/casual.css"><link rel="stylesheet" href="/css/semantic.min.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Originalee的博客"></head><body><div class="sidebar"><div class="ui vertical inverted menu"><div class="h100"></div><h3 class="ui inverted aligned icon header"><div class="content"><a href="/" class="title-link">ORIGINALEE的博客</a></div></h3><div class="h50"></div><div class="side-nav"><a href="/" target="_self" class="item">HOME<i class="icon home"></i></a><a href="/archives" target="_self" class="item">ARCHIVE<i class="icon archive"></i></a><a href="/about" target="_self" class="item">INFO<i class="icon info"></i></a><a href="/atom.xml" target="_self" class="item">RSS<i class="icon rss"></i></a></div><div class="item"><div class="ui inverted transparent icon input"><input type="text" placeholder="Search..." class="st-default-search-input"><i class="search icon"></i></div></div><div class="h50"></div></div><div class="h50 mq"><a class="ui teal big label"><i class="content icon"></i></a></div><div class="author-info"><a href="/" class="img-link"><img src="/avatar.png" class="author-photo ui tiny circular image"></a><h4 class="ui aligned icon header"><div class="content">Originalee</div></h4><p class="author-desc">爱打篮球的程序员|目前移动端爬坑中</p><div class="social-outer"><div class="social-inner"><a href="https://github.com/originalix" target="_blank" class="social-link"><i class="icon github"></i></a><a href="mailto:xiao.liunit@gmail.com" target="_self" class="social-link"><i class="icon mail"></i></a></div></div></div></div><div class="main"><div class="wrap"><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">在云服务器上部署Laravel</h1><div class="post-info"><div class="post-date"><h6 class="ui header"><i class="calendar icon"></i><div class="content">Mar 19, 2017</div></h6></div></div><div class="post-content"><p>学习PHP和Laravel已经有一段时间了,但是所有的代码都是跑在本地的虚拟主机上的，于是去腾讯云申请了一个月的免费云主机，想把项目部署到云服务器上。</p>
<p>不得不说这里面的坑实在是有点多，让我这个初次接触服务器的小白摸不清头脑。在配置好服务器之后，部署一个Laravel项目更是费劲心思，于是乎想记录下部署Laravel项目的过程。</p>
<p>PS： Linux真是越用越有感觉的系统，回家在台式机上也要装个Linux敲代码用。</p>
<p>&lt;!--more--&gt;</p>
<h1>环境简介</h1>
<p>在操作系统的选择上，我选用了Linux ubuntu16.04的系统，使用的是LNMP的环境，即 Linux + Nginx + Mysql + PHP的环境。</p>
<h2>删除Apache</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service apache2 stop</div></pre></td></tr></table></figure></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update-rc.d <span class="_">-f</span> apache2 remove</div></pre></td></tr></table></figure></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get remove apache2</div></pre></td></tr></table></figure></p>
<p>先用这三条命令来删除Apaceh 之后更新一下包列表</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div></pre></td></tr></table></figure></p>
<h2>1.安装Nginx</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install nginx</div></pre></td></tr></table></figure></p>
<p>在安装完Nginx之后，要重启nginx</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service nginx start</div></pre></td></tr></table></figure></p>
<p>执行完之后，在浏览器输入云服务器分配给你的公网ip，就可以看到welcome to nginx的界面了</p>
<h2>2. 安装Mysql</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install mysql-server mysql-client</div></pre></td></tr></table></figure></p>
<p>过程中会提示你设置Mysql的密码，就跟平时的密码设置一样，一次输入，一次确认。密码确认完毕后基本等一会就安装好了。尝试</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u root -p</div></pre></td></tr></table></figure></p>
<p>如果登录成功，那Mysql就正确安装了。</p>
<h2>3.安装PHP</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install php5-fpm php5-cli php5-mcrypt</div></pre></td></tr></table></figure></p>
<p>只有通过php5-fpm，PHP在Nginx下才能正常运行，遂，安装之。</p>
<p>至于php5-mcrypt，有些PHP框架会依赖于这个，比如Laravel就是，所以也把它装上了。</p>
<p>题外话，这里的php5我自己在部署时安装了php7 如果想尝试的也可以试试。</p>
<h2>4.配置PHP</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/php5/fpm/php.ini</div></pre></td></tr></table></figure></p>
<p>打开PHP配置文件，找到cgi.fix_pathinfo选项，去掉它前面的注释分号;，然后将它的值设置为0,如下</p>
<p><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cgi.fix_pathinfo=<span class="number">0</span></div></pre></td></tr></table></figure></p>
<h2>5. 启用php5-mcrypt:</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo php5enmod mcrypt</div></pre></td></tr></table></figure></p>
<h2>6.重启php5-fpm:</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service php5-fpm restart</div></pre></td></tr></table></figure></p>
<p>在搭建完LEMP环境之后，首先要明确两个重要目录</p>
<p><strong>Nginx的默认root文件夹</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/share/nginx/html</div></pre></td></tr></table></figure></p>
<p><strong>Nginx的服务器配置文件所在目录</strong>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/nginx/sites-available/</div></pre></td></tr></table></figure></p>
<p>上面两个目录记住就好，很常用，先摆出来</p>
<h1>下面一步一步在云服务器上部署Laravel</h1>
<h2>1.创建网站的根目录</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo mkdir -p /var/www</div></pre></td></tr></table></figure></p>
<h2>2.配置nginx服务器</h2>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/nginx/sites-available/default</div></pre></td></tr></table></figure></p>
<p>打开nginx的配置文件之后，找到server这一块，大概是长这个样子的</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80 default_server;</div><div class="line">        listen [::]:80 default_server ipv6only=on;</div><div class="line"></div><div class="line">        root /usr/share/nginx/html;</div><div class="line">        index index.html index.htm;</div><div class="line"></div><div class="line">        server_name localhost;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">                try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ =404;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中root，index ，server_name和location这几行需要稍微修改一下</p>
<p><strong>root修改</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root /var/www/laravel/public;</div></pre></td></tr></table></figure></p>
<p>这里就是将nginx服务器的根目录指向Laravel的public文件夹下，后续的Laravel项目的代码我们会放在我们之前创建的/var/www/laravel目录下</p>
<p><strong>index修改</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index index.php index.html index.htm;</div></pre></td></tr></table></figure></p>
<p>这里需要注意的是，将index.php排在最前面</p>
<p><strong>server_name修改</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server_name server_domain_or_IP;</div></pre></td></tr></table></figure></p>
<p>将server_domain_or_IP修改为你的公网IP</p>
<p><strong>location修改</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>修改完是这样的：</strong></p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server ipv6only=on;</div><div class="line"></div><div class="line">    root /var/www/laravel/public;</div><div class="line">    index index.php index.html index.htm;</div><div class="line"></div><div class="line">    server_name server_domain_or_IP;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后我们还需要配置一下Nginx，让其执行PHP文件。同样是在这个文件里，在location下方添加下面的配置：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server ipv6only=on;</div><div class="line"></div><div class="line">    root /var/www/laravel/public;</div><div class="line">    index index.php index.html index.htm;</div><div class="line"></div><div class="line">    server_name server_domain_or_IP;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$query_string</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        try_files <span class="variable">$uri</span> /index.php =404;</div><div class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</div><div class="line">        fastcgi_pass unix:/var/run/php5-fpm.sock;</div><div class="line">        fastcgi_index index.php;</div><div class="line">        fastcgi_param SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">        include fastcgi_params;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意，最下面的<code>location ~ \.php$</code>是自己加上去的：</p>
<p>配置完之后重启Nginx，使上面的配置项生效。</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service nginx restart</div></pre></td></tr></table></figure></p>
<h2>3.创建Laravel项目</h2>
<p>在配置完nginx后，怎么获取Laravel的项目代码呢？有以下几种方法：</p>
<p><strong>(1).直接composer安装</strong></p>
<p>直接通过composer来安装，你可以在服务器上通过执行</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~</div><div class="line">curl <span class="_">-s</span>S https://getcomposer.org/installer | php</div></pre></td></tr></table></figure></p>
<p>上面命令会安装composer</p>
<p>composer全局使用：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo mv composer.phar /usr/<span class="built_in">local</span>/bin/composer</div></pre></td></tr></table></figure></p>
<p>然后在/var/www目录下直接执行</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo composer create-project laravel/laravel laravel</div></pre></td></tr></table></figure></p>
<p>因为我们之前创建/var/www目录，你可以直接cd /var/www然后执行上面的命令。然后坐等安装完成。</p>
<p><strong>(2).直接上传代码</strong></p>
<p>使用下面命令上传</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp -r laravel root@your_IP:</div></pre></td></tr></table></figure></p>
<p>然后在服务器上将laravel移动到/var/www目录下</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo mv laravel/ /var/www</div></pre></td></tr></table></figure></p>
<p>(3).使用Git和Coding平台</p>
<p>个人比较喜欢使用git来上传代码，可以很方便的更新代码和进行回滚，一旦版本更新出Bug我可以借助Git的强大版本管理能力来修复Bug。流程大概是这样：</p>
<p>本地代码－－－－&gt;Github－－－－&gt;云服务器
既然要使用git，那么先在云服务器上安装git：</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure></p>
<p>安装完成就可以使用git了，然后在Github上创建一个私有项目laravel，里面包含所有该Laravel项目所需代码。</p>
<p>一旦本地代码都推送到Coding，然后在/var/www目录下直接使用</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> your-project-git-link</div></pre></td></tr></table></figure></p>
<p>your-project-git-link替换为你Github上的laravel项目地址</p>
<h2>5.BINGO</h2>
<p>在浏览器输入：</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://server_domain_or_IP</div></pre></td></tr></table></figure></p>
<p>至此，你可以在服务器上随意地用Laravel了,keep coding!</p>
<h3>终极tips： 有了问题，页面出不来 各种错误 一定不要胡乱的调试，记得看log，非常有用。</h3>
</div></article></div></section><footer><div class="paginator"><a href="/2017/03/04/Laravel-——-路由的学习笔记/" class="next"><button class="ui button teal">NEXT</button></a></div><div data-thread-key="2017/03/19/在云服务器上部署Laravel/" data-title="在云服务器上部署Laravel" data-url="http://yoursite.com/2017/03/19/在云服务器上部署Laravel/" class="ds-share"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><span class="ds-more">分享到：</span></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul></div></div><div data-thread-key="2017/03/19/在云服务器上部署Laravel/" data-title="在云服务器上部署Laravel" data-url="http://yoursite.com/2017/03/19/在云服务器上部署Laravel/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"originalee"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">Originalee</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and theme by <a href="https://github.com/littlewin-wang/hexo-theme-casual" target="_blank">casual</a></p></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="/js/jquery.goup.min.js"></script><script src="/js/semantic.min.js"></script><script src="/js/casual.js"></script><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>$(document).ready(function(){$.goup({trigger:100,bottomOffset:100,locationOffset:5,title:'',titleAsText:true});});</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','TvAnFS4AVxjiJUvrZJRB','2.0.0');</script></div></body></html>